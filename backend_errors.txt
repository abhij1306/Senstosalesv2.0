B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\buyers.py:35:42
   |
34 | @router.get("/", response_model=List[Buyer])
35 | def list_buyers(db: sqlite3.Connection = Depends(get_db)):
   |                                          ^^^^^^^^^^^^^^^
36 |     try:
37 |         rows = db.execute(
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\buyers.py:46:63
   |
45 | @router.post("/", response_model=Buyer)
46 | def create_buyer(buyer: BuyerCreate, db: sqlite3.Connection = Depends(get_db)):
   |                                                               ^^^^^^^^^^^^^^^
47 |     # Duplicate GSTIN Check
48 |     existing = db.execute("SELECT id FROM buyers WHERE gstin = ?", (buyer.gstin,)).fetchone()
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\buyers.py:88:72
   |
87 | @router.put("/{id}", response_model=Buyer)
88 | def update_buyer(id: int, buyer: BuyerCreate, db: sqlite3.Connection = Depends(get_db)):
   |                                                                        ^^^^^^^^^^^^^^^
89 |     try:
90 |         db.execute(
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\buyers.py:115:57
    |
114 | @router.put("/{id}/default")
115 | def set_buyer_default(id: int, db: sqlite3.Connection = Depends(get_db)):
    |                                                         ^^^^^^^^^^^^^^^
116 |     try:
117 |         db.execute("UPDATE buyers SET is_default = 0")
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\buyers.py:127:52
    |
126 | @router.delete("/{id}")
127 | def delete_buyer(id: int, db: sqlite3.Connection = Depends(get_db)):
    |                                                    ^^^^^^^^^^^^^^^
128 |     try:
129 |         # Soft delete
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\common.py:25:30
   |
23 |     number: str = Query(..., description="Document number to check for duplicates"),
24 |     date: str = Query(..., description="Document date (ISO format YYYY-MM-DD)"),
25 |     db: sqlite3.Connection = Depends(get_db),
   |                              ^^^^^^^^^^^^^^^
26 | ):
27 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\dashboard.py:20:52
   |
19 | @router.get("/summary", response_model=DashboardSummary)
20 | def get_dashboard_summary(db: sqlite3.Connection = Depends(get_db)):
   |                                                    ^^^^^^^^^^^^^^^
21 |     """Get dashboard summary statistics"""
22 |     try:
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dashboard.py:105:47
    |
103 | @router.get("/activity")
104 | def get_recent_activity(
105 |     limit: int = 10, db: sqlite3.Connection = Depends(get_db)
    |                                               ^^^^^^^^^^^^^^^
106 | ) -> List[Dict[str, Any]]:
107 |     """Get recent activity (POs, DCs, Invoices)"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dashboard.py:188:53
    |
187 | @router.get("/insights")
188 | def get_dashboard_insights(db: sqlite3.Connection = Depends(get_db)):
    |                                                     ^^^^^^^^^^^^^^^
189 |     """
190 |     Get deterministic insights/alerts based on business rules.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\dc.py:38:64
   |
37 | @router.get("/po/{po_number}/lots")
38 | def get_po_limit_lots(po_number: str, db: sqlite3.Connection = Depends(get_db)):
   |                                                                ^^^^^^^^^^^^^^^
39 |     """
40 |     Get available lots/items for dispatch from a PO.
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\dc.py:50:43
   |
49 | @router.get("/stats", response_model=DCStats)
50 | def get_dc_stats(db: sqlite3.Connection = Depends(get_db)):
   |                                           ^^^^^^^^^^^^^^^
51 |     """Get DC Page Statistics"""
52 |     try:
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\dc.py:85:65
   |
84 | @router.get("/", response_model=List[DCListItem])
85 | def list_dcs(po: Optional[str] = None, db: sqlite3.Connection = Depends(get_db)):
   |                                                                 ^^^^^^^^^^^^^^^
86 |     """List all Delivery Challans, optionally filtered by PO"""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dc.py:174:76
    |
173 | @router.get("/{dc_number}/invoice")
174 | def check_dc_has_invoice_endpoint(dc_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                            ^^^^^^^^^^^^^^^
175 |     """Check if DC has an associated GST Invoice"""
176 |     invoice_number = check_dc_has_invoice(dc_number, db)
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dc.py:185:64
    |
184 | @router.get("/{dc_number}/download")
185 | def download_dc_excel(dc_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                ^^^^^^^^^^^^^^^
186 |     """Download DC as Excel"""
187 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dc.py:203:60
    |
202 | @router.get("/{dc_number}")
203 | def get_dc_detail(dc_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                            ^^^^^^^^^^^^^^^
204 |     """Get Delivery Challan detail with items"""
    |

F841 Local variable `po_item_id` is assigned to but never used
   --> backend\api\dc.py:323:13
    |
322 |             # Calculate remaining info
323 |             po_item_id = item_dict["po_item_id"]
    |             ^^^^^^^^^^
324 |             lot_no = item_dict["lot_no"]
    |
help: Remove assignment to unused variable `po_item_id`

F841 Local variable `lot_no` is assigned to but never used
   --> backend\api\dc.py:324:13
    |
322 |             # Calculate remaining info
323 |             po_item_id = item_dict["po_item_id"]
324 |             lot_no = item_dict["lot_no"]
    |             ^^^^^^
325 |
326 |             # LOT-LEVEL Ordered Quantity (from purchase_order_deliveries.dely_qty)
    |
help: Remove assignment to unused variable `lot_no`

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dc.py:359:73
    |
358 | @router.post("/")
359 | def create_dc(dc: DCCreate, items: List[dict], db: sqlite3.Connection = Depends(get_db)):
    |                                                                         ^^^^^^^^^^^^^^^
360 |     print(f"DEBUG: Endpoint create_dc called with dc_number={dc.dc_number}")
361 |     sys.stdout.flush()
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dc.py:420:30
    |
418 |     dc: DCCreate,
419 |     items: List[dict],
420 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
421 | ):
422 |     """Update existing Delivery Challan - BLOCKED if invoice exists"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\dc.py:462:56
    |
461 | @router.delete("/{dc_number}")
462 | def delete_dc(dc_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                        ^^^^^^^^^^^^^^^
463 |     """
464 |     Delete a Delivery Challan
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\health.py:45:46
   |
44 | @router.get("/health/ready")
45 | def readiness_check(db: sqlite3.Connection = Depends(get_db)) -> Dict[str, Any]:
   |                                              ^^^^^^^^^^^^^^^
46 |     """
47 |     Readiness check - verifies all dependencies are available
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\invoice.py:84:48
   |
83 | @router.get("/stats", response_model=InvoiceStats)
84 | def get_invoice_stats(db: sqlite3.Connection = Depends(get_db)):
   |                                                ^^^^^^^^^^^^^^^
85 |     """Get Invoice Page Statistics"""
86 |     try:
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\invoice.py:121:30
    |
119 |     dc: Optional[str] = None,
120 |     status: Optional[str] = None,
121 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
122 | ):
123 |     """List all Invoices, optionally filtered by PO, DC, or Status"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\invoice.py:185:74
    |
183 | # IMPORTANT: Specific routes must come before parameterized routes
184 | @router.get("/{invoice_number:path}/download")
185 | def download_invoice_excel(invoice_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                          ^^^^^^^^^^^^^^^
186 |     """Download Invoice as Excel"""
187 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\invoice.py:202:70
    |
201 | @router.get("/{invoice_number}")
202 | def get_invoice_detail(invoice_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                      ^^^^^^^^^^^^^^^
203 |     """Get Invoice detail with items and linked DCs"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\invoice.py:334:77
    |
333 | @router.post("")
334 | def create_invoice(request: EnhancedInvoiceCreate, db: sqlite3.Connection = Depends(get_db)):
    |                                                                             ^^^^^^^^^^^^^^^
335 |     """
336 |     Create Invoice from Delivery Challan
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po.py:25:43
   |
24 | @router.get("/stats", response_model=POStats)
25 | def get_po_stats(db: sqlite3.Connection = Depends(get_db)):
   |                                           ^^^^^^^^^^^^^^^
26 |     """Get aggregated PO statistics"""
27 |     try:
   |

F821 Undefined name `logger`
  --> backend\api\po.py:75:9
   |
73 |         }
74 |     except Exception as e:
75 |         logger.error(f"Failed to get PO stats: {e}")
   |         ^^^^^^
76 |         return {
77 |             "total_pos": 0,
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po.py:90:39
   |
89 | @router.get("/", response_model=List[POListItem])
90 | def list_pos(db: sqlite3.Connection = Depends(get_db)):
   |                                       ^^^^^^^^^^^^^^^
91 |     """List all Purchase Orders with quantity details"""
92 |     return po_service.list_pos(db)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po.py:96:60
   |
95 | @router.get("/{po_number}", response_model=PODetail)
96 | def get_po_detail(po_number: str, db: sqlite3.Connection = Depends(get_db)):
   |                                                            ^^^^^^^^^^^^^^^
97 |     """Get Purchase Order detail with items and deliveries"""
98 |     return po_service.get_po_detail(db, po_number)
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:102:61
    |
101 | @router.get("/{po_number}/context")
102 | def get_po_context(po_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                             ^^^^^^^^^^^^^^^
103 |     """Fetch PO context (Supplier/Buyer info) for DC/Invoice auto-fill"""
104 |     po = db.execute(
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:122:62
    |
121 | @router.get("/{po_number}/dc")
122 | def check_po_has_dc(po_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                              ^^^^^^^^^^^^^^^
123 |     """Check if PO has an associated Delivery Challan"""
124 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:148:72
    |
147 | @router.post("/", response_model=PODetail)
148 | async def create_po_manual(po_data: PODetail, db: sqlite3.Connection = Depends(get_db)):
    |                                                                        ^^^^^^^^^^^^^^^
149 |     """Manually create a Purchase Order from structured data"""
150 |     return await process_po_update(po_data, db)
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:154:81
    |
153 | @router.put("/{po_number}", response_model=PODetail)
154 | async def update_po(po_number: str, po_data: PODetail, db: sqlite3.Connection = Depends(get_db)):
    |                                                                                 ^^^^^^^^^^^^^^^
155 |     """Update an existing Purchase Order"""
156 |     # Force po_number consistency
    |

B008 Do not perform function call `File` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:266:45
    |
265 | @router.post("/upload")
266 | async def upload_po_html(file: UploadFile = File(...), db: sqlite3.Connection = Depends(get_db)):
    |                                             ^^^^^^^^^
267 |     """Upload and parse PO HTML file"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:266:81
    |
265 | @router.post("/upload")
266 | async def upload_po_html(file: UploadFile = File(...), db: sqlite3.Connection = Depends(get_db)):
    |                                                                                 ^^^^^^^^^^^^^^^
267 |     """Upload and parse PO HTML file"""
    |

F841 Local variable `fy` is assigned to but never used
   --> backend\api\po.py:308:17
    |
306 |             po_date = po_header.get("DATE")
307 |             if po_num and po_date:
308 |                 fy = get_financial_year(po_date)
    |                 ^^
309 |                 # Example: If strict uniqueness is desired, uncomment and adjust
310 |                 # existing = db.execute(
    |
help: Remove assignment to unused variable `fy`

B008 Do not perform function call `File` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:350:31
    |
348 | @router.post("/upload/batch")
349 | async def upload_po_batch(
350 |     files: List[UploadFile] = File(...), db: sqlite3.Connection = Depends(get_db)
    |                               ^^^^^^^^^
351 | ):
352 |     """Upload and parse multiple PO HTML files with atomic processing per file."""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:350:67
    |
348 | @router.post("/upload/batch")
349 | async def upload_po_batch(
350 |     files: List[UploadFile] = File(...), db: sqlite3.Connection = Depends(get_db)
    |                                                                   ^^^^^^^^^^^^^^^
351 | ):
352 |     """Upload and parse multiple PO HTML files with atomic processing per file."""
    |

F841 Local variable `po_number` is assigned to but never used
   --> backend\api\po.py:415:21
    |
413 |                     # Reconciliation is now handled inside ingestion service
414 |                     # (skipped for new POs, run for existing POs with deliveries)
415 |                     po_number = str(po_header.get("PURCHASE ORDER"))
    |                     ^^^^^^^^^
416 |
417 |                     linked_srvs_count = 0  # Placeholder
    |
help: Remove assignment to unused variable `po_number`

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:457:64
    |
456 | @router.get("/{po_number}/excel")
457 | def download_po_excel(po_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                ^^^^^^^^^^^^^^^
458 |     """Download PO as Excel"""
459 |     try:
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po.py:487:82
    |
485 | @router.patch("/{po_number}/items/{item_no}/delivered_qty")
486 | async def update_delivered_qty(
487 |     po_number: str, item_no: int, delivered_qty: float, db: sqlite3.Connection = Depends(get_db)
    |                                                                                  ^^^^^^^^^^^^^^^
488 | ):
489 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po_notes.py:42:44
   |
41 | @router.get("/", response_model=List[PONoteOut])
42 | def list_po_notes(db: sqlite3.Connection = Depends(get_db)):
   |                                            ^^^^^^^^^^^^^^^
43 |     """List all active PO Notes templates"""
44 |     rows = db.execute(
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po_notes.py:51:56
   |
50 | @router.get("/{note_id}", response_model=PONoteOut)
51 | def get_po_note(note_id: str, db: sqlite3.Connection = Depends(get_db)):
   |                                                        ^^^^^^^^^^^^^^^
52 |     """Get a specific PO Note template"""
53 |     row = db.execute("SELECT * FROM po_notes_templates WHERE id = ?", (note_id,)).fetchone()
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po_notes.py:62:65
   |
61 | @router.post("/", response_model=PONoteOut)
62 | def create_po_note(note: PONoteCreate, db: sqlite3.Connection = Depends(get_db)):
   |                                                                 ^^^^^^^^^^^^^^^
63 |     """Create a new PO Note template"""
64 |     cursor = db.cursor()
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\po_notes.py:79:79
   |
78 | @router.put("/{note_id}", response_model=PONoteOut)
79 | def update_po_note(note_id: str, note: PONoteUpdate, db: sqlite3.Connection = Depends(get_db)):
   |                                                                               ^^^^^^^^^^^^^^^
80 |     """Update a PO Note template"""
81 |     # Check existence
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\po_notes.py:113:59
    |
112 | @router.delete("/{note_id}")
113 | def delete_po_note(note_id: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                           ^^^^^^^^^^^^^^^
114 |     """Soft delete a PO Note template"""
115 |     existing = db.execute("SELECT id FROM po_notes_templates WHERE id = ?", (note_id,)).fetchone()
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\reports.py:50:30
   |
48 |     po: Optional[str] = None,
49 |     export: bool = False,
50 |     db: sqlite3.Connection = Depends(get_db),
   |                              ^^^^^^^^^^^^^^^
51 | ):
52 |     """PO vs Delivered vs Received vs Rejected"""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\reports.py:81:30
   |
79 |     end_date: Optional[str] = None,
80 |     export: bool = False,
81 |     db: sqlite3.Connection = Depends(get_db),
   |                              ^^^^^^^^^^^^^^^
82 | ):
83 |     """Monthly Sales Summary"""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:103:30
    |
101 |     end_date: Optional[str] = None,
102 |     export: bool = False,
103 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
104 | ):
105 |     """DC Register"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:127:30
    |
125 |     end_date: Optional[str] = None,
126 |     export: bool = False,
127 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
128 | ):
129 |     """Invoice Register"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:150:30
    |
148 |     start_date: Optional[str] = None,
149 |     end_date: Optional[str] = None,
150 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
151 | ):
152 |     """Download PO Register as Excel"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:177:70
    |
176 | @router.get("/pending")
177 | def get_pending_items(export: bool = False, db: sqlite3.Connection = Depends(get_db)):
    |                                                                      ^^^^^^^^^^^^^^^
178 |     """Pending PO Items"""
179 |     df = report_service.get_pending_po_items(db)
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:195:49
    |
194 | @router.get("/kpis")
195 | def get_dashboard_kpis(db: sqlite3.Connection = Depends(get_db)):
    |                                                 ^^^^^^^^^^^^^^^
196 |     """Quick KPIs for dashboard (Legacy support)"""
197 |     # Simple deterministic KPIs
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:221:30
    |
219 |     date: Optional[str] = None,
220 |     export: bool = False,
221 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
222 | ):
223 |     """Daily Dispatch Summary matching strict template"""
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\reports.py:264:72
    |
263 | @router.get("/guarantee-certificate")
264 | def get_guarantee_certificate(dc_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                        ^^^^^^^^^^^^^^^
265 |     """Generate Guarantee Certificate for a specific DC"""
266 |     # Fetch DC header
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\search.py:14:52
   |
13 | @router.get("/", response_model=dict)
14 | def global_search(q: str, db: sqlite3.Connection = Depends(get_db)):
   |                                                    ^^^^^^^^^^^^^^^
15 |     """Search across POs, DCs, and Invoices using deterministic logic"""
16 |     results = []
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\settings.py:13:43
   |
12 | @router.get("/", response_model=Settings)
13 | def get_settings(db: sqlite3.Connection = Depends(get_db)):
   |                                           ^^^^^^^^^^^^^^^
14 |     """Get all settings as a dict mapped to Settings model"""
15 |     """Get all settings as a dict mapped to Settings model"""
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\settings.py:26:70
   |
25 | @router.post("/")
26 | def update_setting(setting: SettingsUpdate, db: sqlite3.Connection = Depends(get_db)):
   |                                                                      ^^^^^^^^^^^^^^^
27 |     """Update a single setting"""
28 |     try:
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\settings.py:40:84
   |
39 | @router.post("/batch")
40 | def update_settings_batch(settings: List[SettingsUpdate], db: sqlite3.Connection = Depends(get_db)):
   |                                                                                    ^^^^^^^^^^^^^^^
41 |     """Batch update settings"""
42 |     try:
   |

B008 Do not perform function call `File` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\srv.py:20:31
   |
18 | @router.post("/upload/batch")
19 | async def upload_batch_srvs(
20 |     files: List[UploadFile] = File(...), db: sqlite3.Connection = Depends(get_db)
   |                               ^^^^^^^^^
21 | ):
22 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\srv.py:20:67
   |
18 | @router.post("/upload/batch")
19 | async def upload_batch_srvs(
20 |     files: List[UploadFile] = File(...), db: sqlite3.Connection = Depends(get_db)
   |                                                                   ^^^^^^^^^^^^^^^
21 | ):
22 |     """
   |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\srv.py:101:30
    |
 99 |     skip: int = 0,
100 |     limit: int = 100,
101 |     db: sqlite3.Connection = Depends(get_db),
    |                              ^^^^^^^^^^^^^^^
102 | ):
103 |     """
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\srv.py:168:44
    |
167 | @router.get("/stats", response_model=SRVStats)
168 | def get_srv_stats(db: sqlite3.Connection = Depends(get_db)):
    |                                            ^^^^^^^^^^^^^^^
169 |     """
170 |     Get SRV statistics for dashboard KPIs.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\srv.py:200:62
    |
199 | @router.get("/{srv_number}", response_model=SRVDetail)
200 | def get_srv_detail(srv_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                              ^^^^^^^^^^^^^^^
201 |     """
202 |     Get detailed SRV information with all items.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\srv.py:233:62
    |
232 | @router.get("/po/{po_number}/srvs", response_model=List[SRVListItem])
233 | def get_srvs_for_po(po_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                              ^^^^^^^^^^^^^^^
234 |     """
235 |     Get all SRVs linked to a specific PO with aggregated quantities.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
   --> backend\api\srv.py:280:67
    |
279 | @router.delete("/{srv_number}")
280 | def delete_srv_endpoint(srv_number: str, db: sqlite3.Connection = Depends(get_db)):
    |                                                                   ^^^^^^^^^^^^^^^
281 |     """
282 |     Delete an SRV and rollback its quantities.
    |

B008 Do not perform function call `Depends` in argument defaults; instead, perform the call within the function, or read the default from a module-level singleton variable
  --> backend\api\system.py:13:51
   |
12 | @router.post("/reset-db")
13 | async def reset_database(db: sqlite3.Connection = Depends(get_db)):
   |                                                   ^^^^^^^^^^^^^^^
14 |     """
15 |     Nuclear Reset: Clears all business transaction data.
   |

B904 Within an `except` clause, raise exceptions with `raise ... from err` or `raise ... from None` to distinguish them from errors in exception handling
  --> backend\api\system.py:73:9
   |
71 |         logger.error(f"System reset failed: {e}", exc_info=True)
72 |         db.rollback()
73 |         raise HTTPException(status_code=500, detail=str(e))
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

E722 Do not use bare `except`
  --> backend\audits\performance\aggressive-token-fixer.py:68:5
   |
66 |             return fixes
67 |         return 0
68 |     except:
   |     ^^^^^^
69 |         return 0
   |

E722 Do not use bare `except`
  --> backend\audits\performance\final-color-cleanup.py:52:5
   |
50 |             return fixes
51 |         return 0
52 |     except:
   |     ^^^^^^
53 |         return 0
   |

B007 Loop control variable `dirs` not used within loop body
  --> backend\audits\performance\purge-injection.py:35:15
   |
33 | def main():
34 |     count = 0
35 |     for root, dirs, files in os.walk(TARGET_DIR):
   |               ^^^^
36 |         for file in files:
37 |             if file.endswith((".tsx", ".ts")):
   |
help: Rename unused `dirs` to `_dirs`

B007 Loop control variable `size` not used within loop body
  --> backend\audits\performance\super-fixer.py:83:9
   |
81 |     # We target common tags and replace them with components
82 |     # Specifically looking for tags that HAVE a typography class
83 |     for size, component in TYPO_MAP.items():
   |         ^^^^
84 |         # Case A: <div/span/p/hX className="... text-size ..."> ... </div/span/p/hX>
85 |         # This is a bit complex for regex, so we'll do the class replacement first
   |
help: Rename unused `size` to `_size`

B007 Loop control variable `component` not used within loop body
  --> backend\audits\performance\super-fixer.py:83:15
   |
81 |     # We target common tags and replace them with components
82 |     # Specifically looking for tags that HAVE a typography class
83 |     for size, component in TYPO_MAP.items():
   |               ^^^^^^^^^
84 |         # Case A: <div/span/p/hX className="... text-size ..."> ... </div/span/p/hX>
85 |         # This is a bit complex for regex, so we'll do the class replacement first
   |
help: Rename unused `component` to `_component`

E722 Do not use bare `except`
  --> backend\audits\performance\typography-migrator.py:62:9
   |
61 |             return False
62 |         except:
   |         ^^^^^^
63 |             return False
   |

F841 Local variable `fixes` is assigned to but never used
  --> backend\audits\performance\typography-migrator.py:89:13
   |
87 |             content = file_path.read_text(encoding="utf-8")
88 |             original = content
89 |             fixes = 0
   |             ^^^^^
90 |
91 |             # Add import
   |
help: Remove assignment to unused variable `fixes`

E722 Do not use bare `except`
  --> backend\audits\production_audit_suite.py:87:13
   |
85 |                 if "<img" in content:
86 |                     image_count += 1
87 |             except:
   |             ^^^^^^
88 |                 pass
   |

F821 Undefined name `re`
   --> backend\audits\production_audit_suite.py:165:20
    |
163 |                 content = file.read_text(encoding="utf-8")
164 |                 # Check for hardcoded font sizes
165 |                 if re.search(r"\btext-(xs|sm|base|lg|xl|2xl|3xl)\b", content):
    |                    ^^
166 |                     if 'Typography"' not in content and "atoms/Typography" not in content:
167 |                         hardcoded_fonts += 1
    |

E722 Do not use bare `except`
   --> backend\audits\production_audit_suite.py:171:13
    |
169 |                 if "Typography" in content or "H1" in content or "Body" in content:
170 |                     atomic_usage += 1
171 |             except:
    |             ^^^^^^
172 |                 pass
    |

E722 Do not use bare `except`
   --> backend\audits\production_audit_suite.py:198:13
    |
196 |                     if 'from "@/components/design-system/organisms' not in content:
197 |                         violations.append(str(file.relative_to(self.frontend)))
198 |             except:
    |             ^^^^^^
199 |                 pass
    |

E722 Do not use bare `except`
   --> backend\audits\production_audit_suite.py:266:13
    |
264 |                             )
265 |                     functions[func] = str(file.relative_to(self.backend))
266 |             except:
    |             ^^^^^^
267 |                 pass
    |

E722 Do not use bare `except`
   --> backend\audits\production_audit_suite.py:286:13
    |
284 |                     if "0.09" in content or "9.0" in content or "9 /" in content:
285 |                         consistent = False
286 |             except:
    |             ^^^^^^
287 |                 pass
    |

F841 Local variable `result` is assigned to but never used
  --> backend\audits\run_production_audit.py:26:13
   |
24 |         try:
25 |             script = self.mcp_servers / "performance" / "dark-theme-audit.py"
26 |             result = subprocess.run(
   |             ^^^^^^
27 |                 [sys.executable, str(script)],
28 |                 capture_output=True,
   |
help: Remove assignment to unused variable `result`

B007 Loop control variable `name` not used within loop body
   --> backend\audits\run_production_audit.py:259:13
    |
257 |         )
258 |         print("\nCategory Scores:")
259 |         for name, data in report["audits"].items():
    |             ^^^^
260 |             print(f"  {data['name']}: {data['score']}/100")
    |
help: Rename unused `name` to `_name`

E402 Module level import not at top of file
  --> backend\main.py:66:1
   |
66 | from backend.core.exceptions import ResourceNotFoundException
   | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |

F821 Undefined name `settings`
   --> backend\services\excel_service.py:233:16
    |
231 |             header.get("consignee_name")
232 |             or default_buyer.get("name")
233 |             or settings.get("buyer_name", "")
    |                ^^^^^^^^
234 |         )
235 |         b_addr = (
    |

F821 Undefined name `settings`
   --> backend\services\excel_service.py:238:16
    |
236 |             header.get("consignee_address")
237 |             or default_buyer.get("billing_address")
238 |             or settings.get("buyer_address", "")
    |                ^^^^^^^^
239 |         )
240 |         b_gst = (
    |

F821 Undefined name `settings`
   --> backend\services\excel_service.py:243:16
    |
241 |             header.get("consignee_gstin")
242 |             or default_buyer.get("gstin")
243 |             or settings.get("buyer_gstin", "")
    |                ^^^^^^^^
244 |         )
    |

E722 Do not use bare `except`
   --> backend\services\excel_service.py:383:13
    |
381 |                         "A12", f"Place of Supply : {buyer.get('place_of_supply', 'BHOPAL, MP')}"
382 |                     )
383 |             except:
    |             ^^^^^^
384 |                 pass
385 |         else:
    |

F811 Redefinition of unused `generate_exact_dc_excel` from line 498
   --> backend\services\excel_service.py:990:9
    |
989 |     @staticmethod
990 |     def generate_exact_dc_excel(
    |         ^^^^^^^^^^^^^^^^^^^^^^^ `generate_exact_dc_excel` redefined here
991 |         header: Dict, items: List[Dict], db: sqlite3.Connection
992 |     ) -> StreamingResponse:
    |
   ::: backend\services\excel_service.py:498:9
    |
497 |     @staticmethod
498 |     def generate_exact_dc_excel(
    |         ----------------------- previous definition of `generate_exact_dc_excel` here
499 |         header: Dict, items: List[Dict], db: sqlite3.Connection
500 |     ) -> StreamingResponse:
    |
help: Remove definition: `generate_exact_dc_excel`

B007 Loop control variable `item_no` not used within loop body
   --> backend\services\po_scraper.py:465:9
    |
463 |     # BHEL PO HTML provides RCD QTY at item-level only, but repeats it per row.
464 |     # We must distribute this total across lots to prevent doubling during Sum aggregation.
465 |     for item_no, item in items_map.items():
    |         ^^^^^^^
466 |         # Handle DRG
467 |         desc = item["DESCRIPTION"]
    |
help: Rename unused `item_no` to `_item_no`

F841 Local variable `po_item_no` is assigned to but never used
   --> backend\services\po_service.py:237:13
    |
235 |             item_dict = dict(item_row)
236 |             item_id = item_dict["id"]
237 |             po_item_no = item_dict["po_item_no"]
    |             ^^^^^^^^^^
238 |
239 |             # Map deliveries and compute High-Water Mark DLV
    |
help: Remove assignment to unused variable `po_item_no`

F841 Local variable `item_rcd` is assigned to but never used
  --> backend\services\reconciliation_service.py:44:53
   |
42 |         if not po_info:
43 |             return
44 |         po_num, po_item_num, item_ord, item_manual, item_rcd = (
   |                                                     ^^^^^^^^
45 |             po_info[0],
46 |             po_info[1],
   |
help: Remove assignment to unused variable `item_rcd`

F841 Local variable `total_item_dispatch` is assigned to but never used
  --> backend\services\reconciliation_service.py:72:9
   |
70 |             dispatch_query += " AND dc_number != ?"
71 |             dispatch_params.append(exclude_dc_number)
72 |         total_item_dispatch = to_qty(db.execute(dispatch_query, dispatch_params).fetchone()[0])
   |         ^^^^^^^^^^^^^^^^^^^
73 |
74 |         # Shared Received (where lot_no is NULL or 0)
   |
help: Remove assignment to unused variable `total_item_dispatch`

F841 Local variable `dispatch_qty` is assigned to but never used
   --> backend\services\reconciliation_service.py:238:17
    |
236 |                 po_item_id = row[0]
237 |                 lot_no = row[1]
238 |                 dispatch_qty = row[2]
    |                 ^^^^^^^^^^^^
239 |
240 |                 # We need to simulate the deletion for recalculation to work correcty.
    |
help: Remove assignment to unused variable `dispatch_qty`

F841 Local variable `delivered` is assigned to but never used
   --> backend\services\reconciliation_service.py:272:17
    |
270 |                 po_item_no = item["po_item_no"]
271 |                 lot_no = item.get("lot_no")
272 |                 delivered = to_qty(item.get("dispatch_qty") or 0)
    |                 ^^^^^^^^^
273 |                 received = to_qty(item.get("received_qty") or 0)
274 |                 rejected = to_qty(item.get("rejected_qty") or 0)
    |
help: Remove assignment to unused variable `delivered`

B023 Function definition does not bind loop variable `header_map`
  --> backend\services\srv_scraper.py:70:35
   |
68 |                 def get_cell_val(keys):
69 |                     for key in keys:
70 |                         if key in header_map and header_map[key] < len(cells):
   |                                   ^^^^^^^^^^
71 |                             return cells[header_map[key]].get_text(strip=True)
72 |                     return None
   |

B023 Function definition does not bind loop variable `header_map`
  --> backend\services\srv_scraper.py:70:50
   |
68 |                 def get_cell_val(keys):
69 |                     for key in keys:
70 |                         if key in header_map and header_map[key] < len(cells):
   |                                                  ^^^^^^^^^^
71 |                             return cells[header_map[key]].get_text(strip=True)
72 |                     return None
   |

B023 Function definition does not bind loop variable `cells`
  --> backend\services\srv_scraper.py:70:72
   |
68 |                 def get_cell_val(keys):
69 |                     for key in keys:
70 |                         if key in header_map and header_map[key] < len(cells):
   |                                                                        ^^^^^
71 |                             return cells[header_map[key]].get_text(strip=True)
72 |                     return None
   |

B023 Function definition does not bind loop variable `cells`
  --> backend\services\srv_scraper.py:71:36
   |
69 |                     for key in keys:
70 |                         if key in header_map and header_map[key] < len(cells):
71 |                             return cells[header_map[key]].get_text(strip=True)
   |                                    ^^^^^
72 |                     return None
   |

B023 Function definition does not bind loop variable `header_map`
  --> backend\services\srv_scraper.py:71:42
   |
69 |                     for key in keys:
70 |                         if key in header_map and header_map[key] < len(cells):
71 |                             return cells[header_map[key]].get_text(strip=True)
   |                                          ^^^^^^^^^^
72 |                     return None
   |

B007 Loop control variable `srv_num` not used within loop body
   --> backend\services\srv_scraper.py:108:9
    |
106 |     # Convert groups to list
107 |     results = []
108 |     for srv_num, data in srv_groups.items():
    |         ^^^^^^^
109 |         results.append(data)
    |
help: Rename unused `srv_num` to `_srv_num`

Found 102 errors.
No fixes available (16 hidden fixes can be enabled with the `--unsafe-fixes` option).
