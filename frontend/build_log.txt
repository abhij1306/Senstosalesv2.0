
> frontend@3.4.0 build
> next build

 ΓÜá Warning: Next.js inferred your workspace root, but it may not be correct.
 We detected multiple lockfiles and selected the directory of C:\Users\abhij\package-lock.json as the root directory.
 To silence this warning, set `turbopack.root` in your Next.js config, or consider removing one of the lockfiles if it's not needed.
   See https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory for more information.
 Detected additional lockfiles: 
   * C:\Users\abhij\.gemini\antigravity\scratch\SenstoSales\frontend\package-lock.json
   * C:\Users\abhij\.gemini\antigravity\scratch\SenstoSales\package-lock.json

   Γû▓ Next.js 16.0.10 (Turbopack)

   Creating an optimized production build ...

> Build error occurred
Error: Turbopack build failed with 13 errors:
./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:145
Ecmascript file had an error
  15 | import { motion, AnimatePresence } from"framer-motion";
  16 | import dynamic from"next/dynamic";
> 17 | import { DetailSkeleton } from"@/components/design-system/molecules/skeletons/DetailSkeleton"; import { H1, H2, H3, H4, Body, SmallText, Label, Accounting,
     |                                                                                                                                                 ^^^^^^^^^^
  18 | } from"@/components/design-system/atoms/Typography"; const DocumentJourney = dynamic( () => import("@/components/design-system/molecules/DocumentJourney").then( (mod) => mod.DocumentJourney ), { loading: () => <div className="h-6 w-48 bg-[var(--color-sys-bg-tertiary)] rounded-full animate-pulse" />, ssr: false, }
  19 | ); function PODetailContent() { const router = useRouter(); const params = useParams(); const poId = normalizeId(params?.id as string | string[] ||""); const [data, setData] = useState<PODetail | null>(null); const [loading, setLoading] = useState(true); const [editMode, setEditMode] = useState(false); const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set()); const [hasDC, setHasDC] = useState(false); const [dcId, setDCId] = useState<string | null>(null); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [error, setError] = useState<string | null>(null); // Restore tab state from v2 blueprint const [activeTab, setActiveTab] = useState("basic"); useEffect(() => { if (!poId) return; const loadData = async () => { try { const [poData, dcCheck, srvData] = await Promise.all([ api.getPODetail(poId), api.checkPOHasDC(poId).catch(() => null), api.listSRVs(poId).catch(() => []), ]); setData(poData); if (poData.items) setExpandedItems(new Set(poData.items.map((item: POItem) => item.po_item_no))); if (dcCheck?.has_dc) { setHasDC(true); setDCId(dcCheck.dc_id || null); } // Fix: Ensure we handle potential type mismatch if API returns strictly SRVListItem[] // but Types expects extra fields. For now, we cast or map if necessary. setSrvs((srvData || []) as SRVListItem[]); } catch (err: any) { setError(err.message ||"Traceback failure in record retrieval"); } finally { setLoading(false); } }; loadData(); }, [poId]); const handleSave = useCallback(async () => { if (!data || !data.header) return; setLoading(true); try { await api.updatePO(data.header.po_number, data.header, data.items); setEditMode(false); const poData = await api.getPODetail(poId); setData(poData); } catch (err: any) { setError(err.message ||"Failed to sync changes"); } finally { setLoading(false); } }, [data, poId]); const addItem = useCallback(() => { if (!data || !data.items) return; const maxItemNo = Math.max(...data.items.map((i: POItem) => i.po_item_no || 0), 0); const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"NEW PROCUREMENT ITEM", drg_no:"", unit:"NOS", ordered_quantity: 0, po_rate: 0, item_value: 0, delivered_quantity: 0, deliveries: [], }; setData({ ...data, items: [...data.items, newItem] }); setExpandedItems(new Set([...Array.from(expandedItems), maxItemNo + 1])); }, [data, expandedItems]); const toggleItem = useCallback((itemNo: number) => { const s = new Set(expandedItems); s.has(itemNo) ? s.delete(itemNo) : s.add(itemNo); setExpandedItems(s); }, [expandedItems]); const updateHeader = (field: string, value: any) => { if (!data) return; setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="po_rate" || field ==="ordered_quantity") { newItems[index].item_value = (newItems[index].ordered_quantity || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const addDelivery = (itemIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; const item = newItems[itemIdx]; const maxLotNo = Math.max(...(item.deliveries?.map((d: PODelivery) => d.lot_no || 0) || []), 0); const newLot = { lot_no: maxLotNo + 1, delivered_quantity: 0, dely_date: new Date().toISOString().split("T")[0], }; newItems[itemIdx].deliveries = [...(item.deliveries || []), newLot]; setData({ ...data, items: newItems }); }; const removeDelivery = (itemIdx: number, deliveryIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[itemIdx].deliveries = newItems[itemIdx].deliveries.filter((_, i) => i !== deliveryIdx); setData({ ...data, items: newItems }); }; const removeItem = (index: number) => { if (!data || !data.items) return; const newItems = data.items.filter((_, i) => i !== index); setData({ ...data, items: newItems }); }; const handleEnableEdit = useCallback(() => setEditMode(true), []); const handleDisableEdit = useCallback(() => setEditMode(false), []); if (loading || !data || !data.header) { return <DetailSkeleton />; } const { header, items } = data; const topActions = ( <div className="flex items-center gap-2.5"> {editMode ? ( <> <Button variant="outline" size="sm" onClick={() => setEditMode(false)} className="text-[var(--color-sys-status-error)] border-[var(--color-sys-status-error)]/20 shadow-sm" > <X className="w-3.5 h-3.5 mr-2" /> Discard </Button> <Button variant="default" size="sm" onClick={handleSave}> <Save className="w-3.5 h-3.5 mr-2" /> SAVE CHANGES </Button> </> ) : ( <> <Button variant="outline" size="sm" asChild className="text-[var(--color-sys-status-success)] border-[var(--color-sys-status-success)]/20 bg-[var(--color-sys-status-success)]/10 hover:bg-[var(--color-sys-status-success)]/20 hover:text-[var(--color-sys-status-success)]" > <a href={`${api.baseUrl}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-3.5 h-3.5 mr-2" /> EXCEL </a> </Button> <Button variant="outline" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("border-[var(--color-sys-text-tertiary)]/20", hasDC ?"bg-[var(--color-sys-status-success)]/10 text-[var(--color-sys-status-success)] shadow-sm border-[var(--color-sys-status-success)]/20" :"text-[var(--color-sys-text-secondary)]" )} > <FileText className="w-3.5 h-3.5 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Button variant="default" size="sm" onClick={handleEnableEdit}> <Edit2 className="w-3.5 h-3.5 mr-2" /> MODIFY </Button> </> )} </div> ); // Using Atomic Components for Fields - Unified for Zero Layout Shift const Field = ({ label, value, field, readonly = false, }: { label: string; value: any; field?: string; readonly?: boolean; }) => { return ( <div className="min-h-[44px] flex flex-col justify-center"> <Label className="mb-1.5 font-bold text-[var(--color-sys-text-secondary)]">{label}</Label> {editMode && field && !readonly ? ( <Input value={value ??""} onChange={(e) => updateHeader(field, e.target.value)} className="h-7 text-body px-2 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none focus:shadow-sm font-medium text-[var(--color-sys-text-primary)]" /> ) : ( <Body className="font-medium text-sys-primary leading-tight py-1 truncate" title={value?.toString()} > {value || ( <span className="text-sys-tertiary font-normal italic opacity-60 uppercase tracking-tighter text-label"> Empty </span> )} </Body> )} </div> ); }; // ≡ƒÄ¿ VISUAL UPGRADE: Actions (Moved from fixed bar to standard top actions for compliance) const renderActions = () => { if (editMode) { return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" onClick={() => setEditMode(false)} className="text-sys-secondary hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <X className="w-4 h-4 mr-2" /> DISCARD </Button> <Button variant="default" size="sm" onClick={handleSave} className="bg-[var(--color-sys-brand-primary)] hover:brightness-110 text-[var(--color-sys-text-on-brand)] shadow-sm text-small" > <Save className="w-4 h-4 mr-2" /> SAVE CHANGES </Button> </Flex> ); } return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" asChild className="text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <a href={`${API_BASE_URL}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-4 h-4 mr-2 text-[var(--color-sys-brand-primary)]" /> EXCEL </a> </Button> <Button variant="ghost" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small", hasDC &&"text-[var(--color-sys-status-success)]" )} > <FileText className="w-4 h-4 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Box className="w-[1px] h-6 bg-[var(--color-sys-text-tertiary)]/10 mx-1" /> <Button variant="default" size="sm" onClick={handleEnableEdit} className="bg-[var(--color-sys-brand-primary)] text-[var(--color-sys-text-on-brand)] hover:brightness-110 shadow-lg text-small" > <Edit2 className="w-4 h-4 mr-2 text-[var(--color-sys-text-on-brand)]" /> MODIFY RECORD </Button> </Flex> ); }; return ( <DocumentTemplate title={`PO #${header.po_number}`} description={`${header.supplier_name} ΓÇó ${formatDate(header.po_date)}`} actions={renderActions()} onBack={() => router.back()} layoutId={`po-title-${header.po_number}`} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId={`po-icon-${header.po_number}`} status={header.po_status} > <div className="space-y-6"> {/* Document Journey */} <DocumentJourney currentStage="PO" className="mb-2" /> {/* V2 Layout: Comprehensive Tabs */} <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> <TabsList className="mb-4 bg-transparent p-0 border-b border-[var(--color-sys-text-tertiary)]/10 w-full justify-start rounded-none gap-6"> <TabsTrigger value="basic"> <Info className="w-3.5 h-3.5 mr-1.5" /> Basic </TabsTrigger> <TabsTrigger value="references"> <FileText className="w-3.5 h-3.5 mr-1.5" /> Refs </TabsTrigger> <TabsTrigger value="financial"> <Landmark className="w-3.5 h-3.5 mr-1.5" /> Finance </TabsTrigger> <TabsTrigger value="issuer"> <ShieldCheck className="w-3.5 h-3.5 mr-1.5" /> Issuer </TabsTrigger> <TabsTrigger value="srvs"> <Receipt className="w-3.5 h-3.5 mr-1.5" /> SRVs ({srvs.length}) </TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.15 }} > <GlassContainer className="p-6 min-h-[180px] border-none shadow-sm mt-0 relative top-[-1px]"> <TabsContent value="basic" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Number" value={header.po_number} field="po_number" readonly /> <Field label="PO Date" value={formatDate(header.po_date)} field="po_date" readonly /> <Field label="Supplier Name" value={header.supplier_name} field="supplier_name" /> <Field label="Supplier Code" value={header.supplier_code} field="supplier_code" /> <Field label="Phone" value={header.supplier_phone} field="supplier_phone" /> <Field label="Fax" value={header.supplier_fax} field="supplier_fax" /> <Field label="Email" value={header.supplier_email} field="supplier_email" /> <Field label="Dept No (DVN)" value={header.department_no} field="department_no" /> </div> </TabsContent> <TabsContent value="references" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Enquiry No" value={header.enquiry_no} field="enquiry_no" /> <Field label="Enquiry Date" value={formatDate(header.enquiry_date)} field="enquiry_date" /> <Field label="Quotation Ref" value={header.quotation_ref} field="quotation_ref" /> <Field label="Quotation Date" value={formatDate(header.quotation_date)} field="quotation_date" /> <Field label="RC No" value={header.rc_no} field="rc_no" /> <Field label="Order Type" value={header.order_type} field="order_type" /> <Field label="PO Status" value={header.po_status} field="po_status" /> <Field label="Amd No" value={header.amend_no} field="amend_no" /> </div> </TabsContent> <TabsContent value="financial" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Value" value={formatIndianCurrency(header.po_value)} field="po_value" /> <Field label="FOB Value" value={formatIndianCurrency(header.fob_value)} field="fob_value" /> <Field label="Net Value" value={formatIndianCurrency(header.net_po_value)} field="net_po_value" /> <Field label="TIN No" value={header.tin_no} field="tin_no" /> <Field label="ECC No" value={header.ecc_no} field="ecc_no" /> <Field label="MPCT No" value={header.mpct_no} field="mpct_no" /> <Field label="Currency" value={header.currency} field="currency" /> <Field label="Ex Rate" value={header.ex_rate} field="ex_rate" /> </div> </TabsContent> <TabsContent value="issuer" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Inspection By" value={header.inspection_by} field="inspection_by" /> <Field label="Issuer Name" value={header.issuer_name} field="issuer_name" /> <Field label="Designation" value={header.issuer_designation} field="issuer_designation" /> <Field label="Issuer Phone" value={header.issuer_phone} field="issuer_phone" /> {/* Truncated Remarks Section to Save a Row */} <div className="col-span-2 md:col-span-4 mt-2"> <div className="flex flex-col"> <Label className="mb-1 font-bold text-sys-secondary"> Remarks </Label> {editMode ? ( <input value={header.remarks ||""} onChange={(e) => updateHeader("remarks", e.target.value)} className="w-full h-8 px-2 text-body border-none bg-[var(--color-sys-bg-tertiary)]/50 rounded focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none font-medium text-sys-primary" placeholder="Enter remarks..." /> ) : ( <div className="text-body text-sys-primary font-normal line-clamp-1 italic px-0.5 opacity-90" title={header.remarks ||""} > {header.remarks ||"No remarks provided."} </div> )} </div> </div> </div> </TabsContent> <TabsContent value="srvs" className="m-0"> {srvs.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {srvs.map((srv) => ( <div key={srv.srv_number} className="p-4 rounded-xl shadow-sm bg-[var(--color-sys-bg-tertiary)]/10 hover:bg-[var(--color-sys-brand-primary)]/[0.03] hover:shadow-md transition-all duration-300 group cursor-pointer border border-[var(--color-sys-text-tertiary)]/10" onClick={() => router.push(`/srv/${srv.srv_number}`)} > <div className="flex justify-between items-start mb-3"> <div className="space-y-0.5"> <Label className="font-bold text-sys-primary group-hover:text-sys-brand cursor-pointer"> SRV-{srv.srv_number} </Label> <SmallText className="font-medium text-sys-tertiary flex items-center gap-1 uppercase tracking-tighter"> <Calendar className="w-2.5 h-2.5" /> {formatDate(srv.srv_date)} </SmallText> </div> <div className="flex flex-col items-end gap-1.5"> <div className="w-6 h-6 rounded-lg bg-[var(--color-sys-brand-primary)]/10 flex items-center justify-center text-sys-brand shadow-sm border border-[var(--color-sys-brand-primary)]/20"> <Receipt className="w-3 h-3" /> </div> {srv.invoice_numbers && ( <Badge variant="default" className="text-h4 py-0 px-1.5 h-5 font-bold" > INV: {srv.invoice_numbers.split(",")[0]} </Badge> )} </div> </div> <div className="grid grid-cols-2 pt-2 border-t border-[var(--color-sys-text-tertiary)]/10 gap-2"> <div> <div className="text-h4 font-bold text-sys-success uppercase tracking-widest leading-tight"> Accepted </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_accepted_qty || 0}</Accounting> </div> </div> <div className="text-right"> <div className="text-h4 font-bold text-sys-error uppercase tracking-widest leading-tight"> Rejected </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_rejected_qty || 0}</Accounting> </div> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-6 text-[var(--color-sys-text-tertiary)] italic"> No linked SRVs found. </div> )} </TabsContent> </GlassContainer> </motion.div> </AnimatePresence> </Tabs> {/* Items & Deliveries - Custom Table matching Atomic Vibe + V2 Layout */} <div className="space-y-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-2"> <Label className="m-0 text-body font-black text-sys-secondary"> Bill of Materials </Label> </div> {editMode && ( <Button size="sm" onClick={addItem} variant="ghost" className="h-8 text-small bg-[var(--color-sys-bg-tertiary)] text-sys-primary hover:bg-[var(--color-sys-bg-secondary)] font-bold" > <Plus className="w-3.5 h-3.5 mr-1.5" /> ADD ITEM </Button> )} </div> <div className="overflow-hidden rounded-2xl bg-[var(--color-sys-bg-primary)] shadow-xl shadow-[var(--color-sys-brand-primary)]/5 border-none"> <div className="overflow-x-auto"> <table className="w-full text-left"> <thead className="bg-[var(--color-sys-bg-tertiary)]/50"> <tr> <th className="py-2.5 px-4 table-header-text text-center w-12">#</th> <th className="py-2.5 px-4 table-header-text text-left w-32">Code</th> <th className="py-2.5 px-4 table-header-text text-left">Description</th> <th className="py-2.5 px-4 table-header-text text-left w-20">Unit</th> <th className="py-2.5 px-4 table-header-text text-right w-28">Rate</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Ord</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Dlv</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Bal</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Rec</th> <th className="py-2.5 px-4 w-12"></th> </tr> </thead> <tbody className="min-h-[200px]"> {items.map((item, idx) => ( <React.Fragment key={item.po_item_no}> <tr className={cn("hover:bg-[var(--color-sys-bg-secondary)] transition-colors group", expandedItems.has(item.po_item_no) ?"bg-[var(--color-sys-bg-secondary)]/50" :"" )} > <td className="py-2 px-4 text-center align-top pt-3.5 italic table-cell-text"> {idx + 1} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.material_code} onChange={(e) => updateItem(idx,"material_code", e.target.value)} className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-number" /> ) : ( <Accounting className="tracking-tighter table-cell-number"> {item.material_code} </Accounting> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <div className="space-y-1"> <Input value={item.material_description} onChange={(e) => updateItem(idx,"material_description", e.target.value) } className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-text" /> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value)} placeholder="Drawing" className="h-6 text-small w-32 px-1.5 py-0.5 border-none bg-[var(--color-sys-bg-tertiary)] font-medium text-[var(--color-sys-text-primary)]" /> </div> ) : ( <div className="space-y-0.5"> <div className="font-medium leading-tight truncate max-w-[400px] table-cell-text" title={item.material_description} > {item.material_description} </div> {item.drg_no && ( <div className="text-h4 font-medium text-sys-brand uppercase tracking-tight"> DRG: {item.drg_no} </div> )} </div> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value)} className="h-7 text-body w-14 px-1 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-sys-primary" /> ) : ( <SmallText className="text-sys-secondary uppercase font-bold"> {item.unit} </SmallText> )} </td> <td className="py-2 px-4 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.po_rate} onChange={(e) => updateItem(idx,"po_rate", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1.5 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1.5 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number font-mono text-right block"> {formatIndianCurrency(item.po_rate)} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.ordered_quantity} onChange={(e) => updateItem(idx,"ordered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {item.ordered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.delivered_quantity} onChange={(e) => updateItem(idx,"delivered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-mono font-medium text-sys-brand focus:bg-[var(--color-sys-brand-primary)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-sys-brand tracking-tighter table-cell-number text-right block font-mono"> {item.delivered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {(item.ordered_quantity || 0) - (item.received_quantity || 0)} </Accounting> </div> </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.received_quantity} onChange={(e) => updateItem(idx,"received_quantity", parseFloat(e.target.value)) } className="h-7 text-[13px] text-right w-full px-1 py-1 font-mono font-medium text-[var(--color-sys-status-success)] focus:bg-[var(--color-sys-status-success)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-[var(--color-sys-status-success)] tracking-tighter table-cell-number text-right block font-mono"> {item.received_quantity} </Accounting> </div> )} </td> <td className="py-2 px-4 align-top pt-2"> <div className="flex flex-col gap-1 items-center"> <button onClick={() => toggleItem(item.po_item_no)} className={cn("p-1.5 rounded-md transition-all text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-text-primary)]", expandedItems.has(item.po_item_no) &&"text-[var(--color-sys-brand-primary)] bg-[var(--color-sys-brand-primary)]/10" )} > {expandedItems.has(item.po_item_no) ? ( <ChevronUp className="w-4 h-4" /> ) : ( <ChevronDown className="w-4 h-4" /> )} </button> {editMode && ( <button onClick={() => removeItem(idx)} className="p-1.5 rounded-md text-[var(--color-sys-status-error)]/60 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10 transition-all" > <Trash2 className="w-4 h-4" /> </button> )} </div> </td> </tr> {expandedItems.has(item.po_item_no) && ( <tr className="bg-[var(--color-sys-bg-tertiary)]/5"> <td colSpan={10} className="p-0"> <div className="pb-6 pt-2 pl-12 relative"> <div className="absolute left-[34px] top-0 bottom-6 w-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center justify-between mb-3 border-none pb-2"> <h4 className="text-[10px] font-bold text-[var(--color-sys-text-secondary)] uppercase tracking-[0.2em] flex items-center gap-2"> <Layers size={12} /> Delivery Lots & Schedules </h4> {editMode && ( <button onClick={() => addDelivery(idx)} className="text-[10px] font-bold text-[var(--color-sys-brand-primary)] hover:brightness-110 transition-all uppercase tracking-tight flex items-center bg-[var(--color-sys-brand-primary)]/5 px-2 py-1 rounded-md" > <Plus className="w-3 h-3 mr-1" /> Add Lot </button> )} </div> <div className="space-y-1 relative ml-2"> {/* Vertical Guide Line */} <div className="absolute left-[-14px] top-0 bottom-4 w-px bg-[var(--color-sys-text-tertiary)]/20" /> {item.deliveries && item.deliveries.length > 0 ? ( item.deliveries.map((d, dIdx) => ( <div key={dIdx} className="flex items-center gap-8 py-2 px-4 rounded-lg hover:bg-[var(--color-sys-bg-tertiary)]/10 transition-colors group/lot relative" > {/* Horizontal Connector */} <div className="absolute left-[-14px] top-1/2 w-3 h-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center gap-3 min-w-[60px]"> <span className="text-[11px] font-black text-[var(--color-sys-brand-primary)] font-mono"> L{d.lot_no} </span> </div> <div className="flex items-center gap-2 min-w-[120px] justify-end"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Qty </Label> {editMode ? ( <Input type="number" value={d.delivered_quantity} onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].delivered_quantity = parseFloat(e.target.value); setData({ ...data, items: n }); }} className="h-7 w-20 text-right bg-[var(--color-sys-bg-secondary)] border-none text-[11px] font-bold font-mono" /> ) : ( <Accounting className="text-[11px] font-bold text-[var(--color-sys-text-primary)] font-mono text-right block"> {d.delivered_quantity} </Accounting> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Date </Label> {editMode ? ( <input type="date" value={ d.dely_date ? new Date(d.dely_date).toISOString().split("T")[0] :"" } onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].dely_date = e.target.value; setData({ ...data, items: n }); }} className="h-7 w-28 text-[11px] bg-[var(--color-sys-bg-secondary)] rounded px-2 border-none outline-none text-[var(--color-sys-text-primary)] font-bold" /> ) : ( <Body className="text-[11px] font-bold text-[var(--color-sys-text-secondary)] font-mono"> {formatDate(d.dely_date)} </Body> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Entry By </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono"> {formatDate(d.entry_allow_date)} </SmallText> </div> <div className="flex items-center gap-2 min-w-[80px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Dest </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono uppercase"> {d.dest_code ||"-"} </SmallText> </div> {editMode && ( <div className="ml-auto"> <Button variant="ghost" size="sm" onClick={() => removeDelivery(idx, dIdx)} className="text-[var(--color-sys-status-error)]/40 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10" > <Trash2 className="w-3.5 h-3.5" /> </Button> </div> )} </div> )) ) : ( <div className="flex items-center gap-3 py-4 pl-12"> <SmallText className="text-[var(--color-sys-text-tertiary)]"> Γöö </SmallText> <SmallText className="italic text-[var(--color-sys-text-tertiary)]"> No delivery lots defined for this item </SmallText> </div> )} </div> </div> </td> </tr> )} </React.Fragment> ))} </tbody> </table> </div> </div> </div> </div> {/* Removed fixed floating actions bar for compliance with"no fixed components" rule */} </DocumentTemplate> );
  20 | } export default function PODetailPage() { return ( <Suspense fallback={<DetailSkeleton />}> <PODetailContent /> </Suspense> );

the name `Accounting` is defined multiple times

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:121
Ecmascript file had an error
  15 | import { motion, AnimatePresence } from"framer-motion";
  16 | import dynamic from"next/dynamic";
> 17 | import { DetailSkeleton } from"@/components/design-system/molecules/skeletons/DetailSkeleton"; import { H1, H2, H3, H4, Body, SmallText, Label, Accounting,
     |                                                                                                                         ^^^^
  18 | } from"@/components/design-system/atoms/Typography"; const DocumentJourney = dynamic( () => import("@/components/design-system/molecules/DocumentJourney").then( (mod) => mod.DocumentJourney ), { loading: () => <div className="h-6 w-48 bg-[var(--color-sys-bg-tertiary)] rounded-full animate-pulse" />, ssr: false, }
  19 | ); function PODetailContent() { const router = useRouter(); const params = useParams(); const poId = normalizeId(params?.id as string | string[] ||""); const [data, setData] = useState<PODetail | null>(null); const [loading, setLoading] = useState(true); const [editMode, setEditMode] = useState(false); const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set()); const [hasDC, setHasDC] = useState(false); const [dcId, setDCId] = useState<string | null>(null); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [error, setError] = useState<string | null>(null); // Restore tab state from v2 blueprint const [activeTab, setActiveTab] = useState("basic"); useEffect(() => { if (!poId) return; const loadData = async () => { try { const [poData, dcCheck, srvData] = await Promise.all([ api.getPODetail(poId), api.checkPOHasDC(poId).catch(() => null), api.listSRVs(poId).catch(() => []), ]); setData(poData); if (poData.items) setExpandedItems(new Set(poData.items.map((item: POItem) => item.po_item_no))); if (dcCheck?.has_dc) { setHasDC(true); setDCId(dcCheck.dc_id || null); } // Fix: Ensure we handle potential type mismatch if API returns strictly SRVListItem[] // but Types expects extra fields. For now, we cast or map if necessary. setSrvs((srvData || []) as SRVListItem[]); } catch (err: any) { setError(err.message ||"Traceback failure in record retrieval"); } finally { setLoading(false); } }; loadData(); }, [poId]); const handleSave = useCallback(async () => { if (!data || !data.header) return; setLoading(true); try { await api.updatePO(data.header.po_number, data.header, data.items); setEditMode(false); const poData = await api.getPODetail(poId); setData(poData); } catch (err: any) { setError(err.message ||"Failed to sync changes"); } finally { setLoading(false); } }, [data, poId]); const addItem = useCallback(() => { if (!data || !data.items) return; const maxItemNo = Math.max(...data.items.map((i: POItem) => i.po_item_no || 0), 0); const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"NEW PROCUREMENT ITEM", drg_no:"", unit:"NOS", ordered_quantity: 0, po_rate: 0, item_value: 0, delivered_quantity: 0, deliveries: [], }; setData({ ...data, items: [...data.items, newItem] }); setExpandedItems(new Set([...Array.from(expandedItems), maxItemNo + 1])); }, [data, expandedItems]); const toggleItem = useCallback((itemNo: number) => { const s = new Set(expandedItems); s.has(itemNo) ? s.delete(itemNo) : s.add(itemNo); setExpandedItems(s); }, [expandedItems]); const updateHeader = (field: string, value: any) => { if (!data) return; setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="po_rate" || field ==="ordered_quantity") { newItems[index].item_value = (newItems[index].ordered_quantity || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const addDelivery = (itemIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; const item = newItems[itemIdx]; const maxLotNo = Math.max(...(item.deliveries?.map((d: PODelivery) => d.lot_no || 0) || []), 0); const newLot = { lot_no: maxLotNo + 1, delivered_quantity: 0, dely_date: new Date().toISOString().split("T")[0], }; newItems[itemIdx].deliveries = [...(item.deliveries || []), newLot]; setData({ ...data, items: newItems }); }; const removeDelivery = (itemIdx: number, deliveryIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[itemIdx].deliveries = newItems[itemIdx].deliveries.filter((_, i) => i !== deliveryIdx); setData({ ...data, items: newItems }); }; const removeItem = (index: number) => { if (!data || !data.items) return; const newItems = data.items.filter((_, i) => i !== index); setData({ ...data, items: newItems }); }; const handleEnableEdit = useCallback(() => setEditMode(true), []); const handleDisableEdit = useCallback(() => setEditMode(false), []); if (loading || !data || !data.header) { return <DetailSkeleton />; } const { header, items } = data; const topActions = ( <div className="flex items-center gap-2.5"> {editMode ? ( <> <Button variant="outline" size="sm" onClick={() => setEditMode(false)} className="text-[var(--color-sys-status-error)] border-[var(--color-sys-status-error)]/20 shadow-sm" > <X className="w-3.5 h-3.5 mr-2" /> Discard </Button> <Button variant="default" size="sm" onClick={handleSave}> <Save className="w-3.5 h-3.5 mr-2" /> SAVE CHANGES </Button> </> ) : ( <> <Button variant="outline" size="sm" asChild className="text-[var(--color-sys-status-success)] border-[var(--color-sys-status-success)]/20 bg-[var(--color-sys-status-success)]/10 hover:bg-[var(--color-sys-status-success)]/20 hover:text-[var(--color-sys-status-success)]" > <a href={`${api.baseUrl}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-3.5 h-3.5 mr-2" /> EXCEL </a> </Button> <Button variant="outline" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("border-[var(--color-sys-text-tertiary)]/20", hasDC ?"bg-[var(--color-sys-status-success)]/10 text-[var(--color-sys-status-success)] shadow-sm border-[var(--color-sys-status-success)]/20" :"text-[var(--color-sys-text-secondary)]" )} > <FileText className="w-3.5 h-3.5 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Button variant="default" size="sm" onClick={handleEnableEdit}> <Edit2 className="w-3.5 h-3.5 mr-2" /> MODIFY </Button> </> )} </div> ); // Using Atomic Components for Fields - Unified for Zero Layout Shift const Field = ({ label, value, field, readonly = false, }: { label: string; value: any; field?: string; readonly?: boolean; }) => { return ( <div className="min-h-[44px] flex flex-col justify-center"> <Label className="mb-1.5 font-bold text-[var(--color-sys-text-secondary)]">{label}</Label> {editMode && field && !readonly ? ( <Input value={value ??""} onChange={(e) => updateHeader(field, e.target.value)} className="h-7 text-body px-2 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none focus:shadow-sm font-medium text-[var(--color-sys-text-primary)]" /> ) : ( <Body className="font-medium text-sys-primary leading-tight py-1 truncate" title={value?.toString()} > {value || ( <span className="text-sys-tertiary font-normal italic opacity-60 uppercase tracking-tighter text-label"> Empty </span> )} </Body> )} </div> ); }; // ≡ƒÄ¿ VISUAL UPGRADE: Actions (Moved from fixed bar to standard top actions for compliance) const renderActions = () => { if (editMode) { return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" onClick={() => setEditMode(false)} className="text-sys-secondary hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <X className="w-4 h-4 mr-2" /> DISCARD </Button> <Button variant="default" size="sm" onClick={handleSave} className="bg-[var(--color-sys-brand-primary)] hover:brightness-110 text-[var(--color-sys-text-on-brand)] shadow-sm text-small" > <Save className="w-4 h-4 mr-2" /> SAVE CHANGES </Button> </Flex> ); } return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" asChild className="text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <a href={`${API_BASE_URL}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-4 h-4 mr-2 text-[var(--color-sys-brand-primary)]" /> EXCEL </a> </Button> <Button variant="ghost" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small", hasDC &&"text-[var(--color-sys-status-success)]" )} > <FileText className="w-4 h-4 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Box className="w-[1px] h-6 bg-[var(--color-sys-text-tertiary)]/10 mx-1" /> <Button variant="default" size="sm" onClick={handleEnableEdit} className="bg-[var(--color-sys-brand-primary)] text-[var(--color-sys-text-on-brand)] hover:brightness-110 shadow-lg text-small" > <Edit2 className="w-4 h-4 mr-2 text-[var(--color-sys-text-on-brand)]" /> MODIFY RECORD </Button> </Flex> ); }; return ( <DocumentTemplate title={`PO #${header.po_number}`} description={`${header.supplier_name} ΓÇó ${formatDate(header.po_date)}`} actions={renderActions()} onBack={() => router.back()} layoutId={`po-title-${header.po_number}`} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId={`po-icon-${header.po_number}`} status={header.po_status} > <div className="space-y-6"> {/* Document Journey */} <DocumentJourney currentStage="PO" className="mb-2" /> {/* V2 Layout: Comprehensive Tabs */} <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> <TabsList className="mb-4 bg-transparent p-0 border-b border-[var(--color-sys-text-tertiary)]/10 w-full justify-start rounded-none gap-6"> <TabsTrigger value="basic"> <Info className="w-3.5 h-3.5 mr-1.5" /> Basic </TabsTrigger> <TabsTrigger value="references"> <FileText className="w-3.5 h-3.5 mr-1.5" /> Refs </TabsTrigger> <TabsTrigger value="financial"> <Landmark className="w-3.5 h-3.5 mr-1.5" /> Finance </TabsTrigger> <TabsTrigger value="issuer"> <ShieldCheck className="w-3.5 h-3.5 mr-1.5" /> Issuer </TabsTrigger> <TabsTrigger value="srvs"> <Receipt className="w-3.5 h-3.5 mr-1.5" /> SRVs ({srvs.length}) </TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.15 }} > <GlassContainer className="p-6 min-h-[180px] border-none shadow-sm mt-0 relative top-[-1px]"> <TabsContent value="basic" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Number" value={header.po_number} field="po_number" readonly /> <Field label="PO Date" value={formatDate(header.po_date)} field="po_date" readonly /> <Field label="Supplier Name" value={header.supplier_name} field="supplier_name" /> <Field label="Supplier Code" value={header.supplier_code} field="supplier_code" /> <Field label="Phone" value={header.supplier_phone} field="supplier_phone" /> <Field label="Fax" value={header.supplier_fax} field="supplier_fax" /> <Field label="Email" value={header.supplier_email} field="supplier_email" /> <Field label="Dept No (DVN)" value={header.department_no} field="department_no" /> </div> </TabsContent> <TabsContent value="references" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Enquiry No" value={header.enquiry_no} field="enquiry_no" /> <Field label="Enquiry Date" value={formatDate(header.enquiry_date)} field="enquiry_date" /> <Field label="Quotation Ref" value={header.quotation_ref} field="quotation_ref" /> <Field label="Quotation Date" value={formatDate(header.quotation_date)} field="quotation_date" /> <Field label="RC No" value={header.rc_no} field="rc_no" /> <Field label="Order Type" value={header.order_type} field="order_type" /> <Field label="PO Status" value={header.po_status} field="po_status" /> <Field label="Amd No" value={header.amend_no} field="amend_no" /> </div> </TabsContent> <TabsContent value="financial" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Value" value={formatIndianCurrency(header.po_value)} field="po_value" /> <Field label="FOB Value" value={formatIndianCurrency(header.fob_value)} field="fob_value" /> <Field label="Net Value" value={formatIndianCurrency(header.net_po_value)} field="net_po_value" /> <Field label="TIN No" value={header.tin_no} field="tin_no" /> <Field label="ECC No" value={header.ecc_no} field="ecc_no" /> <Field label="MPCT No" value={header.mpct_no} field="mpct_no" /> <Field label="Currency" value={header.currency} field="currency" /> <Field label="Ex Rate" value={header.ex_rate} field="ex_rate" /> </div> </TabsContent> <TabsContent value="issuer" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Inspection By" value={header.inspection_by} field="inspection_by" /> <Field label="Issuer Name" value={header.issuer_name} field="issuer_name" /> <Field label="Designation" value={header.issuer_designation} field="issuer_designation" /> <Field label="Issuer Phone" value={header.issuer_phone} field="issuer_phone" /> {/* Truncated Remarks Section to Save a Row */} <div className="col-span-2 md:col-span-4 mt-2"> <div className="flex flex-col"> <Label className="mb-1 font-bold text-sys-secondary"> Remarks </Label> {editMode ? ( <input value={header.remarks ||""} onChange={(e) => updateHeader("remarks", e.target.value)} className="w-full h-8 px-2 text-body border-none bg-[var(--color-sys-bg-tertiary)]/50 rounded focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none font-medium text-sys-primary" placeholder="Enter remarks..." /> ) : ( <div className="text-body text-sys-primary font-normal line-clamp-1 italic px-0.5 opacity-90" title={header.remarks ||""} > {header.remarks ||"No remarks provided."} </div> )} </div> </div> </div> </TabsContent> <TabsContent value="srvs" className="m-0"> {srvs.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {srvs.map((srv) => ( <div key={srv.srv_number} className="p-4 rounded-xl shadow-sm bg-[var(--color-sys-bg-tertiary)]/10 hover:bg-[var(--color-sys-brand-primary)]/[0.03] hover:shadow-md transition-all duration-300 group cursor-pointer border border-[var(--color-sys-text-tertiary)]/10" onClick={() => router.push(`/srv/${srv.srv_number}`)} > <div className="flex justify-between items-start mb-3"> <div className="space-y-0.5"> <Label className="font-bold text-sys-primary group-hover:text-sys-brand cursor-pointer"> SRV-{srv.srv_number} </Label> <SmallText className="font-medium text-sys-tertiary flex items-center gap-1 uppercase tracking-tighter"> <Calendar className="w-2.5 h-2.5" /> {formatDate(srv.srv_date)} </SmallText> </div> <div className="flex flex-col items-end gap-1.5"> <div className="w-6 h-6 rounded-lg bg-[var(--color-sys-brand-primary)]/10 flex items-center justify-center text-sys-brand shadow-sm border border-[var(--color-sys-brand-primary)]/20"> <Receipt className="w-3 h-3" /> </div> {srv.invoice_numbers && ( <Badge variant="default" className="text-h4 py-0 px-1.5 h-5 font-bold" > INV: {srv.invoice_numbers.split(",")[0]} </Badge> )} </div> </div> <div className="grid grid-cols-2 pt-2 border-t border-[var(--color-sys-text-tertiary)]/10 gap-2"> <div> <div className="text-h4 font-bold text-sys-success uppercase tracking-widest leading-tight"> Accepted </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_accepted_qty || 0}</Accounting> </div> </div> <div className="text-right"> <div className="text-h4 font-bold text-sys-error uppercase tracking-widest leading-tight"> Rejected </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_rejected_qty || 0}</Accounting> </div> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-6 text-[var(--color-sys-text-tertiary)] italic"> No linked SRVs found. </div> )} </TabsContent> </GlassContainer> </motion.div> </AnimatePresence> </Tabs> {/* Items & Deliveries - Custom Table matching Atomic Vibe + V2 Layout */} <div className="space-y-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-2"> <Label className="m-0 text-body font-black text-sys-secondary"> Bill of Materials </Label> </div> {editMode && ( <Button size="sm" onClick={addItem} variant="ghost" className="h-8 text-small bg-[var(--color-sys-bg-tertiary)] text-sys-primary hover:bg-[var(--color-sys-bg-secondary)] font-bold" > <Plus className="w-3.5 h-3.5 mr-1.5" /> ADD ITEM </Button> )} </div> <div className="overflow-hidden rounded-2xl bg-[var(--color-sys-bg-primary)] shadow-xl shadow-[var(--color-sys-brand-primary)]/5 border-none"> <div className="overflow-x-auto"> <table className="w-full text-left"> <thead className="bg-[var(--color-sys-bg-tertiary)]/50"> <tr> <th className="py-2.5 px-4 table-header-text text-center w-12">#</th> <th className="py-2.5 px-4 table-header-text text-left w-32">Code</th> <th className="py-2.5 px-4 table-header-text text-left">Description</th> <th className="py-2.5 px-4 table-header-text text-left w-20">Unit</th> <th className="py-2.5 px-4 table-header-text text-right w-28">Rate</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Ord</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Dlv</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Bal</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Rec</th> <th className="py-2.5 px-4 w-12"></th> </tr> </thead> <tbody className="min-h-[200px]"> {items.map((item, idx) => ( <React.Fragment key={item.po_item_no}> <tr className={cn("hover:bg-[var(--color-sys-bg-secondary)] transition-colors group", expandedItems.has(item.po_item_no) ?"bg-[var(--color-sys-bg-secondary)]/50" :"" )} > <td className="py-2 px-4 text-center align-top pt-3.5 italic table-cell-text"> {idx + 1} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.material_code} onChange={(e) => updateItem(idx,"material_code", e.target.value)} className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-number" /> ) : ( <Accounting className="tracking-tighter table-cell-number"> {item.material_code} </Accounting> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <div className="space-y-1"> <Input value={item.material_description} onChange={(e) => updateItem(idx,"material_description", e.target.value) } className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-text" /> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value)} placeholder="Drawing" className="h-6 text-small w-32 px-1.5 py-0.5 border-none bg-[var(--color-sys-bg-tertiary)] font-medium text-[var(--color-sys-text-primary)]" /> </div> ) : ( <div className="space-y-0.5"> <div className="font-medium leading-tight truncate max-w-[400px] table-cell-text" title={item.material_description} > {item.material_description} </div> {item.drg_no && ( <div className="text-h4 font-medium text-sys-brand uppercase tracking-tight"> DRG: {item.drg_no} </div> )} </div> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value)} className="h-7 text-body w-14 px-1 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-sys-primary" /> ) : ( <SmallText className="text-sys-secondary uppercase font-bold"> {item.unit} </SmallText> )} </td> <td className="py-2 px-4 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.po_rate} onChange={(e) => updateItem(idx,"po_rate", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1.5 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1.5 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number font-mono text-right block"> {formatIndianCurrency(item.po_rate)} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.ordered_quantity} onChange={(e) => updateItem(idx,"ordered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {item.ordered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.delivered_quantity} onChange={(e) => updateItem(idx,"delivered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-mono font-medium text-sys-brand focus:bg-[var(--color-sys-brand-primary)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-sys-brand tracking-tighter table-cell-number text-right block font-mono"> {item.delivered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {(item.ordered_quantity || 0) - (item.received_quantity || 0)} </Accounting> </div> </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.received_quantity} onChange={(e) => updateItem(idx,"received_quantity", parseFloat(e.target.value)) } className="h-7 text-[13px] text-right w-full px-1 py-1 font-mono font-medium text-[var(--color-sys-status-success)] focus:bg-[var(--color-sys-status-success)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-[var(--color-sys-status-success)] tracking-tighter table-cell-number text-right block font-mono"> {item.received_quantity} </Accounting> </div> )} </td> <td className="py-2 px-4 align-top pt-2"> <div className="flex flex-col gap-1 items-center"> <button onClick={() => toggleItem(item.po_item_no)} className={cn("p-1.5 rounded-md transition-all text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-text-primary)]", expandedItems.has(item.po_item_no) &&"text-[var(--color-sys-brand-primary)] bg-[var(--color-sys-brand-primary)]/10" )} > {expandedItems.has(item.po_item_no) ? ( <ChevronUp className="w-4 h-4" /> ) : ( <ChevronDown className="w-4 h-4" /> )} </button> {editMode && ( <button onClick={() => removeItem(idx)} className="p-1.5 rounded-md text-[var(--color-sys-status-error)]/60 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10 transition-all" > <Trash2 className="w-4 h-4" /> </button> )} </div> </td> </tr> {expandedItems.has(item.po_item_no) && ( <tr className="bg-[var(--color-sys-bg-tertiary)]/5"> <td colSpan={10} className="p-0"> <div className="pb-6 pt-2 pl-12 relative"> <div className="absolute left-[34px] top-0 bottom-6 w-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center justify-between mb-3 border-none pb-2"> <h4 className="text-[10px] font-bold text-[var(--color-sys-text-secondary)] uppercase tracking-[0.2em] flex items-center gap-2"> <Layers size={12} /> Delivery Lots & Schedules </h4> {editMode && ( <button onClick={() => addDelivery(idx)} className="text-[10px] font-bold text-[var(--color-sys-brand-primary)] hover:brightness-110 transition-all uppercase tracking-tight flex items-center bg-[var(--color-sys-brand-primary)]/5 px-2 py-1 rounded-md" > <Plus className="w-3 h-3 mr-1" /> Add Lot </button> )} </div> <div className="space-y-1 relative ml-2"> {/* Vertical Guide Line */} <div className="absolute left-[-14px] top-0 bottom-4 w-px bg-[var(--color-sys-text-tertiary)]/20" /> {item.deliveries && item.deliveries.length > 0 ? ( item.deliveries.map((d, dIdx) => ( <div key={dIdx} className="flex items-center gap-8 py-2 px-4 rounded-lg hover:bg-[var(--color-sys-bg-tertiary)]/10 transition-colors group/lot relative" > {/* Horizontal Connector */} <div className="absolute left-[-14px] top-1/2 w-3 h-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center gap-3 min-w-[60px]"> <span className="text-[11px] font-black text-[var(--color-sys-brand-primary)] font-mono"> L{d.lot_no} </span> </div> <div className="flex items-center gap-2 min-w-[120px] justify-end"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Qty </Label> {editMode ? ( <Input type="number" value={d.delivered_quantity} onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].delivered_quantity = parseFloat(e.target.value); setData({ ...data, items: n }); }} className="h-7 w-20 text-right bg-[var(--color-sys-bg-secondary)] border-none text-[11px] font-bold font-mono" /> ) : ( <Accounting className="text-[11px] font-bold text-[var(--color-sys-text-primary)] font-mono text-right block"> {d.delivered_quantity} </Accounting> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Date </Label> {editMode ? ( <input type="date" value={ d.dely_date ? new Date(d.dely_date).toISOString().split("T")[0] :"" } onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].dely_date = e.target.value; setData({ ...data, items: n }); }} className="h-7 w-28 text-[11px] bg-[var(--color-sys-bg-secondary)] rounded px-2 border-none outline-none text-[var(--color-sys-text-primary)] font-bold" /> ) : ( <Body className="text-[11px] font-bold text-[var(--color-sys-text-secondary)] font-mono"> {formatDate(d.dely_date)} </Body> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Entry By </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono"> {formatDate(d.entry_allow_date)} </SmallText> </div> <div className="flex items-center gap-2 min-w-[80px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Dest </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono uppercase"> {d.dest_code ||"-"} </SmallText> </div> {editMode && ( <div className="ml-auto"> <Button variant="ghost" size="sm" onClick={() => removeDelivery(idx, dIdx)} className="text-[var(--color-sys-status-error)]/40 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10" > <Trash2 className="w-3.5 h-3.5" /> </Button> </div> )} </div> )) ) : ( <div className="flex items-center gap-3 py-4 pl-12"> <SmallText className="text-[var(--color-sys-text-tertiary)]"> Γöö </SmallText> <SmallText className="italic text-[var(--color-sys-text-tertiary)]"> No delivery lots defined for this item </SmallText> </div> )} </div> </div> </td> </tr> )} </React.Fragment> ))} </tbody> </table> </div> </div> </div> </div> {/* Removed fixed floating actions bar for compliance with"no fixed components" rule */} </DocumentTemplate> );
  20 | } export default function PODetailPage() { return ( <Suspense fallback={<DetailSkeleton />}> <PODetailContent /> </Suspense> );

the name `Body` is defined multiple times

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:105
Ecmascript file had an error
  15 | import { motion, AnimatePresence } from"framer-motion";
  16 | import dynamic from"next/dynamic";
> 17 | import { DetailSkeleton } from"@/components/design-system/molecules/skeletons/DetailSkeleton"; import { H1, H2, H3, H4, Body, SmallText, Label, Accounting,
     |                                                                                                         ^^
  18 | } from"@/components/design-system/atoms/Typography"; const DocumentJourney = dynamic( () => import("@/components/design-system/molecules/DocumentJourney").then( (mod) => mod.DocumentJourney ), { loading: () => <div className="h-6 w-48 bg-[var(--color-sys-bg-tertiary)] rounded-full animate-pulse" />, ssr: false, }
  19 | ); function PODetailContent() { const router = useRouter(); const params = useParams(); const poId = normalizeId(params?.id as string | string[] ||""); const [data, setData] = useState<PODetail | null>(null); const [loading, setLoading] = useState(true); const [editMode, setEditMode] = useState(false); const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set()); const [hasDC, setHasDC] = useState(false); const [dcId, setDCId] = useState<string | null>(null); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [error, setError] = useState<string | null>(null); // Restore tab state from v2 blueprint const [activeTab, setActiveTab] = useState("basic"); useEffect(() => { if (!poId) return; const loadData = async () => { try { const [poData, dcCheck, srvData] = await Promise.all([ api.getPODetail(poId), api.checkPOHasDC(poId).catch(() => null), api.listSRVs(poId).catch(() => []), ]); setData(poData); if (poData.items) setExpandedItems(new Set(poData.items.map((item: POItem) => item.po_item_no))); if (dcCheck?.has_dc) { setHasDC(true); setDCId(dcCheck.dc_id || null); } // Fix: Ensure we handle potential type mismatch if API returns strictly SRVListItem[] // but Types expects extra fields. For now, we cast or map if necessary. setSrvs((srvData || []) as SRVListItem[]); } catch (err: any) { setError(err.message ||"Traceback failure in record retrieval"); } finally { setLoading(false); } }; loadData(); }, [poId]); const handleSave = useCallback(async () => { if (!data || !data.header) return; setLoading(true); try { await api.updatePO(data.header.po_number, data.header, data.items); setEditMode(false); const poData = await api.getPODetail(poId); setData(poData); } catch (err: any) { setError(err.message ||"Failed to sync changes"); } finally { setLoading(false); } }, [data, poId]); const addItem = useCallback(() => { if (!data || !data.items) return; const maxItemNo = Math.max(...data.items.map((i: POItem) => i.po_item_no || 0), 0); const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"NEW PROCUREMENT ITEM", drg_no:"", unit:"NOS", ordered_quantity: 0, po_rate: 0, item_value: 0, delivered_quantity: 0, deliveries: [], }; setData({ ...data, items: [...data.items, newItem] }); setExpandedItems(new Set([...Array.from(expandedItems), maxItemNo + 1])); }, [data, expandedItems]); const toggleItem = useCallback((itemNo: number) => { const s = new Set(expandedItems); s.has(itemNo) ? s.delete(itemNo) : s.add(itemNo); setExpandedItems(s); }, [expandedItems]); const updateHeader = (field: string, value: any) => { if (!data) return; setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="po_rate" || field ==="ordered_quantity") { newItems[index].item_value = (newItems[index].ordered_quantity || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const addDelivery = (itemIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; const item = newItems[itemIdx]; const maxLotNo = Math.max(...(item.deliveries?.map((d: PODelivery) => d.lot_no || 0) || []), 0); const newLot = { lot_no: maxLotNo + 1, delivered_quantity: 0, dely_date: new Date().toISOString().split("T")[0], }; newItems[itemIdx].deliveries = [...(item.deliveries || []), newLot]; setData({ ...data, items: newItems }); }; const removeDelivery = (itemIdx: number, deliveryIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[itemIdx].deliveries = newItems[itemIdx].deliveries.filter((_, i) => i !== deliveryIdx); setData({ ...data, items: newItems }); }; const removeItem = (index: number) => { if (!data || !data.items) return; const newItems = data.items.filter((_, i) => i !== index); setData({ ...data, items: newItems }); }; const handleEnableEdit = useCallback(() => setEditMode(true), []); const handleDisableEdit = useCallback(() => setEditMode(false), []); if (loading || !data || !data.header) { return <DetailSkeleton />; } const { header, items } = data; const topActions = ( <div className="flex items-center gap-2.5"> {editMode ? ( <> <Button variant="outline" size="sm" onClick={() => setEditMode(false)} className="text-[var(--color-sys-status-error)] border-[var(--color-sys-status-error)]/20 shadow-sm" > <X className="w-3.5 h-3.5 mr-2" /> Discard </Button> <Button variant="default" size="sm" onClick={handleSave}> <Save className="w-3.5 h-3.5 mr-2" /> SAVE CHANGES </Button> </> ) : ( <> <Button variant="outline" size="sm" asChild className="text-[var(--color-sys-status-success)] border-[var(--color-sys-status-success)]/20 bg-[var(--color-sys-status-success)]/10 hover:bg-[var(--color-sys-status-success)]/20 hover:text-[var(--color-sys-status-success)]" > <a href={`${api.baseUrl}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-3.5 h-3.5 mr-2" /> EXCEL </a> </Button> <Button variant="outline" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("border-[var(--color-sys-text-tertiary)]/20", hasDC ?"bg-[var(--color-sys-status-success)]/10 text-[var(--color-sys-status-success)] shadow-sm border-[var(--color-sys-status-success)]/20" :"text-[var(--color-sys-text-secondary)]" )} > <FileText className="w-3.5 h-3.5 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Button variant="default" size="sm" onClick={handleEnableEdit}> <Edit2 className="w-3.5 h-3.5 mr-2" /> MODIFY </Button> </> )} </div> ); // Using Atomic Components for Fields - Unified for Zero Layout Shift const Field = ({ label, value, field, readonly = false, }: { label: string; value: any; field?: string; readonly?: boolean; }) => { return ( <div className="min-h-[44px] flex flex-col justify-center"> <Label className="mb-1.5 font-bold text-[var(--color-sys-text-secondary)]">{label}</Label> {editMode && field && !readonly ? ( <Input value={value ??""} onChange={(e) => updateHeader(field, e.target.value)} className="h-7 text-body px-2 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none focus:shadow-sm font-medium text-[var(--color-sys-text-primary)]" /> ) : ( <Body className="font-medium text-sys-primary leading-tight py-1 truncate" title={value?.toString()} > {value || ( <span className="text-sys-tertiary font-normal italic opacity-60 uppercase tracking-tighter text-label"> Empty </span> )} </Body> )} </div> ); }; // ≡ƒÄ¿ VISUAL UPGRADE: Actions (Moved from fixed bar to standard top actions for compliance) const renderActions = () => { if (editMode) { return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" onClick={() => setEditMode(false)} className="text-sys-secondary hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <X className="w-4 h-4 mr-2" /> DISCARD </Button> <Button variant="default" size="sm" onClick={handleSave} className="bg-[var(--color-sys-brand-primary)] hover:brightness-110 text-[var(--color-sys-text-on-brand)] shadow-sm text-small" > <Save className="w-4 h-4 mr-2" /> SAVE CHANGES </Button> </Flex> ); } return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" asChild className="text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <a href={`${API_BASE_URL}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-4 h-4 mr-2 text-[var(--color-sys-brand-primary)]" /> EXCEL </a> </Button> <Button variant="ghost" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small", hasDC &&"text-[var(--color-sys-status-success)]" )} > <FileText className="w-4 h-4 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Box className="w-[1px] h-6 bg-[var(--color-sys-text-tertiary)]/10 mx-1" /> <Button variant="default" size="sm" onClick={handleEnableEdit} className="bg-[var(--color-sys-brand-primary)] text-[var(--color-sys-text-on-brand)] hover:brightness-110 shadow-lg text-small" > <Edit2 className="w-4 h-4 mr-2 text-[var(--color-sys-text-on-brand)]" /> MODIFY RECORD </Button> </Flex> ); }; return ( <DocumentTemplate title={`PO #${header.po_number}`} description={`${header.supplier_name} ΓÇó ${formatDate(header.po_date)}`} actions={renderActions()} onBack={() => router.back()} layoutId={`po-title-${header.po_number}`} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId={`po-icon-${header.po_number}`} status={header.po_status} > <div className="space-y-6"> {/* Document Journey */} <DocumentJourney currentStage="PO" className="mb-2" /> {/* V2 Layout: Comprehensive Tabs */} <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> <TabsList className="mb-4 bg-transparent p-0 border-b border-[var(--color-sys-text-tertiary)]/10 w-full justify-start rounded-none gap-6"> <TabsTrigger value="basic"> <Info className="w-3.5 h-3.5 mr-1.5" /> Basic </TabsTrigger> <TabsTrigger value="references"> <FileText className="w-3.5 h-3.5 mr-1.5" /> Refs </TabsTrigger> <TabsTrigger value="financial"> <Landmark className="w-3.5 h-3.5 mr-1.5" /> Finance </TabsTrigger> <TabsTrigger value="issuer"> <ShieldCheck className="w-3.5 h-3.5 mr-1.5" /> Issuer </TabsTrigger> <TabsTrigger value="srvs"> <Receipt className="w-3.5 h-3.5 mr-1.5" /> SRVs ({srvs.length}) </TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.15 }} > <GlassContainer className="p-6 min-h-[180px] border-none shadow-sm mt-0 relative top-[-1px]"> <TabsContent value="basic" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Number" value={header.po_number} field="po_number" readonly /> <Field label="PO Date" value={formatDate(header.po_date)} field="po_date" readonly /> <Field label="Supplier Name" value={header.supplier_name} field="supplier_name" /> <Field label="Supplier Code" value={header.supplier_code} field="supplier_code" /> <Field label="Phone" value={header.supplier_phone} field="supplier_phone" /> <Field label="Fax" value={header.supplier_fax} field="supplier_fax" /> <Field label="Email" value={header.supplier_email} field="supplier_email" /> <Field label="Dept No (DVN)" value={header.department_no} field="department_no" /> </div> </TabsContent> <TabsContent value="references" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Enquiry No" value={header.enquiry_no} field="enquiry_no" /> <Field label="Enquiry Date" value={formatDate(header.enquiry_date)} field="enquiry_date" /> <Field label="Quotation Ref" value={header.quotation_ref} field="quotation_ref" /> <Field label="Quotation Date" value={formatDate(header.quotation_date)} field="quotation_date" /> <Field label="RC No" value={header.rc_no} field="rc_no" /> <Field label="Order Type" value={header.order_type} field="order_type" /> <Field label="PO Status" value={header.po_status} field="po_status" /> <Field label="Amd No" value={header.amend_no} field="amend_no" /> </div> </TabsContent> <TabsContent value="financial" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Value" value={formatIndianCurrency(header.po_value)} field="po_value" /> <Field label="FOB Value" value={formatIndianCurrency(header.fob_value)} field="fob_value" /> <Field label="Net Value" value={formatIndianCurrency(header.net_po_value)} field="net_po_value" /> <Field label="TIN No" value={header.tin_no} field="tin_no" /> <Field label="ECC No" value={header.ecc_no} field="ecc_no" /> <Field label="MPCT No" value={header.mpct_no} field="mpct_no" /> <Field label="Currency" value={header.currency} field="currency" /> <Field label="Ex Rate" value={header.ex_rate} field="ex_rate" /> </div> </TabsContent> <TabsContent value="issuer" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Inspection By" value={header.inspection_by} field="inspection_by" /> <Field label="Issuer Name" value={header.issuer_name} field="issuer_name" /> <Field label="Designation" value={header.issuer_designation} field="issuer_designation" /> <Field label="Issuer Phone" value={header.issuer_phone} field="issuer_phone" /> {/* Truncated Remarks Section to Save a Row */} <div className="col-span-2 md:col-span-4 mt-2"> <div className="flex flex-col"> <Label className="mb-1 font-bold text-sys-secondary"> Remarks </Label> {editMode ? ( <input value={header.remarks ||""} onChange={(e) => updateHeader("remarks", e.target.value)} className="w-full h-8 px-2 text-body border-none bg-[var(--color-sys-bg-tertiary)]/50 rounded focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none font-medium text-sys-primary" placeholder="Enter remarks..." /> ) : ( <div className="text-body text-sys-primary font-normal line-clamp-1 italic px-0.5 opacity-90" title={header.remarks ||""} > {header.remarks ||"No remarks provided."} </div> )} </div> </div> </div> </TabsContent> <TabsContent value="srvs" className="m-0"> {srvs.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {srvs.map((srv) => ( <div key={srv.srv_number} className="p-4 rounded-xl shadow-sm bg-[var(--color-sys-bg-tertiary)]/10 hover:bg-[var(--color-sys-brand-primary)]/[0.03] hover:shadow-md transition-all duration-300 group cursor-pointer border border-[var(--color-sys-text-tertiary)]/10" onClick={() => router.push(`/srv/${srv.srv_number}`)} > <div className="flex justify-between items-start mb-3"> <div className="space-y-0.5"> <Label className="font-bold text-sys-primary group-hover:text-sys-brand cursor-pointer"> SRV-{srv.srv_number} </Label> <SmallText className="font-medium text-sys-tertiary flex items-center gap-1 uppercase tracking-tighter"> <Calendar className="w-2.5 h-2.5" /> {formatDate(srv.srv_date)} </SmallText> </div> <div className="flex flex-col items-end gap-1.5"> <div className="w-6 h-6 rounded-lg bg-[var(--color-sys-brand-primary)]/10 flex items-center justify-center text-sys-brand shadow-sm border border-[var(--color-sys-brand-primary)]/20"> <Receipt className="w-3 h-3" /> </div> {srv.invoice_numbers && ( <Badge variant="default" className="text-h4 py-0 px-1.5 h-5 font-bold" > INV: {srv.invoice_numbers.split(",")[0]} </Badge> )} </div> </div> <div className="grid grid-cols-2 pt-2 border-t border-[var(--color-sys-text-tertiary)]/10 gap-2"> <div> <div className="text-h4 font-bold text-sys-success uppercase tracking-widest leading-tight"> Accepted </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_accepted_qty || 0}</Accounting> </div> </div> <div className="text-right"> <div className="text-h4 font-bold text-sys-error uppercase tracking-widest leading-tight"> Rejected </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_rejected_qty || 0}</Accounting> </div> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-6 text-[var(--color-sys-text-tertiary)] italic"> No linked SRVs found. </div> )} </TabsContent> </GlassContainer> </motion.div> </AnimatePresence> </Tabs> {/* Items & Deliveries - Custom Table matching Atomic Vibe + V2 Layout */} <div className="space-y-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-2"> <Label className="m-0 text-body font-black text-sys-secondary"> Bill of Materials </Label> </div> {editMode && ( <Button size="sm" onClick={addItem} variant="ghost" className="h-8 text-small bg-[var(--color-sys-bg-tertiary)] text-sys-primary hover:bg-[var(--color-sys-bg-secondary)] font-bold" > <Plus className="w-3.5 h-3.5 mr-1.5" /> ADD ITEM </Button> )} </div> <div className="overflow-hidden rounded-2xl bg-[var(--color-sys-bg-primary)] shadow-xl shadow-[var(--color-sys-brand-primary)]/5 border-none"> <div className="overflow-x-auto"> <table className="w-full text-left"> <thead className="bg-[var(--color-sys-bg-tertiary)]/50"> <tr> <th className="py-2.5 px-4 table-header-text text-center w-12">#</th> <th className="py-2.5 px-4 table-header-text text-left w-32">Code</th> <th className="py-2.5 px-4 table-header-text text-left">Description</th> <th className="py-2.5 px-4 table-header-text text-left w-20">Unit</th> <th className="py-2.5 px-4 table-header-text text-right w-28">Rate</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Ord</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Dlv</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Bal</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Rec</th> <th className="py-2.5 px-4 w-12"></th> </tr> </thead> <tbody className="min-h-[200px]"> {items.map((item, idx) => ( <React.Fragment key={item.po_item_no}> <tr className={cn("hover:bg-[var(--color-sys-bg-secondary)] transition-colors group", expandedItems.has(item.po_item_no) ?"bg-[var(--color-sys-bg-secondary)]/50" :"" )} > <td className="py-2 px-4 text-center align-top pt-3.5 italic table-cell-text"> {idx + 1} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.material_code} onChange={(e) => updateItem(idx,"material_code", e.target.value)} className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-number" /> ) : ( <Accounting className="tracking-tighter table-cell-number"> {item.material_code} </Accounting> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <div className="space-y-1"> <Input value={item.material_description} onChange={(e) => updateItem(idx,"material_description", e.target.value) } className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-text" /> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value)} placeholder="Drawing" className="h-6 text-small w-32 px-1.5 py-0.5 border-none bg-[var(--color-sys-bg-tertiary)] font-medium text-[var(--color-sys-text-primary)]" /> </div> ) : ( <div className="space-y-0.5"> <div className="font-medium leading-tight truncate max-w-[400px] table-cell-text" title={item.material_description} > {item.material_description} </div> {item.drg_no && ( <div className="text-h4 font-medium text-sys-brand uppercase tracking-tight"> DRG: {item.drg_no} </div> )} </div> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value)} className="h-7 text-body w-14 px-1 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-sys-primary" /> ) : ( <SmallText className="text-sys-secondary uppercase font-bold"> {item.unit} </SmallText> )} </td> <td className="py-2 px-4 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.po_rate} onChange={(e) => updateItem(idx,"po_rate", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1.5 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1.5 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number font-mono text-right block"> {formatIndianCurrency(item.po_rate)} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.ordered_quantity} onChange={(e) => updateItem(idx,"ordered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {item.ordered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.delivered_quantity} onChange={(e) => updateItem(idx,"delivered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-mono font-medium text-sys-brand focus:bg-[var(--color-sys-brand-primary)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-sys-brand tracking-tighter table-cell-number text-right block font-mono"> {item.delivered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {(item.ordered_quantity || 0) - (item.received_quantity || 0)} </Accounting> </div> </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.received_quantity} onChange={(e) => updateItem(idx,"received_quantity", parseFloat(e.target.value)) } className="h-7 text-[13px] text-right w-full px-1 py-1 font-mono font-medium text-[var(--color-sys-status-success)] focus:bg-[var(--color-sys-status-success)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-[var(--color-sys-status-success)] tracking-tighter table-cell-number text-right block font-mono"> {item.received_quantity} </Accounting> </div> )} </td> <td className="py-2 px-4 align-top pt-2"> <div className="flex flex-col gap-1 items-center"> <button onClick={() => toggleItem(item.po_item_no)} className={cn("p-1.5 rounded-md transition-all text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-text-primary)]", expandedItems.has(item.po_item_no) &&"text-[var(--color-sys-brand-primary)] bg-[var(--color-sys-brand-primary)]/10" )} > {expandedItems.has(item.po_item_no) ? ( <ChevronUp className="w-4 h-4" /> ) : ( <ChevronDown className="w-4 h-4" /> )} </button> {editMode && ( <button onClick={() => removeItem(idx)} className="p-1.5 rounded-md text-[var(--color-sys-status-error)]/60 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10 transition-all" > <Trash2 className="w-4 h-4" /> </button> )} </div> </td> </tr> {expandedItems.has(item.po_item_no) && ( <tr className="bg-[var(--color-sys-bg-tertiary)]/5"> <td colSpan={10} className="p-0"> <div className="pb-6 pt-2 pl-12 relative"> <div className="absolute left-[34px] top-0 bottom-6 w-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center justify-between mb-3 border-none pb-2"> <h4 className="text-[10px] font-bold text-[var(--color-sys-text-secondary)] uppercase tracking-[0.2em] flex items-center gap-2"> <Layers size={12} /> Delivery Lots & Schedules </h4> {editMode && ( <button onClick={() => addDelivery(idx)} className="text-[10px] font-bold text-[var(--color-sys-brand-primary)] hover:brightness-110 transition-all uppercase tracking-tight flex items-center bg-[var(--color-sys-brand-primary)]/5 px-2 py-1 rounded-md" > <Plus className="w-3 h-3 mr-1" /> Add Lot </button> )} </div> <div className="space-y-1 relative ml-2"> {/* Vertical Guide Line */} <div className="absolute left-[-14px] top-0 bottom-4 w-px bg-[var(--color-sys-text-tertiary)]/20" /> {item.deliveries && item.deliveries.length > 0 ? ( item.deliveries.map((d, dIdx) => ( <div key={dIdx} className="flex items-center gap-8 py-2 px-4 rounded-lg hover:bg-[var(--color-sys-bg-tertiary)]/10 transition-colors group/lot relative" > {/* Horizontal Connector */} <div className="absolute left-[-14px] top-1/2 w-3 h-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center gap-3 min-w-[60px]"> <span className="text-[11px] font-black text-[var(--color-sys-brand-primary)] font-mono"> L{d.lot_no} </span> </div> <div className="flex items-center gap-2 min-w-[120px] justify-end"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Qty </Label> {editMode ? ( <Input type="number" value={d.delivered_quantity} onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].delivered_quantity = parseFloat(e.target.value); setData({ ...data, items: n }); }} className="h-7 w-20 text-right bg-[var(--color-sys-bg-secondary)] border-none text-[11px] font-bold font-mono" /> ) : ( <Accounting className="text-[11px] font-bold text-[var(--color-sys-text-primary)] font-mono text-right block"> {d.delivered_quantity} </Accounting> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Date </Label> {editMode ? ( <input type="date" value={ d.dely_date ? new Date(d.dely_date).toISOString().split("T")[0] :"" } onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].dely_date = e.target.value; setData({ ...data, items: n }); }} className="h-7 w-28 text-[11px] bg-[var(--color-sys-bg-secondary)] rounded px-2 border-none outline-none text-[var(--color-sys-text-primary)] font-bold" /> ) : ( <Body className="text-[11px] font-bold text-[var(--color-sys-text-secondary)] font-mono"> {formatDate(d.dely_date)} </Body> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Entry By </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono"> {formatDate(d.entry_allow_date)} </SmallText> </div> <div className="flex items-center gap-2 min-w-[80px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Dest </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono uppercase"> {d.dest_code ||"-"} </SmallText> </div> {editMode && ( <div className="ml-auto"> <Button variant="ghost" size="sm" onClick={() => removeDelivery(idx, dIdx)} className="text-[var(--color-sys-status-error)]/40 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10" > <Trash2 className="w-3.5 h-3.5" /> </Button> </div> )} </div> )) ) : ( <div className="flex items-center gap-3 py-4 pl-12"> <SmallText className="text-[var(--color-sys-text-tertiary)]"> Γöö </SmallText> <SmallText className="italic text-[var(--color-sys-text-tertiary)]"> No delivery lots defined for this item </SmallText> </div> )} </div> </div> </td> </tr> )} </React.Fragment> ))} </tbody> </table> </div> </div> </div> </div> {/* Removed fixed floating actions bar for compliance with"no fixed components" rule */} </DocumentTemplate> );
  20 | } export default function PODetailPage() { return ( <Suspense fallback={<DetailSkeleton />}> <PODetailContent /> </Suspense> );

the name `H1` is defined multiple times

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:113
Ecmascript file had an error
  15 | import { motion, AnimatePresence } from"framer-motion";
  16 | import dynamic from"next/dynamic";
> 17 | import { DetailSkeleton } from"@/components/design-system/molecules/skeletons/DetailSkeleton"; import { H1, H2, H3, H4, Body, SmallText, Label, Accounting,
     |                                                                                                                 ^^
  18 | } from"@/components/design-system/atoms/Typography"; const DocumentJourney = dynamic( () => import("@/components/design-system/molecules/DocumentJourney").then( (mod) => mod.DocumentJourney ), { loading: () => <div className="h-6 w-48 bg-[var(--color-sys-bg-tertiary)] rounded-full animate-pulse" />, ssr: false, }
  19 | ); function PODetailContent() { const router = useRouter(); const params = useParams(); const poId = normalizeId(params?.id as string | string[] ||""); const [data, setData] = useState<PODetail | null>(null); const [loading, setLoading] = useState(true); const [editMode, setEditMode] = useState(false); const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set()); const [hasDC, setHasDC] = useState(false); const [dcId, setDCId] = useState<string | null>(null); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [error, setError] = useState<string | null>(null); // Restore tab state from v2 blueprint const [activeTab, setActiveTab] = useState("basic"); useEffect(() => { if (!poId) return; const loadData = async () => { try { const [poData, dcCheck, srvData] = await Promise.all([ api.getPODetail(poId), api.checkPOHasDC(poId).catch(() => null), api.listSRVs(poId).catch(() => []), ]); setData(poData); if (poData.items) setExpandedItems(new Set(poData.items.map((item: POItem) => item.po_item_no))); if (dcCheck?.has_dc) { setHasDC(true); setDCId(dcCheck.dc_id || null); } // Fix: Ensure we handle potential type mismatch if API returns strictly SRVListItem[] // but Types expects extra fields. For now, we cast or map if necessary. setSrvs((srvData || []) as SRVListItem[]); } catch (err: any) { setError(err.message ||"Traceback failure in record retrieval"); } finally { setLoading(false); } }; loadData(); }, [poId]); const handleSave = useCallback(async () => { if (!data || !data.header) return; setLoading(true); try { await api.updatePO(data.header.po_number, data.header, data.items); setEditMode(false); const poData = await api.getPODetail(poId); setData(poData); } catch (err: any) { setError(err.message ||"Failed to sync changes"); } finally { setLoading(false); } }, [data, poId]); const addItem = useCallback(() => { if (!data || !data.items) return; const maxItemNo = Math.max(...data.items.map((i: POItem) => i.po_item_no || 0), 0); const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"NEW PROCUREMENT ITEM", drg_no:"", unit:"NOS", ordered_quantity: 0, po_rate: 0, item_value: 0, delivered_quantity: 0, deliveries: [], }; setData({ ...data, items: [...data.items, newItem] }); setExpandedItems(new Set([...Array.from(expandedItems), maxItemNo + 1])); }, [data, expandedItems]); const toggleItem = useCallback((itemNo: number) => { const s = new Set(expandedItems); s.has(itemNo) ? s.delete(itemNo) : s.add(itemNo); setExpandedItems(s); }, [expandedItems]); const updateHeader = (field: string, value: any) => { if (!data) return; setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="po_rate" || field ==="ordered_quantity") { newItems[index].item_value = (newItems[index].ordered_quantity || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const addDelivery = (itemIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; const item = newItems[itemIdx]; const maxLotNo = Math.max(...(item.deliveries?.map((d: PODelivery) => d.lot_no || 0) || []), 0); const newLot = { lot_no: maxLotNo + 1, delivered_quantity: 0, dely_date: new Date().toISOString().split("T")[0], }; newItems[itemIdx].deliveries = [...(item.deliveries || []), newLot]; setData({ ...data, items: newItems }); }; const removeDelivery = (itemIdx: number, deliveryIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[itemIdx].deliveries = newItems[itemIdx].deliveries.filter((_, i) => i !== deliveryIdx); setData({ ...data, items: newItems }); }; const removeItem = (index: number) => { if (!data || !data.items) return; const newItems = data.items.filter((_, i) => i !== index); setData({ ...data, items: newItems }); }; const handleEnableEdit = useCallback(() => setEditMode(true), []); const handleDisableEdit = useCallback(() => setEditMode(false), []); if (loading || !data || !data.header) { return <DetailSkeleton />; } const { header, items } = data; const topActions = ( <div className="flex items-center gap-2.5"> {editMode ? ( <> <Button variant="outline" size="sm" onClick={() => setEditMode(false)} className="text-[var(--color-sys-status-error)] border-[var(--color-sys-status-error)]/20 shadow-sm" > <X className="w-3.5 h-3.5 mr-2" /> Discard </Button> <Button variant="default" size="sm" onClick={handleSave}> <Save className="w-3.5 h-3.5 mr-2" /> SAVE CHANGES </Button> </> ) : ( <> <Button variant="outline" size="sm" asChild className="text-[var(--color-sys-status-success)] border-[var(--color-sys-status-success)]/20 bg-[var(--color-sys-status-success)]/10 hover:bg-[var(--color-sys-status-success)]/20 hover:text-[var(--color-sys-status-success)]" > <a href={`${api.baseUrl}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-3.5 h-3.5 mr-2" /> EXCEL </a> </Button> <Button variant="outline" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("border-[var(--color-sys-text-tertiary)]/20", hasDC ?"bg-[var(--color-sys-status-success)]/10 text-[var(--color-sys-status-success)] shadow-sm border-[var(--color-sys-status-success)]/20" :"text-[var(--color-sys-text-secondary)]" )} > <FileText className="w-3.5 h-3.5 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Button variant="default" size="sm" onClick={handleEnableEdit}> <Edit2 className="w-3.5 h-3.5 mr-2" /> MODIFY </Button> </> )} </div> ); // Using Atomic Components for Fields - Unified for Zero Layout Shift const Field = ({ label, value, field, readonly = false, }: { label: string; value: any; field?: string; readonly?: boolean; }) => { return ( <div className="min-h-[44px] flex flex-col justify-center"> <Label className="mb-1.5 font-bold text-[var(--color-sys-text-secondary)]">{label}</Label> {editMode && field && !readonly ? ( <Input value={value ??""} onChange={(e) => updateHeader(field, e.target.value)} className="h-7 text-body px-2 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none focus:shadow-sm font-medium text-[var(--color-sys-text-primary)]" /> ) : ( <Body className="font-medium text-sys-primary leading-tight py-1 truncate" title={value?.toString()} > {value || ( <span className="text-sys-tertiary font-normal italic opacity-60 uppercase tracking-tighter text-label"> Empty </span> )} </Body> )} </div> ); }; // ≡ƒÄ¿ VISUAL UPGRADE: Actions (Moved from fixed bar to standard top actions for compliance) const renderActions = () => { if (editMode) { return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" onClick={() => setEditMode(false)} className="text-sys-secondary hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <X className="w-4 h-4 mr-2" /> DISCARD </Button> <Button variant="default" size="sm" onClick={handleSave} className="bg-[var(--color-sys-brand-primary)] hover:brightness-110 text-[var(--color-sys-text-on-brand)] shadow-sm text-small" > <Save className="w-4 h-4 mr-2" /> SAVE CHANGES </Button> </Flex> ); } return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" asChild className="text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <a href={`${API_BASE_URL}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-4 h-4 mr-2 text-[var(--color-sys-brand-primary)]" /> EXCEL </a> </Button> <Button variant="ghost" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small", hasDC &&"text-[var(--color-sys-status-success)]" )} > <FileText className="w-4 h-4 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Box className="w-[1px] h-6 bg-[var(--color-sys-text-tertiary)]/10 mx-1" /> <Button variant="default" size="sm" onClick={handleEnableEdit} className="bg-[var(--color-sys-brand-primary)] text-[var(--color-sys-text-on-brand)] hover:brightness-110 shadow-lg text-small" > <Edit2 className="w-4 h-4 mr-2 text-[var(--color-sys-text-on-brand)]" /> MODIFY RECORD </Button> </Flex> ); }; return ( <DocumentTemplate title={`PO #${header.po_number}`} description={`${header.supplier_name} ΓÇó ${formatDate(header.po_date)}`} actions={renderActions()} onBack={() => router.back()} layoutId={`po-title-${header.po_number}`} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId={`po-icon-${header.po_number}`} status={header.po_status} > <div className="space-y-6"> {/* Document Journey */} <DocumentJourney currentStage="PO" className="mb-2" /> {/* V2 Layout: Comprehensive Tabs */} <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> <TabsList className="mb-4 bg-transparent p-0 border-b border-[var(--color-sys-text-tertiary)]/10 w-full justify-start rounded-none gap-6"> <TabsTrigger value="basic"> <Info className="w-3.5 h-3.5 mr-1.5" /> Basic </TabsTrigger> <TabsTrigger value="references"> <FileText className="w-3.5 h-3.5 mr-1.5" /> Refs </TabsTrigger> <TabsTrigger value="financial"> <Landmark className="w-3.5 h-3.5 mr-1.5" /> Finance </TabsTrigger> <TabsTrigger value="issuer"> <ShieldCheck className="w-3.5 h-3.5 mr-1.5" /> Issuer </TabsTrigger> <TabsTrigger value="srvs"> <Receipt className="w-3.5 h-3.5 mr-1.5" /> SRVs ({srvs.length}) </TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.15 }} > <GlassContainer className="p-6 min-h-[180px] border-none shadow-sm mt-0 relative top-[-1px]"> <TabsContent value="basic" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Number" value={header.po_number} field="po_number" readonly /> <Field label="PO Date" value={formatDate(header.po_date)} field="po_date" readonly /> <Field label="Supplier Name" value={header.supplier_name} field="supplier_name" /> <Field label="Supplier Code" value={header.supplier_code} field="supplier_code" /> <Field label="Phone" value={header.supplier_phone} field="supplier_phone" /> <Field label="Fax" value={header.supplier_fax} field="supplier_fax" /> <Field label="Email" value={header.supplier_email} field="supplier_email" /> <Field label="Dept No (DVN)" value={header.department_no} field="department_no" /> </div> </TabsContent> <TabsContent value="references" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Enquiry No" value={header.enquiry_no} field="enquiry_no" /> <Field label="Enquiry Date" value={formatDate(header.enquiry_date)} field="enquiry_date" /> <Field label="Quotation Ref" value={header.quotation_ref} field="quotation_ref" /> <Field label="Quotation Date" value={formatDate(header.quotation_date)} field="quotation_date" /> <Field label="RC No" value={header.rc_no} field="rc_no" /> <Field label="Order Type" value={header.order_type} field="order_type" /> <Field label="PO Status" value={header.po_status} field="po_status" /> <Field label="Amd No" value={header.amend_no} field="amend_no" /> </div> </TabsContent> <TabsContent value="financial" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Value" value={formatIndianCurrency(header.po_value)} field="po_value" /> <Field label="FOB Value" value={formatIndianCurrency(header.fob_value)} field="fob_value" /> <Field label="Net Value" value={formatIndianCurrency(header.net_po_value)} field="net_po_value" /> <Field label="TIN No" value={header.tin_no} field="tin_no" /> <Field label="ECC No" value={header.ecc_no} field="ecc_no" /> <Field label="MPCT No" value={header.mpct_no} field="mpct_no" /> <Field label="Currency" value={header.currency} field="currency" /> <Field label="Ex Rate" value={header.ex_rate} field="ex_rate" /> </div> </TabsContent> <TabsContent value="issuer" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Inspection By" value={header.inspection_by} field="inspection_by" /> <Field label="Issuer Name" value={header.issuer_name} field="issuer_name" /> <Field label="Designation" value={header.issuer_designation} field="issuer_designation" /> <Field label="Issuer Phone" value={header.issuer_phone} field="issuer_phone" /> {/* Truncated Remarks Section to Save a Row */} <div className="col-span-2 md:col-span-4 mt-2"> <div className="flex flex-col"> <Label className="mb-1 font-bold text-sys-secondary"> Remarks </Label> {editMode ? ( <input value={header.remarks ||""} onChange={(e) => updateHeader("remarks", e.target.value)} className="w-full h-8 px-2 text-body border-none bg-[var(--color-sys-bg-tertiary)]/50 rounded focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none font-medium text-sys-primary" placeholder="Enter remarks..." /> ) : ( <div className="text-body text-sys-primary font-normal line-clamp-1 italic px-0.5 opacity-90" title={header.remarks ||""} > {header.remarks ||"No remarks provided."} </div> )} </div> </div> </div> </TabsContent> <TabsContent value="srvs" className="m-0"> {srvs.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {srvs.map((srv) => ( <div key={srv.srv_number} className="p-4 rounded-xl shadow-sm bg-[var(--color-sys-bg-tertiary)]/10 hover:bg-[var(--color-sys-brand-primary)]/[0.03] hover:shadow-md transition-all duration-300 group cursor-pointer border border-[var(--color-sys-text-tertiary)]/10" onClick={() => router.push(`/srv/${srv.srv_number}`)} > <div className="flex justify-between items-start mb-3"> <div className="space-y-0.5"> <Label className="font-bold text-sys-primary group-hover:text-sys-brand cursor-pointer"> SRV-{srv.srv_number} </Label> <SmallText className="font-medium text-sys-tertiary flex items-center gap-1 uppercase tracking-tighter"> <Calendar className="w-2.5 h-2.5" /> {formatDate(srv.srv_date)} </SmallText> </div> <div className="flex flex-col items-end gap-1.5"> <div className="w-6 h-6 rounded-lg bg-[var(--color-sys-brand-primary)]/10 flex items-center justify-center text-sys-brand shadow-sm border border-[var(--color-sys-brand-primary)]/20"> <Receipt className="w-3 h-3" /> </div> {srv.invoice_numbers && ( <Badge variant="default" className="text-h4 py-0 px-1.5 h-5 font-bold" > INV: {srv.invoice_numbers.split(",")[0]} </Badge> )} </div> </div> <div className="grid grid-cols-2 pt-2 border-t border-[var(--color-sys-text-tertiary)]/10 gap-2"> <div> <div className="text-h4 font-bold text-sys-success uppercase tracking-widest leading-tight"> Accepted </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_accepted_qty || 0}</Accounting> </div> </div> <div className="text-right"> <div className="text-h4 font-bold text-sys-error uppercase tracking-widest leading-tight"> Rejected </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_rejected_qty || 0}</Accounting> </div> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-6 text-[var(--color-sys-text-tertiary)] italic"> No linked SRVs found. </div> )} </TabsContent> </GlassContainer> </motion.div> </AnimatePresence> </Tabs> {/* Items & Deliveries - Custom Table matching Atomic Vibe + V2 Layout */} <div className="space-y-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-2"> <Label className="m-0 text-body font-black text-sys-secondary"> Bill of Materials </Label> </div> {editMode && ( <Button size="sm" onClick={addItem} variant="ghost" className="h-8 text-small bg-[var(--color-sys-bg-tertiary)] text-sys-primary hover:bg-[var(--color-sys-bg-secondary)] font-bold" > <Plus className="w-3.5 h-3.5 mr-1.5" /> ADD ITEM </Button> )} </div> <div className="overflow-hidden rounded-2xl bg-[var(--color-sys-bg-primary)] shadow-xl shadow-[var(--color-sys-brand-primary)]/5 border-none"> <div className="overflow-x-auto"> <table className="w-full text-left"> <thead className="bg-[var(--color-sys-bg-tertiary)]/50"> <tr> <th className="py-2.5 px-4 table-header-text text-center w-12">#</th> <th className="py-2.5 px-4 table-header-text text-left w-32">Code</th> <th className="py-2.5 px-4 table-header-text text-left">Description</th> <th className="py-2.5 px-4 table-header-text text-left w-20">Unit</th> <th className="py-2.5 px-4 table-header-text text-right w-28">Rate</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Ord</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Dlv</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Bal</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Rec</th> <th className="py-2.5 px-4 w-12"></th> </tr> </thead> <tbody className="min-h-[200px]"> {items.map((item, idx) => ( <React.Fragment key={item.po_item_no}> <tr className={cn("hover:bg-[var(--color-sys-bg-secondary)] transition-colors group", expandedItems.has(item.po_item_no) ?"bg-[var(--color-sys-bg-secondary)]/50" :"" )} > <td className="py-2 px-4 text-center align-top pt-3.5 italic table-cell-text"> {idx + 1} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.material_code} onChange={(e) => updateItem(idx,"material_code", e.target.value)} className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-number" /> ) : ( <Accounting className="tracking-tighter table-cell-number"> {item.material_code} </Accounting> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <div className="space-y-1"> <Input value={item.material_description} onChange={(e) => updateItem(idx,"material_description", e.target.value) } className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-text" /> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value)} placeholder="Drawing" className="h-6 text-small w-32 px-1.5 py-0.5 border-none bg-[var(--color-sys-bg-tertiary)] font-medium text-[var(--color-sys-text-primary)]" /> </div> ) : ( <div className="space-y-0.5"> <div className="font-medium leading-tight truncate max-w-[400px] table-cell-text" title={item.material_description} > {item.material_description} </div> {item.drg_no && ( <div className="text-h4 font-medium text-sys-brand uppercase tracking-tight"> DRG: {item.drg_no} </div> )} </div> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value)} className="h-7 text-body w-14 px-1 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-sys-primary" /> ) : ( <SmallText className="text-sys-secondary uppercase font-bold"> {item.unit} </SmallText> )} </td> <td className="py-2 px-4 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.po_rate} onChange={(e) => updateItem(idx,"po_rate", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1.5 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1.5 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number font-mono text-right block"> {formatIndianCurrency(item.po_rate)} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.ordered_quantity} onChange={(e) => updateItem(idx,"ordered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {item.ordered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.delivered_quantity} onChange={(e) => updateItem(idx,"delivered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-mono font-medium text-sys-brand focus:bg-[var(--color-sys-brand-primary)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-sys-brand tracking-tighter table-cell-number text-right block font-mono"> {item.delivered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {(item.ordered_quantity || 0) - (item.received_quantity || 0)} </Accounting> </div> </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.received_quantity} onChange={(e) => updateItem(idx,"received_quantity", parseFloat(e.target.value)) } className="h-7 text-[13px] text-right w-full px-1 py-1 font-mono font-medium text-[var(--color-sys-status-success)] focus:bg-[var(--color-sys-status-success)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-[var(--color-sys-status-success)] tracking-tighter table-cell-number text-right block font-mono"> {item.received_quantity} </Accounting> </div> )} </td> <td className="py-2 px-4 align-top pt-2"> <div className="flex flex-col gap-1 items-center"> <button onClick={() => toggleItem(item.po_item_no)} className={cn("p-1.5 rounded-md transition-all text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-text-primary)]", expandedItems.has(item.po_item_no) &&"text-[var(--color-sys-brand-primary)] bg-[var(--color-sys-brand-primary)]/10" )} > {expandedItems.has(item.po_item_no) ? ( <ChevronUp className="w-4 h-4" /> ) : ( <ChevronDown className="w-4 h-4" /> )} </button> {editMode && ( <button onClick={() => removeItem(idx)} className="p-1.5 rounded-md text-[var(--color-sys-status-error)]/60 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10 transition-all" > <Trash2 className="w-4 h-4" /> </button> )} </div> </td> </tr> {expandedItems.has(item.po_item_no) && ( <tr className="bg-[var(--color-sys-bg-tertiary)]/5"> <td colSpan={10} className="p-0"> <div className="pb-6 pt-2 pl-12 relative"> <div className="absolute left-[34px] top-0 bottom-6 w-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center justify-between mb-3 border-none pb-2"> <h4 className="text-[10px] font-bold text-[var(--color-sys-text-secondary)] uppercase tracking-[0.2em] flex items-center gap-2"> <Layers size={12} /> Delivery Lots & Schedules </h4> {editMode && ( <button onClick={() => addDelivery(idx)} className="text-[10px] font-bold text-[var(--color-sys-brand-primary)] hover:brightness-110 transition-all uppercase tracking-tight flex items-center bg-[var(--color-sys-brand-primary)]/5 px-2 py-1 rounded-md" > <Plus className="w-3 h-3 mr-1" /> Add Lot </button> )} </div> <div className="space-y-1 relative ml-2"> {/* Vertical Guide Line */} <div className="absolute left-[-14px] top-0 bottom-4 w-px bg-[var(--color-sys-text-tertiary)]/20" /> {item.deliveries && item.deliveries.length > 0 ? ( item.deliveries.map((d, dIdx) => ( <div key={dIdx} className="flex items-center gap-8 py-2 px-4 rounded-lg hover:bg-[var(--color-sys-bg-tertiary)]/10 transition-colors group/lot relative" > {/* Horizontal Connector */} <div className="absolute left-[-14px] top-1/2 w-3 h-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center gap-3 min-w-[60px]"> <span className="text-[11px] font-black text-[var(--color-sys-brand-primary)] font-mono"> L{d.lot_no} </span> </div> <div className="flex items-center gap-2 min-w-[120px] justify-end"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Qty </Label> {editMode ? ( <Input type="number" value={d.delivered_quantity} onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].delivered_quantity = parseFloat(e.target.value); setData({ ...data, items: n }); }} className="h-7 w-20 text-right bg-[var(--color-sys-bg-secondary)] border-none text-[11px] font-bold font-mono" /> ) : ( <Accounting className="text-[11px] font-bold text-[var(--color-sys-text-primary)] font-mono text-right block"> {d.delivered_quantity} </Accounting> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Date </Label> {editMode ? ( <input type="date" value={ d.dely_date ? new Date(d.dely_date).toISOString().split("T")[0] :"" } onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].dely_date = e.target.value; setData({ ...data, items: n }); }} className="h-7 w-28 text-[11px] bg-[var(--color-sys-bg-secondary)] rounded px-2 border-none outline-none text-[var(--color-sys-text-primary)] font-bold" /> ) : ( <Body className="text-[11px] font-bold text-[var(--color-sys-text-secondary)] font-mono"> {formatDate(d.dely_date)} </Body> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Entry By </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono"> {formatDate(d.entry_allow_date)} </SmallText> </div> <div className="flex items-center gap-2 min-w-[80px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Dest </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono uppercase"> {d.dest_code ||"-"} </SmallText> </div> {editMode && ( <div className="ml-auto"> <Button variant="ghost" size="sm" onClick={() => removeDelivery(idx, dIdx)} className="text-[var(--color-sys-status-error)]/40 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10" > <Trash2 className="w-3.5 h-3.5" /> </Button> </div> )} </div> )) ) : ( <div className="flex items-center gap-3 py-4 pl-12"> <SmallText className="text-[var(--color-sys-text-tertiary)]"> Γöö </SmallText> <SmallText className="italic text-[var(--color-sys-text-tertiary)]"> No delivery lots defined for this item </SmallText> </div> )} </div> </div> </td> </tr> )} </React.Fragment> ))} </tbody> </table> </div> </div> </div> </div> {/* Removed fixed floating actions bar for compliance with"no fixed components" rule */} </DocumentTemplate> );
  20 | } export default function PODetailPage() { return ( <Suspense fallback={<DetailSkeleton />}> <PODetailContent /> </Suspense> );

the name `H3` is defined multiple times

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:138
Ecmascript file had an error
  15 | import { motion, AnimatePresence } from"framer-motion";
  16 | import dynamic from"next/dynamic";
> 17 | import { DetailSkeleton } from"@/components/design-system/molecules/skeletons/DetailSkeleton"; import { H1, H2, H3, H4, Body, SmallText, Label, Accounting,
     |                                                                                                                                          ^^^^^
  18 | } from"@/components/design-system/atoms/Typography"; const DocumentJourney = dynamic( () => import("@/components/design-system/molecules/DocumentJourney").then( (mod) => mod.DocumentJourney ), { loading: () => <div className="h-6 w-48 bg-[var(--color-sys-bg-tertiary)] rounded-full animate-pulse" />, ssr: false, }
  19 | ); function PODetailContent() { const router = useRouter(); const params = useParams(); const poId = normalizeId(params?.id as string | string[] ||""); const [data, setData] = useState<PODetail | null>(null); const [loading, setLoading] = useState(true); const [editMode, setEditMode] = useState(false); const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set()); const [hasDC, setHasDC] = useState(false); const [dcId, setDCId] = useState<string | null>(null); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [error, setError] = useState<string | null>(null); // Restore tab state from v2 blueprint const [activeTab, setActiveTab] = useState("basic"); useEffect(() => { if (!poId) return; const loadData = async () => { try { const [poData, dcCheck, srvData] = await Promise.all([ api.getPODetail(poId), api.checkPOHasDC(poId).catch(() => null), api.listSRVs(poId).catch(() => []), ]); setData(poData); if (poData.items) setExpandedItems(new Set(poData.items.map((item: POItem) => item.po_item_no))); if (dcCheck?.has_dc) { setHasDC(true); setDCId(dcCheck.dc_id || null); } // Fix: Ensure we handle potential type mismatch if API returns strictly SRVListItem[] // but Types expects extra fields. For now, we cast or map if necessary. setSrvs((srvData || []) as SRVListItem[]); } catch (err: any) { setError(err.message ||"Traceback failure in record retrieval"); } finally { setLoading(false); } }; loadData(); }, [poId]); const handleSave = useCallback(async () => { if (!data || !data.header) return; setLoading(true); try { await api.updatePO(data.header.po_number, data.header, data.items); setEditMode(false); const poData = await api.getPODetail(poId); setData(poData); } catch (err: any) { setError(err.message ||"Failed to sync changes"); } finally { setLoading(false); } }, [data, poId]); const addItem = useCallback(() => { if (!data || !data.items) return; const maxItemNo = Math.max(...data.items.map((i: POItem) => i.po_item_no || 0), 0); const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"NEW PROCUREMENT ITEM", drg_no:"", unit:"NOS", ordered_quantity: 0, po_rate: 0, item_value: 0, delivered_quantity: 0, deliveries: [], }; setData({ ...data, items: [...data.items, newItem] }); setExpandedItems(new Set([...Array.from(expandedItems), maxItemNo + 1])); }, [data, expandedItems]); const toggleItem = useCallback((itemNo: number) => { const s = new Set(expandedItems); s.has(itemNo) ? s.delete(itemNo) : s.add(itemNo); setExpandedItems(s); }, [expandedItems]); const updateHeader = (field: string, value: any) => { if (!data) return; setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="po_rate" || field ==="ordered_quantity") { newItems[index].item_value = (newItems[index].ordered_quantity || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const addDelivery = (itemIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; const item = newItems[itemIdx]; const maxLotNo = Math.max(...(item.deliveries?.map((d: PODelivery) => d.lot_no || 0) || []), 0); const newLot = { lot_no: maxLotNo + 1, delivered_quantity: 0, dely_date: new Date().toISOString().split("T")[0], }; newItems[itemIdx].deliveries = [...(item.deliveries || []), newLot]; setData({ ...data, items: newItems }); }; const removeDelivery = (itemIdx: number, deliveryIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[itemIdx].deliveries = newItems[itemIdx].deliveries.filter((_, i) => i !== deliveryIdx); setData({ ...data, items: newItems }); }; const removeItem = (index: number) => { if (!data || !data.items) return; const newItems = data.items.filter((_, i) => i !== index); setData({ ...data, items: newItems }); }; const handleEnableEdit = useCallback(() => setEditMode(true), []); const handleDisableEdit = useCallback(() => setEditMode(false), []); if (loading || !data || !data.header) { return <DetailSkeleton />; } const { header, items } = data; const topActions = ( <div className="flex items-center gap-2.5"> {editMode ? ( <> <Button variant="outline" size="sm" onClick={() => setEditMode(false)} className="text-[var(--color-sys-status-error)] border-[var(--color-sys-status-error)]/20 shadow-sm" > <X className="w-3.5 h-3.5 mr-2" /> Discard </Button> <Button variant="default" size="sm" onClick={handleSave}> <Save className="w-3.5 h-3.5 mr-2" /> SAVE CHANGES </Button> </> ) : ( <> <Button variant="outline" size="sm" asChild className="text-[var(--color-sys-status-success)] border-[var(--color-sys-status-success)]/20 bg-[var(--color-sys-status-success)]/10 hover:bg-[var(--color-sys-status-success)]/20 hover:text-[var(--color-sys-status-success)]" > <a href={`${api.baseUrl}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-3.5 h-3.5 mr-2" /> EXCEL </a> </Button> <Button variant="outline" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("border-[var(--color-sys-text-tertiary)]/20", hasDC ?"bg-[var(--color-sys-status-success)]/10 text-[var(--color-sys-status-success)] shadow-sm border-[var(--color-sys-status-success)]/20" :"text-[var(--color-sys-text-secondary)]" )} > <FileText className="w-3.5 h-3.5 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Button variant="default" size="sm" onClick={handleEnableEdit}> <Edit2 className="w-3.5 h-3.5 mr-2" /> MODIFY </Button> </> )} </div> ); // Using Atomic Components for Fields - Unified for Zero Layout Shift const Field = ({ label, value, field, readonly = false, }: { label: string; value: any; field?: string; readonly?: boolean; }) => { return ( <div className="min-h-[44px] flex flex-col justify-center"> <Label className="mb-1.5 font-bold text-[var(--color-sys-text-secondary)]">{label}</Label> {editMode && field && !readonly ? ( <Input value={value ??""} onChange={(e) => updateHeader(field, e.target.value)} className="h-7 text-body px-2 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none focus:shadow-sm font-medium text-[var(--color-sys-text-primary)]" /> ) : ( <Body className="font-medium text-sys-primary leading-tight py-1 truncate" title={value?.toString()} > {value || ( <span className="text-sys-tertiary font-normal italic opacity-60 uppercase tracking-tighter text-label"> Empty </span> )} </Body> )} </div> ); }; // ≡ƒÄ¿ VISUAL UPGRADE: Actions (Moved from fixed bar to standard top actions for compliance) const renderActions = () => { if (editMode) { return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" onClick={() => setEditMode(false)} className="text-sys-secondary hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <X className="w-4 h-4 mr-2" /> DISCARD </Button> <Button variant="default" size="sm" onClick={handleSave} className="bg-[var(--color-sys-brand-primary)] hover:brightness-110 text-[var(--color-sys-text-on-brand)] shadow-sm text-small" > <Save className="w-4 h-4 mr-2" /> SAVE CHANGES </Button> </Flex> ); } return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" asChild className="text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <a href={`${API_BASE_URL}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-4 h-4 mr-2 text-[var(--color-sys-brand-primary)]" /> EXCEL </a> </Button> <Button variant="ghost" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small", hasDC &&"text-[var(--color-sys-status-success)]" )} > <FileText className="w-4 h-4 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Box className="w-[1px] h-6 bg-[var(--color-sys-text-tertiary)]/10 mx-1" /> <Button variant="default" size="sm" onClick={handleEnableEdit} className="bg-[var(--color-sys-brand-primary)] text-[var(--color-sys-text-on-brand)] hover:brightness-110 shadow-lg text-small" > <Edit2 className="w-4 h-4 mr-2 text-[var(--color-sys-text-on-brand)]" /> MODIFY RECORD </Button> </Flex> ); }; return ( <DocumentTemplate title={`PO #${header.po_number}`} description={`${header.supplier_name} ΓÇó ${formatDate(header.po_date)}`} actions={renderActions()} onBack={() => router.back()} layoutId={`po-title-${header.po_number}`} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId={`po-icon-${header.po_number}`} status={header.po_status} > <div className="space-y-6"> {/* Document Journey */} <DocumentJourney currentStage="PO" className="mb-2" /> {/* V2 Layout: Comprehensive Tabs */} <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> <TabsList className="mb-4 bg-transparent p-0 border-b border-[var(--color-sys-text-tertiary)]/10 w-full justify-start rounded-none gap-6"> <TabsTrigger value="basic"> <Info className="w-3.5 h-3.5 mr-1.5" /> Basic </TabsTrigger> <TabsTrigger value="references"> <FileText className="w-3.5 h-3.5 mr-1.5" /> Refs </TabsTrigger> <TabsTrigger value="financial"> <Landmark className="w-3.5 h-3.5 mr-1.5" /> Finance </TabsTrigger> <TabsTrigger value="issuer"> <ShieldCheck className="w-3.5 h-3.5 mr-1.5" /> Issuer </TabsTrigger> <TabsTrigger value="srvs"> <Receipt className="w-3.5 h-3.5 mr-1.5" /> SRVs ({srvs.length}) </TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.15 }} > <GlassContainer className="p-6 min-h-[180px] border-none shadow-sm mt-0 relative top-[-1px]"> <TabsContent value="basic" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Number" value={header.po_number} field="po_number" readonly /> <Field label="PO Date" value={formatDate(header.po_date)} field="po_date" readonly /> <Field label="Supplier Name" value={header.supplier_name} field="supplier_name" /> <Field label="Supplier Code" value={header.supplier_code} field="supplier_code" /> <Field label="Phone" value={header.supplier_phone} field="supplier_phone" /> <Field label="Fax" value={header.supplier_fax} field="supplier_fax" /> <Field label="Email" value={header.supplier_email} field="supplier_email" /> <Field label="Dept No (DVN)" value={header.department_no} field="department_no" /> </div> </TabsContent> <TabsContent value="references" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Enquiry No" value={header.enquiry_no} field="enquiry_no" /> <Field label="Enquiry Date" value={formatDate(header.enquiry_date)} field="enquiry_date" /> <Field label="Quotation Ref" value={header.quotation_ref} field="quotation_ref" /> <Field label="Quotation Date" value={formatDate(header.quotation_date)} field="quotation_date" /> <Field label="RC No" value={header.rc_no} field="rc_no" /> <Field label="Order Type" value={header.order_type} field="order_type" /> <Field label="PO Status" value={header.po_status} field="po_status" /> <Field label="Amd No" value={header.amend_no} field="amend_no" /> </div> </TabsContent> <TabsContent value="financial" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Value" value={formatIndianCurrency(header.po_value)} field="po_value" /> <Field label="FOB Value" value={formatIndianCurrency(header.fob_value)} field="fob_value" /> <Field label="Net Value" value={formatIndianCurrency(header.net_po_value)} field="net_po_value" /> <Field label="TIN No" value={header.tin_no} field="tin_no" /> <Field label="ECC No" value={header.ecc_no} field="ecc_no" /> <Field label="MPCT No" value={header.mpct_no} field="mpct_no" /> <Field label="Currency" value={header.currency} field="currency" /> <Field label="Ex Rate" value={header.ex_rate} field="ex_rate" /> </div> </TabsContent> <TabsContent value="issuer" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Inspection By" value={header.inspection_by} field="inspection_by" /> <Field label="Issuer Name" value={header.issuer_name} field="issuer_name" /> <Field label="Designation" value={header.issuer_designation} field="issuer_designation" /> <Field label="Issuer Phone" value={header.issuer_phone} field="issuer_phone" /> {/* Truncated Remarks Section to Save a Row */} <div className="col-span-2 md:col-span-4 mt-2"> <div className="flex flex-col"> <Label className="mb-1 font-bold text-sys-secondary"> Remarks </Label> {editMode ? ( <input value={header.remarks ||""} onChange={(e) => updateHeader("remarks", e.target.value)} className="w-full h-8 px-2 text-body border-none bg-[var(--color-sys-bg-tertiary)]/50 rounded focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none font-medium text-sys-primary" placeholder="Enter remarks..." /> ) : ( <div className="text-body text-sys-primary font-normal line-clamp-1 italic px-0.5 opacity-90" title={header.remarks ||""} > {header.remarks ||"No remarks provided."} </div> )} </div> </div> </div> </TabsContent> <TabsContent value="srvs" className="m-0"> {srvs.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {srvs.map((srv) => ( <div key={srv.srv_number} className="p-4 rounded-xl shadow-sm bg-[var(--color-sys-bg-tertiary)]/10 hover:bg-[var(--color-sys-brand-primary)]/[0.03] hover:shadow-md transition-all duration-300 group cursor-pointer border border-[var(--color-sys-text-tertiary)]/10" onClick={() => router.push(`/srv/${srv.srv_number}`)} > <div className="flex justify-between items-start mb-3"> <div className="space-y-0.5"> <Label className="font-bold text-sys-primary group-hover:text-sys-brand cursor-pointer"> SRV-{srv.srv_number} </Label> <SmallText className="font-medium text-sys-tertiary flex items-center gap-1 uppercase tracking-tighter"> <Calendar className="w-2.5 h-2.5" /> {formatDate(srv.srv_date)} </SmallText> </div> <div className="flex flex-col items-end gap-1.5"> <div className="w-6 h-6 rounded-lg bg-[var(--color-sys-brand-primary)]/10 flex items-center justify-center text-sys-brand shadow-sm border border-[var(--color-sys-brand-primary)]/20"> <Receipt className="w-3 h-3" /> </div> {srv.invoice_numbers && ( <Badge variant="default" className="text-h4 py-0 px-1.5 h-5 font-bold" > INV: {srv.invoice_numbers.split(",")[0]} </Badge> )} </div> </div> <div className="grid grid-cols-2 pt-2 border-t border-[var(--color-sys-text-tertiary)]/10 gap-2"> <div> <div className="text-h4 font-bold text-sys-success uppercase tracking-widest leading-tight"> Accepted </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_accepted_qty || 0}</Accounting> </div> </div> <div className="text-right"> <div className="text-h4 font-bold text-sys-error uppercase tracking-widest leading-tight"> Rejected </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_rejected_qty || 0}</Accounting> </div> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-6 text-[var(--color-sys-text-tertiary)] italic"> No linked SRVs found. </div> )} </TabsContent> </GlassContainer> </motion.div> </AnimatePresence> </Tabs> {/* Items & Deliveries - Custom Table matching Atomic Vibe + V2 Layout */} <div className="space-y-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-2"> <Label className="m-0 text-body font-black text-sys-secondary"> Bill of Materials </Label> </div> {editMode && ( <Button size="sm" onClick={addItem} variant="ghost" className="h-8 text-small bg-[var(--color-sys-bg-tertiary)] text-sys-primary hover:bg-[var(--color-sys-bg-secondary)] font-bold" > <Plus className="w-3.5 h-3.5 mr-1.5" /> ADD ITEM </Button> )} </div> <div className="overflow-hidden rounded-2xl bg-[var(--color-sys-bg-primary)] shadow-xl shadow-[var(--color-sys-brand-primary)]/5 border-none"> <div className="overflow-x-auto"> <table className="w-full text-left"> <thead className="bg-[var(--color-sys-bg-tertiary)]/50"> <tr> <th className="py-2.5 px-4 table-header-text text-center w-12">#</th> <th className="py-2.5 px-4 table-header-text text-left w-32">Code</th> <th className="py-2.5 px-4 table-header-text text-left">Description</th> <th className="py-2.5 px-4 table-header-text text-left w-20">Unit</th> <th className="py-2.5 px-4 table-header-text text-right w-28">Rate</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Ord</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Dlv</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Bal</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Rec</th> <th className="py-2.5 px-4 w-12"></th> </tr> </thead> <tbody className="min-h-[200px]"> {items.map((item, idx) => ( <React.Fragment key={item.po_item_no}> <tr className={cn("hover:bg-[var(--color-sys-bg-secondary)] transition-colors group", expandedItems.has(item.po_item_no) ?"bg-[var(--color-sys-bg-secondary)]/50" :"" )} > <td className="py-2 px-4 text-center align-top pt-3.5 italic table-cell-text"> {idx + 1} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.material_code} onChange={(e) => updateItem(idx,"material_code", e.target.value)} className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-number" /> ) : ( <Accounting className="tracking-tighter table-cell-number"> {item.material_code} </Accounting> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <div className="space-y-1"> <Input value={item.material_description} onChange={(e) => updateItem(idx,"material_description", e.target.value) } className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-text" /> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value)} placeholder="Drawing" className="h-6 text-small w-32 px-1.5 py-0.5 border-none bg-[var(--color-sys-bg-tertiary)] font-medium text-[var(--color-sys-text-primary)]" /> </div> ) : ( <div className="space-y-0.5"> <div className="font-medium leading-tight truncate max-w-[400px] table-cell-text" title={item.material_description} > {item.material_description} </div> {item.drg_no && ( <div className="text-h4 font-medium text-sys-brand uppercase tracking-tight"> DRG: {item.drg_no} </div> )} </div> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value)} className="h-7 text-body w-14 px-1 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-sys-primary" /> ) : ( <SmallText className="text-sys-secondary uppercase font-bold"> {item.unit} </SmallText> )} </td> <td className="py-2 px-4 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.po_rate} onChange={(e) => updateItem(idx,"po_rate", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1.5 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1.5 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number font-mono text-right block"> {formatIndianCurrency(item.po_rate)} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.ordered_quantity} onChange={(e) => updateItem(idx,"ordered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {item.ordered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.delivered_quantity} onChange={(e) => updateItem(idx,"delivered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-mono font-medium text-sys-brand focus:bg-[var(--color-sys-brand-primary)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-sys-brand tracking-tighter table-cell-number text-right block font-mono"> {item.delivered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {(item.ordered_quantity || 0) - (item.received_quantity || 0)} </Accounting> </div> </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.received_quantity} onChange={(e) => updateItem(idx,"received_quantity", parseFloat(e.target.value)) } className="h-7 text-[13px] text-right w-full px-1 py-1 font-mono font-medium text-[var(--color-sys-status-success)] focus:bg-[var(--color-sys-status-success)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-[var(--color-sys-status-success)] tracking-tighter table-cell-number text-right block font-mono"> {item.received_quantity} </Accounting> </div> )} </td> <td className="py-2 px-4 align-top pt-2"> <div className="flex flex-col gap-1 items-center"> <button onClick={() => toggleItem(item.po_item_no)} className={cn("p-1.5 rounded-md transition-all text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-text-primary)]", expandedItems.has(item.po_item_no) &&"text-[var(--color-sys-brand-primary)] bg-[var(--color-sys-brand-primary)]/10" )} > {expandedItems.has(item.po_item_no) ? ( <ChevronUp className="w-4 h-4" /> ) : ( <ChevronDown className="w-4 h-4" /> )} </button> {editMode && ( <button onClick={() => removeItem(idx)} className="p-1.5 rounded-md text-[var(--color-sys-status-error)]/60 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10 transition-all" > <Trash2 className="w-4 h-4" /> </button> )} </div> </td> </tr> {expandedItems.has(item.po_item_no) && ( <tr className="bg-[var(--color-sys-bg-tertiary)]/5"> <td colSpan={10} className="p-0"> <div className="pb-6 pt-2 pl-12 relative"> <div className="absolute left-[34px] top-0 bottom-6 w-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center justify-between mb-3 border-none pb-2"> <h4 className="text-[10px] font-bold text-[var(--color-sys-text-secondary)] uppercase tracking-[0.2em] flex items-center gap-2"> <Layers size={12} /> Delivery Lots & Schedules </h4> {editMode && ( <button onClick={() => addDelivery(idx)} className="text-[10px] font-bold text-[var(--color-sys-brand-primary)] hover:brightness-110 transition-all uppercase tracking-tight flex items-center bg-[var(--color-sys-brand-primary)]/5 px-2 py-1 rounded-md" > <Plus className="w-3 h-3 mr-1" /> Add Lot </button> )} </div> <div className="space-y-1 relative ml-2"> {/* Vertical Guide Line */} <div className="absolute left-[-14px] top-0 bottom-4 w-px bg-[var(--color-sys-text-tertiary)]/20" /> {item.deliveries && item.deliveries.length > 0 ? ( item.deliveries.map((d, dIdx) => ( <div key={dIdx} className="flex items-center gap-8 py-2 px-4 rounded-lg hover:bg-[var(--color-sys-bg-tertiary)]/10 transition-colors group/lot relative" > {/* Horizontal Connector */} <div className="absolute left-[-14px] top-1/2 w-3 h-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center gap-3 min-w-[60px]"> <span className="text-[11px] font-black text-[var(--color-sys-brand-primary)] font-mono"> L{d.lot_no} </span> </div> <div className="flex items-center gap-2 min-w-[120px] justify-end"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Qty </Label> {editMode ? ( <Input type="number" value={d.delivered_quantity} onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].delivered_quantity = parseFloat(e.target.value); setData({ ...data, items: n }); }} className="h-7 w-20 text-right bg-[var(--color-sys-bg-secondary)] border-none text-[11px] font-bold font-mono" /> ) : ( <Accounting className="text-[11px] font-bold text-[var(--color-sys-text-primary)] font-mono text-right block"> {d.delivered_quantity} </Accounting> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Date </Label> {editMode ? ( <input type="date" value={ d.dely_date ? new Date(d.dely_date).toISOString().split("T")[0] :"" } onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].dely_date = e.target.value; setData({ ...data, items: n }); }} className="h-7 w-28 text-[11px] bg-[var(--color-sys-bg-secondary)] rounded px-2 border-none outline-none text-[var(--color-sys-text-primary)] font-bold" /> ) : ( <Body className="text-[11px] font-bold text-[var(--color-sys-text-secondary)] font-mono"> {formatDate(d.dely_date)} </Body> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Entry By </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono"> {formatDate(d.entry_allow_date)} </SmallText> </div> <div className="flex items-center gap-2 min-w-[80px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Dest </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono uppercase"> {d.dest_code ||"-"} </SmallText> </div> {editMode && ( <div className="ml-auto"> <Button variant="ghost" size="sm" onClick={() => removeDelivery(idx, dIdx)} className="text-[var(--color-sys-status-error)]/40 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10" > <Trash2 className="w-3.5 h-3.5" /> </Button> </div> )} </div> )) ) : ( <div className="flex items-center gap-3 py-4 pl-12"> <SmallText className="text-[var(--color-sys-text-tertiary)]"> Γöö </SmallText> <SmallText className="italic text-[var(--color-sys-text-tertiary)]"> No delivery lots defined for this item </SmallText> </div> )} </div> </div> </td> </tr> )} </React.Fragment> ))} </tbody> </table> </div> </div> </div> </div> {/* Removed fixed floating actions bar for compliance with"no fixed components" rule */} </DocumentTemplate> );
  20 | } export default function PODetailPage() { return ( <Suspense fallback={<DetailSkeleton />}> <PODetailContent /> </Suspense> );

the name `Label` is defined multiple times

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:127
Ecmascript file had an error
  15 | import { motion, AnimatePresence } from"framer-motion";
  16 | import dynamic from"next/dynamic";
> 17 | import { DetailSkeleton } from"@/components/design-system/molecules/skeletons/DetailSkeleton"; import { H1, H2, H3, H4, Body, SmallText, Label, Accounting,
     |                                                                                                                               ^^^^^^^^^
  18 | } from"@/components/design-system/atoms/Typography"; const DocumentJourney = dynamic( () => import("@/components/design-system/molecules/DocumentJourney").then( (mod) => mod.DocumentJourney ), { loading: () => <div className="h-6 w-48 bg-[var(--color-sys-bg-tertiary)] rounded-full animate-pulse" />, ssr: false, }
  19 | ); function PODetailContent() { const router = useRouter(); const params = useParams(); const poId = normalizeId(params?.id as string | string[] ||""); const [data, setData] = useState<PODetail | null>(null); const [loading, setLoading] = useState(true); const [editMode, setEditMode] = useState(false); const [expandedItems, setExpandedItems] = useState<Set<number>>(new Set()); const [hasDC, setHasDC] = useState(false); const [dcId, setDCId] = useState<string | null>(null); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [error, setError] = useState<string | null>(null); // Restore tab state from v2 blueprint const [activeTab, setActiveTab] = useState("basic"); useEffect(() => { if (!poId) return; const loadData = async () => { try { const [poData, dcCheck, srvData] = await Promise.all([ api.getPODetail(poId), api.checkPOHasDC(poId).catch(() => null), api.listSRVs(poId).catch(() => []), ]); setData(poData); if (poData.items) setExpandedItems(new Set(poData.items.map((item: POItem) => item.po_item_no))); if (dcCheck?.has_dc) { setHasDC(true); setDCId(dcCheck.dc_id || null); } // Fix: Ensure we handle potential type mismatch if API returns strictly SRVListItem[] // but Types expects extra fields. For now, we cast or map if necessary. setSrvs((srvData || []) as SRVListItem[]); } catch (err: any) { setError(err.message ||"Traceback failure in record retrieval"); } finally { setLoading(false); } }; loadData(); }, [poId]); const handleSave = useCallback(async () => { if (!data || !data.header) return; setLoading(true); try { await api.updatePO(data.header.po_number, data.header, data.items); setEditMode(false); const poData = await api.getPODetail(poId); setData(poData); } catch (err: any) { setError(err.message ||"Failed to sync changes"); } finally { setLoading(false); } }, [data, poId]); const addItem = useCallback(() => { if (!data || !data.items) return; const maxItemNo = Math.max(...data.items.map((i: POItem) => i.po_item_no || 0), 0); const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"NEW PROCUREMENT ITEM", drg_no:"", unit:"NOS", ordered_quantity: 0, po_rate: 0, item_value: 0, delivered_quantity: 0, deliveries: [], }; setData({ ...data, items: [...data.items, newItem] }); setExpandedItems(new Set([...Array.from(expandedItems), maxItemNo + 1])); }, [data, expandedItems]); const toggleItem = useCallback((itemNo: number) => { const s = new Set(expandedItems); s.has(itemNo) ? s.delete(itemNo) : s.add(itemNo); setExpandedItems(s); }, [expandedItems]); const updateHeader = (field: string, value: any) => { if (!data) return; setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="po_rate" || field ==="ordered_quantity") { newItems[index].item_value = (newItems[index].ordered_quantity || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const addDelivery = (itemIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; const item = newItems[itemIdx]; const maxLotNo = Math.max(...(item.deliveries?.map((d: PODelivery) => d.lot_no || 0) || []), 0); const newLot = { lot_no: maxLotNo + 1, delivered_quantity: 0, dely_date: new Date().toISOString().split("T")[0], }; newItems[itemIdx].deliveries = [...(item.deliveries || []), newLot]; setData({ ...data, items: newItems }); }; const removeDelivery = (itemIdx: number, deliveryIdx: number) => { if (!data || !data.items) return; const newItems = [...data.items]; newItems[itemIdx].deliveries = newItems[itemIdx].deliveries.filter((_, i) => i !== deliveryIdx); setData({ ...data, items: newItems }); }; const removeItem = (index: number) => { if (!data || !data.items) return; const newItems = data.items.filter((_, i) => i !== index); setData({ ...data, items: newItems }); }; const handleEnableEdit = useCallback(() => setEditMode(true), []); const handleDisableEdit = useCallback(() => setEditMode(false), []); if (loading || !data || !data.header) { return <DetailSkeleton />; } const { header, items } = data; const topActions = ( <div className="flex items-center gap-2.5"> {editMode ? ( <> <Button variant="outline" size="sm" onClick={() => setEditMode(false)} className="text-[var(--color-sys-status-error)] border-[var(--color-sys-status-error)]/20 shadow-sm" > <X className="w-3.5 h-3.5 mr-2" /> Discard </Button> <Button variant="default" size="sm" onClick={handleSave}> <Save className="w-3.5 h-3.5 mr-2" /> SAVE CHANGES </Button> </> ) : ( <> <Button variant="outline" size="sm" asChild className="text-[var(--color-sys-status-success)] border-[var(--color-sys-status-success)]/20 bg-[var(--color-sys-status-success)]/10 hover:bg-[var(--color-sys-status-success)]/20 hover:text-[var(--color-sys-status-success)]" > <a href={`${api.baseUrl}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-3.5 h-3.5 mr-2" /> EXCEL </a> </Button> <Button variant="outline" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("border-[var(--color-sys-text-tertiary)]/20", hasDC ?"bg-[var(--color-sys-status-success)]/10 text-[var(--color-sys-status-success)] shadow-sm border-[var(--color-sys-status-success)]/20" :"text-[var(--color-sys-text-secondary)]" )} > <FileText className="w-3.5 h-3.5 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Button variant="default" size="sm" onClick={handleEnableEdit}> <Edit2 className="w-3.5 h-3.5 mr-2" /> MODIFY </Button> </> )} </div> ); // Using Atomic Components for Fields - Unified for Zero Layout Shift const Field = ({ label, value, field, readonly = false, }: { label: string; value: any; field?: string; readonly?: boolean; }) => { return ( <div className="min-h-[44px] flex flex-col justify-center"> <Label className="mb-1.5 font-bold text-[var(--color-sys-text-secondary)]">{label}</Label> {editMode && field && !readonly ? ( <Input value={value ??""} onChange={(e) => updateHeader(field, e.target.value)} className="h-7 text-body px-2 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none focus:shadow-sm font-medium text-[var(--color-sys-text-primary)]" /> ) : ( <Body className="font-medium text-sys-primary leading-tight py-1 truncate" title={value?.toString()} > {value || ( <span className="text-sys-tertiary font-normal italic opacity-60 uppercase tracking-tighter text-label"> Empty </span> )} </Body> )} </div> ); }; // ≡ƒÄ¿ VISUAL UPGRADE: Actions (Moved from fixed bar to standard top actions for compliance) const renderActions = () => { if (editMode) { return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" onClick={() => setEditMode(false)} className="text-sys-secondary hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <X className="w-4 h-4 mr-2" /> DISCARD </Button> <Button variant="default" size="sm" onClick={handleSave} className="bg-[var(--color-sys-brand-primary)] hover:brightness-110 text-[var(--color-sys-text-on-brand)] shadow-sm text-small" > <Save className="w-4 h-4 mr-2" /> SAVE CHANGES </Button> </Flex> ); } return ( <Flex align="center" gap={3}> <Button variant="ghost" size="sm" asChild className="text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small" > <a href={`${API_BASE_URL}/api/po/${header.po_number}/download`} target="_blank" rel="noreferrer" > <FileDown className="w-4 h-4 mr-2 text-[var(--color-sys-brand-primary)]" /> EXCEL </a> </Button> <Button variant="ghost" size="sm" onClick={() => hasDC && dcId ? router.push(dcRoute(dcId)) : router.push(createDCRoute(header.po_number)) } className={cn("text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)]/10 text-small", hasDC &&"text-[var(--color-sys-status-success)]" )} > <FileText className="w-4 h-4 mr-2" /> {hasDC ?"VIEW DC" :"GENERATE DC"} </Button> <Box className="w-[1px] h-6 bg-[var(--color-sys-text-tertiary)]/10 mx-1" /> <Button variant="default" size="sm" onClick={handleEnableEdit} className="bg-[var(--color-sys-brand-primary)] text-[var(--color-sys-text-on-brand)] hover:brightness-110 shadow-lg text-small" > <Edit2 className="w-4 h-4 mr-2 text-[var(--color-sys-text-on-brand)]" /> MODIFY RECORD </Button> </Flex> ); }; return ( <DocumentTemplate title={`PO #${header.po_number}`} description={`${header.supplier_name} ΓÇó ${formatDate(header.po_date)}`} actions={renderActions()} onBack={() => router.back()} layoutId={`po-title-${header.po_number}`} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId={`po-icon-${header.po_number}`} status={header.po_status} > <div className="space-y-6"> {/* Document Journey */} <DocumentJourney currentStage="PO" className="mb-2" /> {/* V2 Layout: Comprehensive Tabs */} <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full"> <TabsList className="mb-4 bg-transparent p-0 border-b border-[var(--color-sys-text-tertiary)]/10 w-full justify-start rounded-none gap-6"> <TabsTrigger value="basic"> <Info className="w-3.5 h-3.5 mr-1.5" /> Basic </TabsTrigger> <TabsTrigger value="references"> <FileText className="w-3.5 h-3.5 mr-1.5" /> Refs </TabsTrigger> <TabsTrigger value="financial"> <Landmark className="w-3.5 h-3.5 mr-1.5" /> Finance </TabsTrigger> <TabsTrigger value="issuer"> <ShieldCheck className="w-3.5 h-3.5 mr-1.5" /> Issuer </TabsTrigger> <TabsTrigger value="srvs"> <Receipt className="w-3.5 h-3.5 mr-1.5" /> SRVs ({srvs.length}) </TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.15 }} > <GlassContainer className="p-6 min-h-[180px] border-none shadow-sm mt-0 relative top-[-1px]"> <TabsContent value="basic" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Number" value={header.po_number} field="po_number" readonly /> <Field label="PO Date" value={formatDate(header.po_date)} field="po_date" readonly /> <Field label="Supplier Name" value={header.supplier_name} field="supplier_name" /> <Field label="Supplier Code" value={header.supplier_code} field="supplier_code" /> <Field label="Phone" value={header.supplier_phone} field="supplier_phone" /> <Field label="Fax" value={header.supplier_fax} field="supplier_fax" /> <Field label="Email" value={header.supplier_email} field="supplier_email" /> <Field label="Dept No (DVN)" value={header.department_no} field="department_no" /> </div> </TabsContent> <TabsContent value="references" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Enquiry No" value={header.enquiry_no} field="enquiry_no" /> <Field label="Enquiry Date" value={formatDate(header.enquiry_date)} field="enquiry_date" /> <Field label="Quotation Ref" value={header.quotation_ref} field="quotation_ref" /> <Field label="Quotation Date" value={formatDate(header.quotation_date)} field="quotation_date" /> <Field label="RC No" value={header.rc_no} field="rc_no" /> <Field label="Order Type" value={header.order_type} field="order_type" /> <Field label="PO Status" value={header.po_status} field="po_status" /> <Field label="Amd No" value={header.amend_no} field="amend_no" /> </div> </TabsContent> <TabsContent value="financial" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="PO Value" value={formatIndianCurrency(header.po_value)} field="po_value" /> <Field label="FOB Value" value={formatIndianCurrency(header.fob_value)} field="fob_value" /> <Field label="Net Value" value={formatIndianCurrency(header.net_po_value)} field="net_po_value" /> <Field label="TIN No" value={header.tin_no} field="tin_no" /> <Field label="ECC No" value={header.ecc_no} field="ecc_no" /> <Field label="MPCT No" value={header.mpct_no} field="mpct_no" /> <Field label="Currency" value={header.currency} field="currency" /> <Field label="Ex Rate" value={header.ex_rate} field="ex_rate" /> </div> </TabsContent> <TabsContent value="issuer" className="m-0"> <div className="grid grid-cols-2 md:grid-cols-4 gap-x-8 gap-y-4"> <Field label="Inspection By" value={header.inspection_by} field="inspection_by" /> <Field label="Issuer Name" value={header.issuer_name} field="issuer_name" /> <Field label="Designation" value={header.issuer_designation} field="issuer_designation" /> <Field label="Issuer Phone" value={header.issuer_phone} field="issuer_phone" /> {/* Truncated Remarks Section to Save a Row */} <div className="col-span-2 md:col-span-4 mt-2"> <div className="flex flex-col"> <Label className="mb-1 font-bold text-sys-secondary"> Remarks </Label> {editMode ? ( <input value={header.remarks ||""} onChange={(e) => updateHeader("remarks", e.target.value)} className="w-full h-8 px-2 text-body border-none bg-[var(--color-sys-bg-tertiary)]/50 rounded focus:bg-[var(--color-sys-bg-primary)] transition-all shadow-none font-medium text-sys-primary" placeholder="Enter remarks..." /> ) : ( <div className="text-body text-sys-primary font-normal line-clamp-1 italic px-0.5 opacity-90" title={header.remarks ||""} > {header.remarks ||"No remarks provided."} </div> )} </div> </div> </div> </TabsContent> <TabsContent value="srvs" className="m-0"> {srvs.length > 0 ? ( <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"> {srvs.map((srv) => ( <div key={srv.srv_number} className="p-4 rounded-xl shadow-sm bg-[var(--color-sys-bg-tertiary)]/10 hover:bg-[var(--color-sys-brand-primary)]/[0.03] hover:shadow-md transition-all duration-300 group cursor-pointer border border-[var(--color-sys-text-tertiary)]/10" onClick={() => router.push(`/srv/${srv.srv_number}`)} > <div className="flex justify-between items-start mb-3"> <div className="space-y-0.5"> <Label className="font-bold text-sys-primary group-hover:text-sys-brand cursor-pointer"> SRV-{srv.srv_number} </Label> <SmallText className="font-medium text-sys-tertiary flex items-center gap-1 uppercase tracking-tighter"> <Calendar className="w-2.5 h-2.5" /> {formatDate(srv.srv_date)} </SmallText> </div> <div className="flex flex-col items-end gap-1.5"> <div className="w-6 h-6 rounded-lg bg-[var(--color-sys-brand-primary)]/10 flex items-center justify-center text-sys-brand shadow-sm border border-[var(--color-sys-brand-primary)]/20"> <Receipt className="w-3 h-3" /> </div> {srv.invoice_numbers && ( <Badge variant="default" className="text-h4 py-0 px-1.5 h-5 font-bold" > INV: {srv.invoice_numbers.split(",")[0]} </Badge> )} </div> </div> <div className="grid grid-cols-2 pt-2 border-t border-[var(--color-sys-text-tertiary)]/10 gap-2"> <div> <div className="text-h4 font-bold text-sys-success uppercase tracking-widest leading-tight"> Accepted </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_accepted_qty || 0}</Accounting> </div> </div> <div className="text-right"> <div className="text-h4 font-bold text-sys-error uppercase tracking-widest leading-tight"> Rejected </div> <div className="text-small font-bold text-sys-primary"> <Accounting>{srv.total_rejected_qty || 0}</Accounting> </div> </div> </div> </div> ))} </div> ) : ( <div className="text-center py-6 text-[var(--color-sys-text-tertiary)] italic"> No linked SRVs found. </div> )} </TabsContent> </GlassContainer> </motion.div> </AnimatePresence> </Tabs> {/* Items & Deliveries - Custom Table matching Atomic Vibe + V2 Layout */} <div className="space-y-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-2"> <Label className="m-0 text-body font-black text-sys-secondary"> Bill of Materials </Label> </div> {editMode && ( <Button size="sm" onClick={addItem} variant="ghost" className="h-8 text-small bg-[var(--color-sys-bg-tertiary)] text-sys-primary hover:bg-[var(--color-sys-bg-secondary)] font-bold" > <Plus className="w-3.5 h-3.5 mr-1.5" /> ADD ITEM </Button> )} </div> <div className="overflow-hidden rounded-2xl bg-[var(--color-sys-bg-primary)] shadow-xl shadow-[var(--color-sys-brand-primary)]/5 border-none"> <div className="overflow-x-auto"> <table className="w-full text-left"> <thead className="bg-[var(--color-sys-bg-tertiary)]/50"> <tr> <th className="py-2.5 px-4 table-header-text text-center w-12">#</th> <th className="py-2.5 px-4 table-header-text text-left w-32">Code</th> <th className="py-2.5 px-4 table-header-text text-left">Description</th> <th className="py-2.5 px-4 table-header-text text-left w-20">Unit</th> <th className="py-2.5 px-4 table-header-text text-right w-28">Rate</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Ord</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Dlv</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Bal</th> <th className="py-2.5 px-2 table-header-text text-right w-32">Rec</th> <th className="py-2.5 px-4 w-12"></th> </tr> </thead> <tbody className="min-h-[200px]"> {items.map((item, idx) => ( <React.Fragment key={item.po_item_no}> <tr className={cn("hover:bg-[var(--color-sys-bg-secondary)] transition-colors group", expandedItems.has(item.po_item_no) ?"bg-[var(--color-sys-bg-secondary)]/50" :"" )} > <td className="py-2 px-4 text-center align-top pt-3.5 italic table-cell-text"> {idx + 1} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.material_code} onChange={(e) => updateItem(idx,"material_code", e.target.value)} className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-number" /> ) : ( <Accounting className="tracking-tighter table-cell-number"> {item.material_code} </Accounting> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <div className="space-y-1"> <Input value={item.material_description} onChange={(e) => updateItem(idx,"material_description", e.target.value) } className="h-7 w-full px-1.5 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-[var(--color-sys-text-primary)] table-cell-text" /> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value)} placeholder="Drawing" className="h-6 text-small w-32 px-1.5 py-0.5 border-none bg-[var(--color-sys-bg-tertiary)] font-medium text-[var(--color-sys-text-primary)]" /> </div> ) : ( <div className="space-y-0.5"> <div className="font-medium leading-tight truncate max-w-[400px] table-cell-text" title={item.material_description} > {item.material_description} </div> {item.drg_no && ( <div className="text-h4 font-medium text-sys-brand uppercase tracking-tight"> DRG: {item.drg_no} </div> )} </div> )} </td> <td className="py-2 px-4 align-top pt-2.5"> {editMode ? ( <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value)} className="h-7 text-body w-14 px-1 py-1 border-none bg-[var(--color-sys-bg-tertiary)]/50 font-medium text-sys-primary" /> ) : ( <SmallText className="text-sys-secondary uppercase font-bold"> {item.unit} </SmallText> )} </td> <td className="py-2 px-4 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.po_rate} onChange={(e) => updateItem(idx,"po_rate", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1.5 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1.5 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number font-mono text-right block"> {formatIndianCurrency(item.po_rate)} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.ordered_quantity} onChange={(e) => updateItem(idx,"ordered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-medium text-sys-primary focus:bg-[var(--color-sys-bg-tertiary)] transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {item.ordered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.delivered_quantity} onChange={(e) => updateItem(idx,"delivered_quantity", parseFloat(e.target.value)) } className="h-7 text-body text-right w-full px-1 py-1 font-mono font-medium text-sys-brand focus:bg-[var(--color-sys-brand-primary)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-sys-brand tracking-tighter table-cell-number text-right block font-mono"> {item.delivered_quantity} </Accounting> </div> )} </td> <td className="py-2 px-2 text-right align-top pt-3"> <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="tracking-tighter table-cell-number text-right block font-mono"> {(item.ordered_quantity || 0) - (item.received_quantity || 0)} </Accounting> </div> </td> <td className="py-2 px-2 text-right align-top pt-3"> {editMode ? ( <Input type="number" variant="ghost" value={item.received_quantity} onChange={(e) => updateItem(idx,"received_quantity", parseFloat(e.target.value)) } className="h-7 text-[13px] text-right w-full px-1 py-1 font-mono font-medium text-[var(--color-sys-status-success)] focus:bg-[var(--color-sys-status-success)]/10 transition-colors" /> ) : ( <div className="h-7 px-1 py-1 flex items-center justify-end"> <Accounting className="text-[var(--color-sys-status-success)] tracking-tighter table-cell-number text-right block font-mono"> {item.received_quantity} </Accounting> </div> )} </td> <td className="py-2 px-4 align-top pt-2"> <div className="flex flex-col gap-1 items-center"> <button onClick={() => toggleItem(item.po_item_no)} className={cn("p-1.5 rounded-md transition-all text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-text-primary)]", expandedItems.has(item.po_item_no) &&"text-[var(--color-sys-brand-primary)] bg-[var(--color-sys-brand-primary)]/10" )} > {expandedItems.has(item.po_item_no) ? ( <ChevronUp className="w-4 h-4" /> ) : ( <ChevronDown className="w-4 h-4" /> )} </button> {editMode && ( <button onClick={() => removeItem(idx)} className="p-1.5 rounded-md text-[var(--color-sys-status-error)]/60 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10 transition-all" > <Trash2 className="w-4 h-4" /> </button> )} </div> </td> </tr> {expandedItems.has(item.po_item_no) && ( <tr className="bg-[var(--color-sys-bg-tertiary)]/5"> <td colSpan={10} className="p-0"> <div className="pb-6 pt-2 pl-12 relative"> <div className="absolute left-[34px] top-0 bottom-6 w-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center justify-between mb-3 border-none pb-2"> <h4 className="text-[10px] font-bold text-[var(--color-sys-text-secondary)] uppercase tracking-[0.2em] flex items-center gap-2"> <Layers size={12} /> Delivery Lots & Schedules </h4> {editMode && ( <button onClick={() => addDelivery(idx)} className="text-[10px] font-bold text-[var(--color-sys-brand-primary)] hover:brightness-110 transition-all uppercase tracking-tight flex items-center bg-[var(--color-sys-brand-primary)]/5 px-2 py-1 rounded-md" > <Plus className="w-3 h-3 mr-1" /> Add Lot </button> )} </div> <div className="space-y-1 relative ml-2"> {/* Vertical Guide Line */} <div className="absolute left-[-14px] top-0 bottom-4 w-px bg-[var(--color-sys-text-tertiary)]/20" /> {item.deliveries && item.deliveries.length > 0 ? ( item.deliveries.map((d, dIdx) => ( <div key={dIdx} className="flex items-center gap-8 py-2 px-4 rounded-lg hover:bg-[var(--color-sys-bg-tertiary)]/10 transition-colors group/lot relative" > {/* Horizontal Connector */} <div className="absolute left-[-14px] top-1/2 w-3 h-px bg-[var(--color-sys-text-tertiary)]/20" /> <div className="flex items-center gap-3 min-w-[60px]"> <span className="text-[11px] font-black text-[var(--color-sys-brand-primary)] font-mono"> L{d.lot_no} </span> </div> <div className="flex items-center gap-2 min-w-[120px] justify-end"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Qty </Label> {editMode ? ( <Input type="number" value={d.delivered_quantity} onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].delivered_quantity = parseFloat(e.target.value); setData({ ...data, items: n }); }} className="h-7 w-20 text-right bg-[var(--color-sys-bg-secondary)] border-none text-[11px] font-bold font-mono" /> ) : ( <Accounting className="text-[11px] font-bold text-[var(--color-sys-text-primary)] font-mono text-right block"> {d.delivered_quantity} </Accounting> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Date </Label> {editMode ? ( <input type="date" value={ d.dely_date ? new Date(d.dely_date).toISOString().split("T")[0] :"" } onChange={(e) => { const n = [...items]; n[idx].deliveries[dIdx].dely_date = e.target.value; setData({ ...data, items: n }); }} className="h-7 w-28 text-[11px] bg-[var(--color-sys-bg-secondary)] rounded px-2 border-none outline-none text-[var(--color-sys-text-primary)] font-bold" /> ) : ( <Body className="text-[11px] font-bold text-[var(--color-sys-text-secondary)] font-mono"> {formatDate(d.dely_date)} </Body> )} </div> <div className="flex items-center gap-2 min-w-[150px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Entry By </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono"> {formatDate(d.entry_allow_date)} </SmallText> </div> <div className="flex items-center gap-2 min-w-[80px]"> <Label className="mb-0 text-[9px] text-[var(--color-sys-text-tertiary)] uppercase font-medium"> Dest </Label> <SmallText className="text-[10px] font-bold text-[var(--color-sys-text-tertiary)] font-mono uppercase"> {d.dest_code ||"-"} </SmallText> </div> {editMode && ( <div className="ml-auto"> <Button variant="ghost" size="sm" onClick={() => removeDelivery(idx, dIdx)} className="text-[var(--color-sys-status-error)]/40 hover:text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/10" > <Trash2 className="w-3.5 h-3.5" /> </Button> </div> )} </div> )) ) : ( <div className="flex items-center gap-3 py-4 pl-12"> <SmallText className="text-[var(--color-sys-text-tertiary)]"> Γöö </SmallText> <SmallText className="italic text-[var(--color-sys-text-tertiary)]"> No delivery lots defined for this item </SmallText> </div> )} </div> </div> </td> </tr> )} </React.Fragment> ))} </tbody> </table> </div> </div> </div> </div> {/* Removed fixed floating actions bar for compliance with"no fixed components" rule */} </DocumentTemplate> );
  20 | } export default function PODetailPage() { return ( <Suspense fallback={<DetailSkeleton />}> <PODetailContent /> </Suspense> );

the name `SmallText` is defined multiple times

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx [Server Component]


./.gemini/antigravity/scratch/SenstoSales/frontend/app/dc/create/page.tsx:16:3
Parsing ecmascript source code failed
  14 | import { Tabs, TabsList, TabsTrigger, TabsContent,
  15 | } from"@/components/design-system/molecules/Tabs"; function CreateDCPageContent() { const router = useRouter(); const searchParams = useSearchParams(); const initialPoNumber = searchParams ? searchParams.get("po") :""; const [poNumber, setPONumber] = useState(initialPoNumber ||""); const [items, setItems] = useState<DCItemRow[]>([]); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState<string | null>(null); const [poData, setPOData] = useState<POHeader | null>(null); const [isSubmitting, setIsSubmitting] = useState(false); const [notes, setNotes] = useState<string[]>([]); const [isChecking, setIsChecking] = useState(false); const [isDuplicate, setIsDuplicate] = useState(false); const [formData, setFormData] = useState({ dc_number:"", dc_date: new Date().toISOString().split("T")[0], supplier_phone:"0755 ΓÇô 4247748", supplier_gstin:"23AACFS6810L1Z7", consignee_name:"", consignee_address:"", }); useEffect(() => { if (initialPoNumber) { loadInitialData(initialPoNumber); } }, [initialPoNumber]); const loadInitialData = async (po: string) => { setIsLoading(true); setError(null); try { const [lots, pod] = await Promise.all([ api.getReconciliationLots(parseInt(po)), api.getPODetail(parseInt(po)), ]); // Process Lots const lotsData = Array.isArray(lots) ? lots : (lots as any)?.lots || []; const mappedItems: DCItemRow[] = lotsData.map((lot: any) => ({ id: `${lot.po_item_id}-${lot.lot_no}`, lot_no: lot.lot_no?.toString() ||"", description: lot.material_description ||"", drg_no: lot.drg_no ||"", ordered_quantity: lot.ordered_qty || 0, remaining_post_dc: lot.remaining_qty || 0, dispatch_quantity: 0, po_item_id: lot.po_item_id, })); setItems(mappedItems); if (mappedItems.length === 0) setError("No items available for dispatch"); // Process PO Data if (pod?.header) { setPOData(pod.header); setFormData((prev) => ({ ...prev, consignee_name: (pod.header as any)?.consignee_name ||"", consignee_address: (pod.header as any)?.consignee_address ||"", supplier_phone: pod.header?.supplier_phone ||"0755 ΓÇô 4247748", supplier_gstin: pod.header?.supplier_gstin ||"23AACFS6810L1Z7", })); } } catch (err: any) { setError(err.message ||"Failed to load initial data"); } finally { setIsLoading(false); } }; const checkNumberDuplicate = async (num: string, date: string) => { if (!num || num.length < 3) return; setIsChecking(true); try { const res = await api.checkDuplicateNumber("DC", num, date); setIsDuplicate(res.exists); } catch (err) { console.error(err); } finally { setIsChecking(false); } }; const handleLoadItems = (po: string) => { if (!po) return; loadInitialData(po); }; const handleSubmit = async () => { setError(null); setIsSubmitting(true); const itemsToDispatch = items.filter( (item) => item.dispatch_quantity && item.dispatch_quantity > 0, ); if (itemsToDispatch.length === 0) { setError("At least one item must have dispatch quantity"); setIsSubmitting(false); return; } try { const dcPayload = { dc_number: formData.dc_number, dc_date: formData.dc_date, po_number: poNumber ? parseInt(poNumber) : undefined, supplier_phone: formData.supplier_phone, supplier_gstin: formData.supplier_gstin, consignee_name: formData.consignee_name, consignee_address: formData.consignee_address, remarks: notes.join("\n\n"), }; const itemsPayload = itemsToDispatch.map((item) => ({ po_item_id: item.po_item_id, lot_no: item.lot_no ? parseInt(item.lot_no.toString()) : undefined, dispatch_qty: item.dispatch_quantity, hsn_code: null, hsn_rate: null, })); const response = (await api.createDC(dcPayload, itemsPayload)) as any; router.push(`/dc/${response.dc_number || formData.dc_number}`); } catch (err: any) { console.error("DC creation failed:", err); // Handle Pydantic 422 errors specifically to show something readable if (err.status === 422 && Array.isArray(err.data?.detail)) { const details = err.data.detail .map((d: any) => `${d.loc.join(".")}: ${d.msg}`) .join(","); setError(`Validation Error: ${details}`); } else { const msg = typeof err.message ==="object" ? JSON.stringify(err.message) : err.message ||"Failed to create challan"; setError(msg); } } finally { setIsSubmitting(false); } }; const topActions = ( <div className="flex items-center gap-2"> <Button variant="outline" size="sm" onClick={() => router.back()} disabled={isSubmitting} > Cancel </Button> <Button color="primary" size="sm" onClick={handleSubmit} disabled={ isSubmitting || items.length === 0 || isDuplicate || isChecking || !formData.dc_number } > {isSubmitting ? ( <Loader2 size={16} className="animate-spin mr-2" /> ) : ( <Save size={16} className="mr-2" /> )} {isSubmitting ?"Generating..." :"Generate Challan"} </Button> </div> ); return ( <DocumentTemplate title="Create Delivery Challan" description="Generate dispatch documentation from PO" actions={topActions} icon={<Truck size={20} className="text-emerald-700" />} iconLayoutId="create-dc-icon" > <div className="mb-6"> <DocumentJourney currentStage="DC" /> </div> <div className="space-y-6"> {error && ( <Card className="p-4 bg-sys-error-subtle border-sys-error-subtle"> <div className="flex items-center gap-2 text-sys-error"> <AlertCircle size={16} /> <SmallText className="font-medium">{error}</SmallText> </div> </Card> )} {/* PO Selection */} {!initialPoNumber && ( <Card className="p-6"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary mb-2 block font-medium"> Purchase Order Reference </Label> <div className="flex gap-3 mt-1"> <div className="flex-1"> <Input id="search-po-number" name="search-po-number" value={poNumber} onChange={(e) => setPONumber(e.target.value)} placeholder="Enter PO number" className="font-medium text-slate-930" /> </div> <Button variant="secondary" onClick={() => handleLoadItems(poNumber)} disabled={!poNumber || isLoading} > {isLoading ? ( <Loader2 size={16} className="animate-spin mr-2" /> ) : ( <Search size={16} className="mr-2" /> )} {isLoading ?"Loading..." :"Load Items"} </Button> </div> {poData && ( <div className="mt-4 p-4 bg-sys-bg-tertiary/50 rounded-xl border border-sys-bg-tertiary flex items-center justify-between"> <div className="flex flex-col"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Supplier </Label> <Body className="text-sys-primary font-medium"> {poData.supplier_name} </Body> </div> <Badge variant="outline" className="bg-sys-bg-white font-medium text-sys-secondary border-sys-tertiary/20" > PO #{poData.po_number} </Badge> </div> )} </Card> )} {/* Challan Details */} <Card className="p-6"> <H3 className="mb-6 font-medium text-sys-primary"> Challan Information </H3> <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> DC Number </Label> <Input id="dc-number" name="dc-number" value={formData.dc_number} onChange={(e) => { const val = e.target.value; setFormData({ ...formData, dc_number: val }); checkNumberDuplicate(val, formData.dc_date); }} className={cn("font-medium tabular-nums", isDuplicate ?"border-sys-error text-sys-error focus:ring-sys-error/10" :"text-slate-930", )} placeholder="DC/001/24-25" /> {isChecking && ( <SmallText className="text-sys-tertiary animate-pulse"> Checking uniqueness... </SmallText> )} {isDuplicate && ( <SmallText className="text-sys-error font-medium"> This number already exists in this FY </SmallText> )} </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> DC Date </Label> <div className="bg-sys-bg-white/40 backdrop-blur-md px-3 py-1.5 rounded-xl border border-sys-bg-white/50 shadow-sm focus-within:ring-2 focus-within:ring-sys-brand/10 transition-all flex items-center gap-2"> <Calendar size={14} className="text-sys-brand" /> <Input id="dc-date" name="dc-date" type="date" value={formData.dc_date} onChange={(e) => setFormData({ ...formData, dc_date: e.target.value }) } className="font-bold text-sys-primary bg-transparent border-none p-0 focus:ring-0 cursor-pointer" /> </div> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Supplier Phone </Label> <Input id="supplier-phone" name="supplier-phone" value={formData.supplier_phone} onChange={(e) => setFormData({ ...formData, supplier_phone: e.target.value }) } className="font-medium text-slate-930" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Supplier GSTIN </Label> <Input id="supplier-gstin" name="supplier-gstin" value={formData.supplier_gstin} onChange={(e) => setFormData({ ...formData, supplier_gstin: e.target.value }) } className="font-medium text-slate-930 font-mono" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Consignee Name </Label> <Input id="consignee-name" name="consignee-name" value={formData.consignee_name} onChange={(e) => setFormData({ ...formData, consignee_name: e.target.value }) } className="font-medium text-slate-930" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Consignee Address </Label> <textarea id="consignee-address" name="consignee-address" value={formData.consignee_address} onChange={(e) => setFormData({ ...formData, consignee_address: e.target.value, }) } className="w-full px-3 py-2 text-[13px] font-medium text-slate-930 bg-sys-bg-white border border-sys-tertiary/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-sys-primary/10 focus:border-sys-tertiary resize-none transition-all" rows={2} /> </div> </div> </Card> {/* Items Table */} {items.length > 0 && ( <Card className="p-0 overflow-hidden border-none shadow-sm"> <div className="px-6 py-4 bg-sys-bg-tertiary/50 border-b border-sys-bg-tertiary flex items-center justify-between"> <H3 className="font-medium text-sys-primary"> Dispatch Items ({items.length}) </H3> </div> <div className="overflow-x-auto"> <table className="w-full"> <thead> <tr className="border-b border-sys-bg-tertiary bg-sys-bg-tertiary/30"> <th className="py-3 px-6 text-left"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Lot </Label> </th> <th className="py-3 px-6 text-left"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Description </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Ord </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Bal </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary font-medium"> Dlv Qty </Label> </th> </tr> </thead> <tbody> {items.map((item, idx) => ( <tr key={item.id} className="border-b border-sys-bg-tertiary hover:bg-sys-bg-tertiary/20 transition-colors" > <td className="py-4 px-6"> <Accounting className="text-slate-930 font-medium"> {item.lot_no} </Accounting> </td> <td className="py-4 px-6"> <div className="flex flex-col"> <Body className="text-sys-primary font-medium leading-normal"> {item.description} </Body> {item.drg_no && ( <span className="text-[10px] uppercase tracking-tight text-sys-secondary mt-0.5 font-medium"> DRG: {item.drg_no} </span> )} </div> </td> <td className="py-4 px-6 text-right"> <Accounting className="text-sys-secondary"> {item.ordered_quantity} </Accounting> </td> <td className="py-4 px-6 text-right"> <Accounting className="text-sys-secondary"> {item.remaining_post_dc} </Accounting> </td> <td className="py-4 px-6"> <Input type="number" value={item.dispatch_quantity ||""} onChange={(e) => { const newItems = [...items]; newItems[idx].dispatch_quantity = parseFloat(e.target.value) || 0; setItems(newItems); }} className="text-right max-w-[100px] ml-auto font-medium font-mono h-9 border-sys-tertiary/20 focus:ring-sys-primary/5" placeholder="0" /> </td> </tr> ))} </tbody> </table> </div> </Card> )} {/* Notes */} <Card className="p-6"> <Label className="text-[10px] uppercase tracking-widest text-sys-secondary mb-4 block font-medium"> Additional Notes </Label> <div className="space-y-3"> {notes.map((note, idx) => ( <div key={idx} className="flex gap-2"> <Input value={note} onChange={(e) => { const newNotes = [...notes]; newNotes[idx] = e.target.value; setNotes(newNotes); }} placeholder="Enter additional information..." className="font-medium text-slate-930" /> <Button variant="ghost" size="sm" onClick={() => setNotes(notes.filter((_, i) => i !== idx))} className="text-sys-tertiary hover:text-sys-error" > <Trash2 size={16} /> </Button> </div> ))} <Button variant="outline" size="sm" onClick={() => setNotes([...notes,""])} className="border-dashed border-2 hover:border-sys-tertiary" > <Plus size={16} className="mr-2" /> Add Line Note </Button> </div> </Card> </div> </DocumentTemplate> );
> 16 | } export default function CreateDCPage() { return ( <Suspense fallback={ <div className="p-32 text-center"> <Body className="text-sys-tertiary animate-pulse"> Loading template... </Body> </div> } > <CreateDCPageContent /> </Suspense> );
     |   ^
  17 | }
  18 |

Expected a semicolon


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/create/page.tsx:16:2
Parsing ecmascript source code failed
  14 | import { formatIndianCurrency, formatDate } from"@/lib/utils";
  15 | import { api } from"@/lib/api"; export default function CreatePOPage() { const router = useRouter(); const initialData = { header: { po_number:"", po_date: new Date().toISOString().split("T")[0], supplier_name:"", supplier_code:"", supplier_phone:"", supplier_fax:"", supplier_email:"", department_no:"", enquiry_no:"", enquiry_date:"", quotation_ref:"", quotation_date:"", rc_no:"", order_type:"", po_status:"New", amend_no: 0, po_value: 0, fob_value: 0, net_po_value: 0, tin_no:"", ecc_no:"", mpct_no:"", inspection_by:"", inspection_at:"BHEL Works, Bhopal", consignee_name:"BHEL BHOPAL", consignee_address:"PIPLANI, BHOPAL, MADHYA PRADESH, 462022", issuer_name:"", issuer_designation:"", issuer_phone:"", remarks:"", }, items: [], }; const [data, setData] = useState<any>(initialData); const [activeTab, setActiveTab] = useState("basic"); const [saving, setSaving] = useState(false); const addItem = useCallback(() => { setData((prev: any) => { const maxItemNo = prev.items.length > 0 ? Math.max(...prev.items.map((i: any) => i.po_item_no || 0)) : 0; const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"", drg_no:"", unit:"NOS", ord_qty: 0, po_rate: 0, item_value: 0, deliveries: [], }; return { ...prev, items: [...prev.items, newItem] }; }); }, []); const removeItem = useCallback((itemNo: number) => { setData((prev: any) => ({ ...prev, items: prev.items.filter((i: any) => i.po_item_no !== itemNo), })); }, []); const handleSave = useCallback(async () => { if (!data.header.po_number) { alert("PO Number is required"); return; } setSaving(true); try { // Map frontend data to backend PODetail schema const payload = { header: { ...data.header, po_number: parseInt(data.header.po_number), po_date: data.header.po_date, }, items: data.items.map((item: any) => ({ po_item_no: item.po_item_no, material_code: item.material_code, material_description: item.material_description, drg_no: item.drg_no, unit: item.unit, po_rate: item.po_rate, ordered_quantity: item.ord_qty, item_value: item.item_value, deliveries: [], // Simple manual PO creation defaults to one delivery in backend })), }; await api.createPO(payload); router.push(`/po/${data.header.po_number}`); } catch (err: any) { console.error("Save Error:", err); alert(err.message ||"Failed to save Purchase Order"); } finally { setSaving(false); } }, [data, router]); const { header, items } = data; const updateHeader = (field: string, value: any) => { setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="ord_qty" || field ==="po_rate") { newItems[index].item_value = (newItems[index].ord_qty || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const topActions = ( <div className="flex items-center gap-2"> <Button variant="outline" size="sm" onClick={() => router.back()} disabled={saving} > Cancel </Button> <Button variant="default" size="sm" onClick={handleSave} disabled={saving}> {saving ? ( <Loader2 size={16} className="animate-spin mr-2" /> ) : ( <Save size={16} className="mr-2" /> )} {saving ?"Saving..." :"Save PO"} </Button> </div> ); return ( <DocumentTemplate title="Create Purchase Order" description="Enter procurement contract details manually" actions={topActions} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId="create-po-icon" > <div className="mb-6"> <DocumentJourney currentStage="PO" /> </div> <div className="space-y-6"> {/* Tabs for Header Info */} <Tabs value={activeTab} onValueChange={setActiveTab}> <TabsList className="mb-4 bg-[var(--color-sys-bg-tertiary)]/30 p-1 rounded-xl"> <TabsTrigger value="basic">Basic Info</TabsTrigger> <TabsTrigger value="supplier">Supplier</TabsTrigger> <TabsTrigger value="references">References</TabsTrigger> <TabsTrigger value="financial">Financial</TabsTrigger> <TabsTrigger value="issuer">Issuer</TabsTrigger> <TabsTrigger value="consignee">Consignee</TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0, y: 4 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -4 }} transition={{ duration: 0.15, ease:"easeOut" }} > <Card className="p-6"> <TabsContent value="basic" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> PO Number </Label> <Input id="po-number" name="po-number" value={header.po_number} onChange={(e) => updateHeader("po_number", e.target.value) } placeholder="e.g. 4500012345" className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> PO Date </Label> <div className="bg-sys-bg-white/40 backdrop-blur-md px-3 py-1.5 rounded-xl border border-sys-bg-white/50 shadow-sm focus-within:ring-2 focus-within:ring-[var(--color-sys-brand-primary)]/10 transition-all flex items-center gap-2"> <Calendar size={14} className="text-[var(--color-sys-brand-primary)]" /> <Input id="po-date" name="po-date" type="date" value={header.po_date} onChange={(e) => updateHeader("po_date", e.target.value) } className="font-bold text-[var(--color-sys-text-primary)] bg-transparent border-none p-0 focus:ring-0 cursor-pointer" /> </div> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Department No </Label> <Input value={header.department_no} onChange={(e) => updateHeader("department_no", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> </div> </TabsContent> <TabsContent value="supplier" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-2 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Supplier Name </Label> <Input id="supplier-name" name="supplier-name" value={header.supplier_name} onChange={(e) => updateHeader("supplier_name", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Supplier Code </Label> <Input id="supplier-code" name="supplier-code" value={header.supplier_code} onChange={(e) => updateHeader("supplier_code", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Phone </Label> <Input value={header.supplier_phone} onChange={(e) => updateHeader("supplier_phone", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Email </Label> <Input type="email" value={header.supplier_email} onChange={(e) => updateHeader("supplier_email", e.target.value) } className="font-medium text-slate-930" /> </div> </div> </TabsContent> <TabsContent value="references" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Enquiry No </Label> <Input value={header.enquiry_no} onChange={(e) => updateHeader("enquiry_no", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> RC Number </Label> <Input value={header.rc_no} onChange={(e) => updateHeader("rc_no", e.target.value)} className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Order Type </Label> <Input value={header.order_type} onChange={(e) => updateHeader("order_type", e.target.value) } className="font-medium text-slate-930" /> </div> </div> </TabsContent> <TabsContent value="financial" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> TIN Number </Label> <Input value={header.tin_no} onChange={(e) => updateHeader("tin_no", e.target.value)} className="font-medium text-[var(--color-sys-text-primary)] font-mono" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> ECC Number </Label> <Input value={header.ecc_no} onChange={(e) => updateHeader("ecc_no", e.target.value)} className="font-medium text-[var(--color-sys-text-primary)] font-mono" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> MPCT Number </Label> <Input value={header.mpct_no} onChange={(e) => updateHeader("mpct_no", e.target.value) } className="font-medium text-slate-930 font-mono" /> </div> </div> </TabsContent> <TabsContent value="issuer" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Issuer Name </Label> <Input value={header.issuer_name} onChange={(e) => updateHeader("issuer_name", e.target.value) } className="font-medium text-slate-930" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Designation </Label> <Input value={header.issuer_designation} onChange={(e) => updateHeader("issuer_designation", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="col-span-full space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Remarks </Label> <textarea id="remarks" name="remarks" value={header.remarks} onChange={(e) => updateHeader("remarks", e.target.value) } className="w-full px-3 py-2 text-[13px] font-medium text-slate-930 bg-sys-bg-white border border-sys-tertiary/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-sys-primary/10 focus:border-sys-tertiary resize-none transition-all" rows={3} placeholder="Additional project information..." /> </div> </div> </TabsContent> <TabsContent value="consignee" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-2 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Consignee Name </Label> <Input value={header.consignee_name} onChange={(e) => updateHeader("consignee_name", e.target.value) } className="font-medium text-slate-930" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Consignee Address </Label> <textarea value={header.consignee_address} onChange={(e) => updateHeader("consignee_address", e.target.value) } className="w-full px-3 py-2 text-[13px] font-medium text-slate-930 bg-sys-bg-white border border-sys-tertiary/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-sys-primary/10 focus:border-sys-tertiary resize-none transition-all" rows={3} /> </div> </div> </TabsContent> </Card> </motion.div> </AnimatePresence> </Tabs> {/* Items Section */} <div className="space-y-4"> <div className="flex items-center justify-between px-1"> <H3 className="font-medium text-[var(--color-sys-text-primary)]"> Material Items ({items.length}) </H3> <Button color="secondary" size="sm" onClick={addItem}> <Plus size={16} className="mr-2" /> Add Item </Button> </div> <Card className="p-0 overflow-hidden border-none shadow-sm"> <div className="overflow-x-auto"> <table className="w-full"> <thead> <tr className="border-b border-[var(--color-sys-text-tertiary)]/10 bg-[var(--color-sys-bg-tertiary)]/30"> <th className="py-3 px-6 text-left"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> # </Label> </th> <th className="py-3 px-6 text-left"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Material Details </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Qty </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Rate </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Value </Label> </th> <th className="py-3 px-6 w-16"></th> </tr> </thead> <tbody> {items.length > 0 ? ( items.map((item: any, idx: number) => ( <tr key={idx} className="border-b border-[var(--color-sys-text-tertiary)]/5 hover:bg-[var(--color-sys-bg-tertiary)]/5 transition-colors" > <td className="py-4 px-6"> <Accounting className="font-medium text-[var(--color-sys-text-primary)]"> {item.po_item_no} </Accounting> </td> <td className="py-4 px-6 space-y-3 min-w-[300px]"> <Input value={item.material_description} onChange={(e) => updateItem( idx,"material_description", e.target.value, ) } placeholder="Material Description" className="font-medium text-[var(--color-sys-text-primary)]" /> <div className="grid grid-cols-3 gap-2"> <div> <Label className="text-[9px] uppercase text-[var(--color-sys-text-tertiary)] ml-1"> Code </Label> <Input value={item.material_code} onChange={(e) => updateItem( idx,"material_code", e.target.value, ) } placeholder="Code" className="font-medium text-[var(--color-sys-text-primary)] h-8" /> </div> <div> <Label className="text-[9px] uppercase text-[var(--color-sys-text-tertiary)] ml-1"> Drawing </Label> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value) } placeholder="DRG" className="font-medium text-[var(--color-sys-text-primary)] h-8" /> </div> <div> <Label className="text-[9px] uppercase text-sys-tertiary ml-1"> Unit </Label> <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value) } placeholder="Unit" className="font-medium text-slate-930 h-8 uppercase" /> </div> </div> </td> <td className="py-4 px-6"> <Input type="number" value={item.ord_qty} onChange={(e) => updateItem( idx,"ord_qty", parseFloat(e.target.value), ) } className="text-right font-medium font-mono" /> </td> <td className="py-4 px-6"> <Input type="number" value={item.po_rate} onChange={(e) => updateItem( idx,"po_rate", parseFloat(e.target.value), ) } className="text-right font-medium font-mono" /> </td> <td className="py-4 px-6 text-right"> <Accounting className="font-medium text-[var(--color-sys-text-primary)]"> {item.item_value} </Accounting> </td> <td className="py-4 px-6 text-center"> <Button variant="ghost" size="sm" onClick={() => removeItem(item.po_item_no)} className="text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-status-error)]" > <Trash2 size={16} /> </Button> </td> </tr> )) ) : ( <tr> <td colSpan={6} className="py-24 text-center"> <div className="flex flex-col items-center justify-center opacity-40"> <Package className="w-12 h-12 text-[var(--color-sys-text-tertiary)]/30 mb-3 stroke-[1.5]" /> <Body className="text-[var(--color-sys-text-tertiary)]/60 font-medium"> No material items defined yet </Body> </div> </td> </tr> )} </tbody> </table> </div> {items.length > 0 && ( <div className="bg-[var(--color-sys-bg-tertiary)]/30 border-t border-[var(--color-sys-text-tertiary)]/10 p-8 flex justify-end"> <div className="text-right flex items-center gap-8"> <Label className="text-[11px] uppercase tracking-[0.2em] text-[var(--color-sys-text-secondary)] font-medium"> Estimated Total Value </Label> <Accounting isCurrency className="font-medium text-[var(--color-sys-text-primary)]" > {items.reduce( (acc: number, cur: any) => acc + (cur.item_value || 0), 0, )} </Accounting> </div> </div> )} </Card> </div> </div> </DocumentTemplate> );
> 16 | }
     |  ^
  17 |

Expected '}', got '<eof>'


./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/create/page.tsx:16:2
Parsing ecmascript source code failed
  14 | import { formatIndianCurrency, formatDate } from"@/lib/utils";
  15 | import { api } from"@/lib/api"; export default function CreatePOPage() { const router = useRouter(); const initialData = { header: { po_number:"", po_date: new Date().toISOString().split("T")[0], supplier_name:"", supplier_code:"", supplier_phone:"", supplier_fax:"", supplier_email:"", department_no:"", enquiry_no:"", enquiry_date:"", quotation_ref:"", quotation_date:"", rc_no:"", order_type:"", po_status:"New", amend_no: 0, po_value: 0, fob_value: 0, net_po_value: 0, tin_no:"", ecc_no:"", mpct_no:"", inspection_by:"", inspection_at:"BHEL Works, Bhopal", consignee_name:"BHEL BHOPAL", consignee_address:"PIPLANI, BHOPAL, MADHYA PRADESH, 462022", issuer_name:"", issuer_designation:"", issuer_phone:"", remarks:"", }, items: [], }; const [data, setData] = useState<any>(initialData); const [activeTab, setActiveTab] = useState("basic"); const [saving, setSaving] = useState(false); const addItem = useCallback(() => { setData((prev: any) => { const maxItemNo = prev.items.length > 0 ? Math.max(...prev.items.map((i: any) => i.po_item_no || 0)) : 0; const newItem = { po_item_no: maxItemNo + 1, material_code:"", material_description:"", drg_no:"", unit:"NOS", ord_qty: 0, po_rate: 0, item_value: 0, deliveries: [], }; return { ...prev, items: [...prev.items, newItem] }; }); }, []); const removeItem = useCallback((itemNo: number) => { setData((prev: any) => ({ ...prev, items: prev.items.filter((i: any) => i.po_item_no !== itemNo), })); }, []); const handleSave = useCallback(async () => { if (!data.header.po_number) { alert("PO Number is required"); return; } setSaving(true); try { // Map frontend data to backend PODetail schema const payload = { header: { ...data.header, po_number: parseInt(data.header.po_number), po_date: data.header.po_date, }, items: data.items.map((item: any) => ({ po_item_no: item.po_item_no, material_code: item.material_code, material_description: item.material_description, drg_no: item.drg_no, unit: item.unit, po_rate: item.po_rate, ordered_quantity: item.ord_qty, item_value: item.item_value, deliveries: [], // Simple manual PO creation defaults to one delivery in backend })), }; await api.createPO(payload); router.push(`/po/${data.header.po_number}`); } catch (err: any) { console.error("Save Error:", err); alert(err.message ||"Failed to save Purchase Order"); } finally { setSaving(false); } }, [data, router]); const { header, items } = data; const updateHeader = (field: string, value: any) => { setData({ ...data, header: { ...data.header, [field]: value }, }); }; const updateItem = (index: number, field: string, value: any) => { const newItems = [...data.items]; newItems[index] = { ...newItems[index], [field]: value }; if (field ==="ord_qty" || field ==="po_rate") { newItems[index].item_value = (newItems[index].ord_qty || 0) * (newItems[index].po_rate || 0); } setData({ ...data, items: newItems }); }; const topActions = ( <div className="flex items-center gap-2"> <Button variant="outline" size="sm" onClick={() => router.back()} disabled={saving} > Cancel </Button> <Button variant="default" size="sm" onClick={handleSave} disabled={saving}> {saving ? ( <Loader2 size={16} className="animate-spin mr-2" /> ) : ( <Save size={16} className="mr-2" /> )} {saving ?"Saving..." :"Save PO"} </Button> </div> ); return ( <DocumentTemplate title="Create Purchase Order" description="Enter procurement contract details manually" actions={topActions} icon={<FileText size={20} className="text-[var(--color-sys-brand-primary)]" />} iconLayoutId="create-po-icon" > <div className="mb-6"> <DocumentJourney currentStage="PO" /> </div> <div className="space-y-6"> {/* Tabs for Header Info */} <Tabs value={activeTab} onValueChange={setActiveTab}> <TabsList className="mb-4 bg-[var(--color-sys-bg-tertiary)]/30 p-1 rounded-xl"> <TabsTrigger value="basic">Basic Info</TabsTrigger> <TabsTrigger value="supplier">Supplier</TabsTrigger> <TabsTrigger value="references">References</TabsTrigger> <TabsTrigger value="financial">Financial</TabsTrigger> <TabsTrigger value="issuer">Issuer</TabsTrigger> <TabsTrigger value="consignee">Consignee</TabsTrigger> </TabsList> <AnimatePresence mode="wait"> <motion.div key={activeTab} initial={{ opacity: 0, y: 4 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -4 }} transition={{ duration: 0.15, ease:"easeOut" }} > <Card className="p-6"> <TabsContent value="basic" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> PO Number </Label> <Input id="po-number" name="po-number" value={header.po_number} onChange={(e) => updateHeader("po_number", e.target.value) } placeholder="e.g. 4500012345" className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> PO Date </Label> <div className="bg-sys-bg-white/40 backdrop-blur-md px-3 py-1.5 rounded-xl border border-sys-bg-white/50 shadow-sm focus-within:ring-2 focus-within:ring-[var(--color-sys-brand-primary)]/10 transition-all flex items-center gap-2"> <Calendar size={14} className="text-[var(--color-sys-brand-primary)]" /> <Input id="po-date" name="po-date" type="date" value={header.po_date} onChange={(e) => updateHeader("po_date", e.target.value) } className="font-bold text-[var(--color-sys-text-primary)] bg-transparent border-none p-0 focus:ring-0 cursor-pointer" /> </div> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Department No </Label> <Input value={header.department_no} onChange={(e) => updateHeader("department_no", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> </div> </TabsContent> <TabsContent value="supplier" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-2 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Supplier Name </Label> <Input id="supplier-name" name="supplier-name" value={header.supplier_name} onChange={(e) => updateHeader("supplier_name", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Supplier Code </Label> <Input id="supplier-code" name="supplier-code" value={header.supplier_code} onChange={(e) => updateHeader("supplier_code", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Phone </Label> <Input value={header.supplier_phone} onChange={(e) => updateHeader("supplier_phone", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Email </Label> <Input type="email" value={header.supplier_email} onChange={(e) => updateHeader("supplier_email", e.target.value) } className="font-medium text-slate-930" /> </div> </div> </TabsContent> <TabsContent value="references" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Enquiry No </Label> <Input value={header.enquiry_no} onChange={(e) => updateHeader("enquiry_no", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> RC Number </Label> <Input value={header.rc_no} onChange={(e) => updateHeader("rc_no", e.target.value)} className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Order Type </Label> <Input value={header.order_type} onChange={(e) => updateHeader("order_type", e.target.value) } className="font-medium text-slate-930" /> </div> </div> </TabsContent> <TabsContent value="financial" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> TIN Number </Label> <Input value={header.tin_no} onChange={(e) => updateHeader("tin_no", e.target.value)} className="font-medium text-[var(--color-sys-text-primary)] font-mono" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> ECC Number </Label> <Input value={header.ecc_no} onChange={(e) => updateHeader("ecc_no", e.target.value)} className="font-medium text-[var(--color-sys-text-primary)] font-mono" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> MPCT Number </Label> <Input value={header.mpct_no} onChange={(e) => updateHeader("mpct_no", e.target.value) } className="font-medium text-slate-930 font-mono" /> </div> </div> </TabsContent> <TabsContent value="issuer" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-3 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Issuer Name </Label> <Input value={header.issuer_name} onChange={(e) => updateHeader("issuer_name", e.target.value) } className="font-medium text-slate-930" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Designation </Label> <Input value={header.issuer_designation} onChange={(e) => updateHeader("issuer_designation", e.target.value) } className="font-medium text-[var(--color-sys-text-primary)]" /> </div> <div className="col-span-full space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Remarks </Label> <textarea id="remarks" name="remarks" value={header.remarks} onChange={(e) => updateHeader("remarks", e.target.value) } className="w-full px-3 py-2 text-[13px] font-medium text-slate-930 bg-sys-bg-white border border-sys-tertiary/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-sys-primary/10 focus:border-sys-tertiary resize-none transition-all" rows={3} placeholder="Additional project information..." /> </div> </div> </TabsContent> <TabsContent value="consignee" className="mt-0"> <div className="grid grid-cols-1 md:grid-cols-2 gap-6"> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Consignee Name </Label> <Input value={header.consignee_name} onChange={(e) => updateHeader("consignee_name", e.target.value) } className="font-medium text-slate-930" /> </div> <div className="space-y-1.5"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-secondary)] font-medium"> Consignee Address </Label> <textarea value={header.consignee_address} onChange={(e) => updateHeader("consignee_address", e.target.value) } className="w-full px-3 py-2 text-[13px] font-medium text-slate-930 bg-sys-bg-white border border-sys-tertiary/20 rounded-xl focus:outline-none focus:ring-2 focus:ring-sys-primary/10 focus:border-sys-tertiary resize-none transition-all" rows={3} /> </div> </div> </TabsContent> </Card> </motion.div> </AnimatePresence> </Tabs> {/* Items Section */} <div className="space-y-4"> <div className="flex items-center justify-between px-1"> <H3 className="font-medium text-[var(--color-sys-text-primary)]"> Material Items ({items.length}) </H3> <Button color="secondary" size="sm" onClick={addItem}> <Plus size={16} className="mr-2" /> Add Item </Button> </div> <Card className="p-0 overflow-hidden border-none shadow-sm"> <div className="overflow-x-auto"> <table className="w-full"> <thead> <tr className="border-b border-[var(--color-sys-text-tertiary)]/10 bg-[var(--color-sys-bg-tertiary)]/30"> <th className="py-3 px-6 text-left"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> # </Label> </th> <th className="py-3 px-6 text-left"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Material Details </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Qty </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Rate </Label> </th> <th className="py-3 px-6 text-right"> <Label className="text-[10px] uppercase tracking-widest text-[var(--color-sys-text-tertiary)] font-medium"> Value </Label> </th> <th className="py-3 px-6 w-16"></th> </tr> </thead> <tbody> {items.length > 0 ? ( items.map((item: any, idx: number) => ( <tr key={idx} className="border-b border-[var(--color-sys-text-tertiary)]/5 hover:bg-[var(--color-sys-bg-tertiary)]/5 transition-colors" > <td className="py-4 px-6"> <Accounting className="font-medium text-[var(--color-sys-text-primary)]"> {item.po_item_no} </Accounting> </td> <td className="py-4 px-6 space-y-3 min-w-[300px]"> <Input value={item.material_description} onChange={(e) => updateItem( idx,"material_description", e.target.value, ) } placeholder="Material Description" className="font-medium text-[var(--color-sys-text-primary)]" /> <div className="grid grid-cols-3 gap-2"> <div> <Label className="text-[9px] uppercase text-[var(--color-sys-text-tertiary)] ml-1"> Code </Label> <Input value={item.material_code} onChange={(e) => updateItem( idx,"material_code", e.target.value, ) } placeholder="Code" className="font-medium text-[var(--color-sys-text-primary)] h-8" /> </div> <div> <Label className="text-[9px] uppercase text-[var(--color-sys-text-tertiary)] ml-1"> Drawing </Label> <Input value={item.drg_no} onChange={(e) => updateItem(idx,"drg_no", e.target.value) } placeholder="DRG" className="font-medium text-[var(--color-sys-text-primary)] h-8" /> </div> <div> <Label className="text-[9px] uppercase text-sys-tertiary ml-1"> Unit </Label> <Input value={item.unit} onChange={(e) => updateItem(idx,"unit", e.target.value) } placeholder="Unit" className="font-medium text-slate-930 h-8 uppercase" /> </div> </div> </td> <td className="py-4 px-6"> <Input type="number" value={item.ord_qty} onChange={(e) => updateItem( idx,"ord_qty", parseFloat(e.target.value), ) } className="text-right font-medium font-mono" /> </td> <td className="py-4 px-6"> <Input type="number" value={item.po_rate} onChange={(e) => updateItem( idx,"po_rate", parseFloat(e.target.value), ) } className="text-right font-medium font-mono" /> </td> <td className="py-4 px-6 text-right"> <Accounting className="font-medium text-[var(--color-sys-text-primary)]"> {item.item_value} </Accounting> </td> <td className="py-4 px-6 text-center"> <Button variant="ghost" size="sm" onClick={() => removeItem(item.po_item_no)} className="text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-status-error)]" > <Trash2 size={16} /> </Button> </td> </tr> )) ) : ( <tr> <td colSpan={6} className="py-24 text-center"> <div className="flex flex-col items-center justify-center opacity-40"> <Package className="w-12 h-12 text-[var(--color-sys-text-tertiary)]/30 mb-3 stroke-[1.5]" /> <Body className="text-[var(--color-sys-text-tertiary)]/60 font-medium"> No material items defined yet </Body> </div> </td> </tr> )} </tbody> </table> </div> {items.length > 0 && ( <div className="bg-[var(--color-sys-bg-tertiary)]/30 border-t border-[var(--color-sys-text-tertiary)]/10 p-8 flex justify-end"> <div className="text-right flex items-center gap-8"> <Label className="text-[11px] uppercase tracking-[0.2em] text-[var(--color-sys-text-secondary)] font-medium"> Estimated Total Value </Label> <Accounting isCurrency className="font-medium text-[var(--color-sys-text-primary)]" > {items.reduce( (acc: number, cur: any) => acc + (cur.item_value || 0), 0, )} </Accounting> </div> </div> )} </Card> </div> </div> </DocumentTemplate> );
> 16 | }
     |  ^
  17 |

Expected a semicolon


./.gemini/antigravity/scratch/SenstoSales/frontend/app/reports/page.tsx:20:1
Parsing ecmascript source code failed
  18 | import { Flex, Stack, Box, Grid } from"@/components/design-system/atoms/Layout"; type ReportType = |"sales" |"dc_register" |"invoice_register" |"pending" |"reconciliation"; // --- FIX 2: Static Column Definitions (Moved Outside Component) ---
  19 | // This prevents the Table from re-rendering on every keystroke. const salesColumns: Column<any>[] = [ { key:"month", label:"MONTH", render: (_v, row) => ( <Body className="font-medium text-[var(--color-sys-brand-primary)]">{row.month}</Body> ), }, { key:"invoice_count", label:"INVOICES", align:"right", render: (_v, row) => ( <Accounting className="font-medium">{row.invoice_count}</Accounting> ), }, { key:"total_taxable", label:"TAXABLE", align:"right", render: (_v, row) => ( <Accounting className="font-medium"> {formatIndianCurrency(row.total_taxable)} </Accounting> ), }, { key:"total_value", label:"TOTAL VALUE", align:"right", render: (_v, row) => ( <Accounting className="text-[var(--color-sys-status-success)] font-medium"> {formatIndianCurrency(row.total_value)} </Accounting> ), },
> 20 | ]; const dcColumns: Column<any>[] = [ { key:"dc_number", label:"DC NUMBER", render: (_v, row) => ( <Body className="text-[var(--color-sys-brand-primary)] font-bold">DC-{row.dc_number}</Body> ), }, { key:"dc_date", label:"DATE", render: (_v, row) => ( <Body className="text-[var(--color-sys-text-secondary)] font-medium"> {formatDate(row.dc_date)} </Body> ), }, { key:"po_number", label:"PO REF", render: (_v, row) => ( <Body className="text-[var(--color-sys-text-secondary)] font-medium">{row.po_number}</Body> ), }, { key:"consignee_name", label:"CONSIGNEE", render: (_v, row) => ( <Body className="max-w-[200px] truncate font-medium"> {row.consignee_name} </Body> ), }, { key:"total_qty", label:"QTY", align:"right", render: (_v, row) => ( <Accounting className="font-medium">{row.total_qty}</Accounting> ), },
     | ^
  21 | ]; const invoiceColumns: Column<any>[] = [ { key:"invoice_number", label:"INVOICE NO", render: (_v, row) => ( <Body className="text-[var(--color-sys-brand-primary)] font-bold">{row.invoice_number}</Body> ), }, { key:"invoice_date", label:"DATE", render: (_v, row) => ( <Body className="font-medium">{formatDate(row.invoice_date)}</Body> ), }, { key:"customer_gstin", label:"CUSTOMER GST", render: (_v, row) => ( <Body className="font-mono text-[11px] font-medium"> {row.customer_gstin} </Body> ), }, { key:"taxable_value", label:"TAXABLE", align:"right", render: (_v, row) => ( <Accounting className="font-medium"> {formatIndianCurrency(row.taxable_value)} </Accounting> ), }, { key:"total_invoice_value", label:"TOTAL", align:"right", render: (_v, row) => ( <Accounting className="text-[var(--color-sys-text-primary)] font-bold"> {formatIndianCurrency(row.total_invoice_value)} </Accounting> ), },
  22 | ]; const pendingColumns: Column<any>[] = [ { key:"po_number", label:"PO NUMBER", width:"15%", render: (_v, row) => ( <Body className="text-[var(--color-sys-brand-primary)] font-bold">{row.po_number}</Body> ), }, { key:"material_description", label:"MATERIAL", width:"30%", render: (_v, row) => ( <Box className="w-[180px] lg:w-[280px] truncate" title={row.material_description}> <TableText className="truncate block"> {row.material_description} </TableText> </Box> ), }, { key:"ord_qty", label:"ORD", width:"10%", align:"right", render: (_v, row) => ( <Accounting className="font-medium">{row.ord_qty}</Accounting> ), }, { key:"delivered_qty", label:"DELIVERED", width:"20%", align:"right", render: (_v, row) => ( <Accounting className="text-[var(--color-sys-status-success)] font-medium"> {row.delivered_qty} </Accounting> ), }, { key:"pending_qty", label:"PENDING", width:"20%", align:"right", render: (_v, row) => ( <Accounting className="text-[var(--color-sys-status-warning)] font-bold"> {row.pending_qty} </Accounting> ), },
  23 | ]; const reconciliationColumns: Column<any>[] = [ { key:"po_number", label:"PO NUMBER", width:"15%", render: (_v, row) => ( <Body className="text-[var(--color-sys-brand-primary)] font-bold">{row.po_number}</Body> ), }, { key:"item_description", label:"ITEM", width:"35%", render: (_v, row) => ( <Box className="w-[200px] lg:w-[320px] truncate" title={row.item_description}> <TableText className="truncate block"> {row.item_description} </TableText> </Box> ), }, { key:"ordered_qty", label:"ORD", width:"10%", align:"right", render: (_v, row) => ( <Accounting className="font-medium">{row.ordered_qty}</Accounting> ), }, { key:"total_dispatched", label:"DISP", width:"10%", align:"right", render: (_v, row) => ( <Accounting className="font-medium">{row.total_dispatched}</Accounting> ), }, { key:"total_accepted", label:"ACC", width:"15%", align:"right", render: (_v, row) => ( <Accounting className="text-[var(--color-sys-status-success)] font-bold"> {row.total_accepted} </Accounting> ), }, { key:"total_rejected", label:"REJ", width:"15%", align:"right", render: (_v, row) => ( <Accounting className="text-[var(--color-sys-status-error)] font-bold"> {row.total_rejected} </Accounting> ), },

Expression expected


./.gemini/antigravity/scratch/SenstoSales/frontend/app/srv/page.tsx:21:2
Parsing ecmascript source code failed
  19 | import { type SummaryCardProps } from"@/components/design-system/organisms/SummaryCards";
  20 | import { Flex, Stack, Box } from"@/components/design-system/atoms/Layout"; export default function SRVListPage() { const router = useRouter(); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [stats, setStats] = useState<SRVStats | null>(null); const [loading, setLoading] = useState(true); const [page, setPage] = useState(1); const [pageSize, setPageSize] = useState(10); const [totalItems, setTotalItems] = useState(0); const [selectedFiles, setSelectedFiles] = useState<File[]>([]); const [uploading, setUploading] = useState(false); const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0, }); const isCancelled = useRef(false); const [searchQuery, setSearchQuery] = useState(""); const loadData = useCallback(async () => { try { setLoading(true); const [srvData, statsData] = await Promise.all([ api.listSRVs(), api.getSRVStats() ]); setSrvs(srvData); setStats(statsData); setTotalItems(statsData?.total_srvs || 0); } catch (err) { console.error(err); } finally { setLoading(false); } }, []); useEffect(() => { loadData(); }, [loadData, searchQuery, page, pageSize]); const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => { if (e.target.files) setSelectedFiles(Array.from(e.target.files)); }, []); const handleUpload = useCallback(async () => { if (selectedFiles.length === 0) return; setUploading(true); setUploadProgress({ current: 0, total: selectedFiles.length }); let processedCount = 0; try { const CHUNK_SIZE = 5; // Smaller chunk for SRVs initially for (let i = 0; i < selectedFiles.length; i += CHUNK_SIZE) { if (isCancelled.current) break; const chunk = selectedFiles.slice(i, i + CHUNK_SIZE); await api.uploadSRVBatch(chunk); processedCount += chunk.length; setUploadProgress({ current: processedCount, total: selectedFiles.length, }); // Brief delay for UI updates await new Promise((resolve) => setTimeout(resolve, 100)); } if (!isCancelled.current) { await loadData(); setSelectedFiles([]); } } catch (err) { console.error("Upload Error:", err); } finally { setUploading(false); isCancelled.current = false; } }, [selectedFiles, loadData]); const handleDelete = useCallback(async (srvNumber: string) => { if (!confirm(`Permanently delete SRV #${srvNumber}?`)) return; try { await api.deleteSRV(srvNumber); await loadData(); } catch (err) { console.error(err); } }, [loadData]); const columns: Column<SRVListItem>[] = useMemo(() => [ { key:"srv_number", label:"SRV VOUCHER", width:"15%", render: (v) => ( <Link href={`/srv/${v}`} className="group flex items-center gap-1" > <Body className="font-semibold text-[var(--color-sys-brand-primary)] group-hover:underline">{String(v)}</Body> <ChevronRight size={12} className="text-[var(--color-sys-brand-primary)]/50 group-hover:text-[var(--color-sys-brand-primary)] transition-colors" /> </Link> ), }, { key:"srv_date", label:"DATE", width:"12%", render: (v) => ( <Body className="text-[var(--color-sys-text-secondary)]">{formatDate(v as string)}</Body> ), }, { key:"po_number", label:"PO REFERENCE", width:"12%", render: (v, row) => ( <Flex align="center" gap={2}> <Link href={`/po/${v}`} className="px-2 py-1 rounded-lg bg-[var(--color-sys-bg-tertiary)]/50 text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)] transition-colors border-none flex items-center gap-1.5"> <SmallText className="font-extrabold tracking-tight leading-none">#{String(v)}</SmallText> </Link> {!row.po_found && ( <AlertCircle size={14} className="text-[var(--color-sys-status-error)]" /> )} </Flex> ), }, { key:"total_accepted_qty", label:"ACCEPTED", align:"right", width:"12%", isNumeric: true, render: (v) => ( <Accounting className="text-[var(--color-sys-status-success)] font-black">{v}</Accounting> ), }, { key:"total_rejected_qty", label:"REJECTED", align:"right", width:"12%", isNumeric: true, render: (v) => ( <Accounting className={cn( Number(v) > 0 ?"text-[var(--color-sys-status-error)] font-bold" :"text-[var(--color-sys-text-tertiary)] font-medium", )} > {v} </Accounting> ), }, { key:"actions", label:"", width:"5%", render: (_, row) => ( <Button variant="ghost" size="sm" onClick={() => handleDelete(row.srv_number)} className="text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-status-error)]"> <Trash2 size={14} /> </Button> ) } ], [handleDelete]); const summaryCards: SummaryCardProps[] = useMemo(() => [ { title:"Active Vouchers", value: stats?.total_srvs || 0, icon: <Layers size={20} />, variant:"primary", }, { title:"Accepted Volume", value: stats?.total_received_qty || 0, icon: <CheckCircle2 size={20} />, variant:"success", }, { title:"Rejection Rate", value: `${stats?.rejection_rate || 0}%`, icon: <XCircle size={20} />, variant:"error", }, ], [stats]); const filteredData = useMemo(() => { if (!searchQuery) return srvs; const q = searchQuery.toLowerCase(); return srvs.filter(s => s.srv_number?.toLowerCase().includes(q) || s.po_number?.toString().includes(q) ); }, [srvs, searchQuery]); const fileInputRef = useRef<HTMLInputElement>(null); const handleUploadClick = useCallback(() => { fileInputRef.current?.click(); }, []); // Master Reference: Toolbar Construction (Atomic) const handleSearch = useCallback((val: string) => { setSearchQuery(val); }, []); const toolbar = ( <Flex align="center" justify="between" className="w-full" gap={4}> <SearchBar value={searchQuery} onChange={handleSearch} placeholder="Filter by SRV or PO..." className="w-80" /> <Flex align="center" gap={3}> <AnimatePresence> {selectedFiles.length > 0 && !uploading && ( <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} > <Button variant="default" onClick={handleUpload} className="bg-[var(--color-sys-status-success)] hover:brightness-110 h-10 px-6 font-bold uppercase tracking-wider text-[10px]" > <Upload size={14} className="mr-2" /> Process {selectedFiles.length} SRVs </Button> </motion.div> )} </AnimatePresence> <input ref={fileInputRef} type="file" multiple accept=".html" onChange={handleFileSelect} className="hidden" /> <Button variant="secondary" size="default" className="h-10 border-none bg-[var(--color-sys-bg-tertiary)]/50 text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)] px-6 font-bold uppercase tracking-wider text-[10px] cursor-pointer" onClick={handleUploadClick} > <Plus size={16} className="mr-2" /> Add Documents </Button> </Flex> </Flex> ); return ( <> <ListPageTemplate title="MATERIAL RECEIPTS" subtitle="Comprehensive audit trail for Stores Receipt Vouchers (SRV)" columns={columns} data={filteredData} loading={loading} keyField="srv_number" summaryCards={summaryCards} toolbar={toolbar} page={page} pageSize={pageSize} totalItems={totalItems} onPageChange={(newPage) => setPage(newPage)} emptyMessage="No SRVs found" density="compact" no_borders={true} table_surface_solid={true} /> <Dialog isOpen={uploading || selectedFiles.length > 0} onClose={() => { if (!uploading) setSelectedFiles([]); }} > <DialogContent className="max-w-md border-none shadow-2xl bg-[var(--color-sys-bg-surface)]"> <DialogHeader> <DialogTitle className="text-[var(--color-sys-text-primary)]"> {uploading ?"BATCH INGESTION" :"CONFIRM SRV UPLOAD"} </DialogTitle> </DialogHeader> <Stack gap={6} className="py-4"> {!uploading ? ( <Stack align="center" gap={2} className="text-center"> <Box className="w-16 h-16 bg-[var(--color-sys-brand-primary)]/10 text-[var(--color-sys-brand-primary)] rounded-full flex items-center justify-center mx-auto mb-4"> <FileText size={32} /> </Box> <H3 className="text-[var(--color-sys-text-primary)]">{selectedFiles.length} Documents Selected</H3> <Body className="text-[var(--color-sys-text-secondary)]"> SRV HTML files will be parsed, items extracted, and linked to POs. </Body> </Stack> ) : ( <Stack gap={8}> {/* Cinematic Card Stack Animation */} <Flex align="center" justify="center" className="relative h-32 perspective-1000"> <AnimatePresence mode="popLayout"> {selectedFiles .slice(uploadProgress.current, uploadProgress.current + 3) .map((file, idx) => ( <motion.div key={file.name + idx} initial={{ opacity: 0, x: 50, scale: 0.8, rotate: 5 }} animate={{ opacity: 1 - idx * 0.3, x: idx * 10, z: -idx * 50, scale: 1 - idx * 0.05, rotate: idx * 2, }} exit={{ opacity: 0, x: -150, rotate: -15, transition: { duration: 0.4, ease:"circIn" }, }} className="absolute w-48 h-24 bg-[var(--color-sys-bg-surface)] border-none rounded-xl shadow-xl p-4 flex flex-col justify-between" style={{ boxShadow: `0 ${10 + idx * 5}px ${20 + idx * 10}px rgba(0,0,0,${0.1 - idx * 0.02})`, zIndex: 10 - idx, }} > <Flex align="center" gap={2}> <Box className="w-6 h-6 bg-[var(--color-sys-brand-primary)]/10 text-[var(--color-sys-brand-primary)] rounded flex items-center justify-center"> <FileText size={12} /> </Box> <SmallText className="uppercase text-[var(--color-sys-text-tertiary)] truncate w-full"> {file.name} </SmallText> </Flex> <Box className="h-1 w-full bg-[var(--color-sys-bg-tertiary)] rounded-full overflow-hidden"> <motion.div className="h-full bg-[var(--color-sys-status-success)] origin-left" initial={{ scaleX: 0 }} animate={{ scaleX: idx === 0 ? 1 : 0 }} transition={{ duration: 0.5 }} style={{ width:"100%" }} /> </Box> </motion.div> ))} </AnimatePresence> </Flex> <Stack gap={3}> <Flex justify="between" align="end"> <Stack> <Label className="text-[var(--color-sys-brand-primary)] uppercase mb-1"> Status </Label> <Body className="text-[var(--color-sys-text-primary)] font-medium whitespace-nowrap"> Processing {uploadProgress.current} of{""} {uploadProgress.total} files </Body> </Stack> <Stack align="end"> <Label className="text-[var(--color-sys-text-tertiary)] uppercase mb-1"> Progress </Label> <Body className="font-mono font-bold text-[var(--color-sys-text-primary)]"> {Math.round( (uploadProgress.current / uploadProgress.total) * 100, ) || 0} % </Body> </Stack> </Flex> <Box className="w-full bg-[var(--color-sys-bg-tertiary)] rounded-full h-1.5 overflow-hidden"> <motion.div className="bg-[var(--color-sys-brand-primary)] h-full origin-left" initial={{ scaleX: 0 }} animate={{ scaleX: uploadProgress.total > 0 ? (uploadProgress.current / uploadProgress.total) : 0, }} transition={{ duration: 0.3 }} style={{ width:"100%" }} /> </Box> </Stack> </Stack> )} </Stack> <Stack gap={3} className="w-full mt-4"> {!uploading ? ( <Button variant="default" onClick={handleUpload} className="w-full h-12 font-bold uppercase tracking-widest bg-[var(--color-sys-brand-primary)]" > <Upload size={18} className="mr-2" /> Start Processing </Button> ) : ( <Button variant="outline" onClick={() => { isCancelled.current = true; }} className="w-full h-12 border-[var(--color-sys-status-error)]/20 text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/5" > <X size={16} className="mr-2" /> Halt Operation </Button> )} </Stack> </DialogContent> </Dialog> </> );
> 21 | }
     |  ^
  22 |

Expected '}', got '<eof>'


./.gemini/antigravity/scratch/SenstoSales/frontend/app/srv/page.tsx:21:2
Parsing ecmascript source code failed
  19 | import { type SummaryCardProps } from"@/components/design-system/organisms/SummaryCards";
  20 | import { Flex, Stack, Box } from"@/components/design-system/atoms/Layout"; export default function SRVListPage() { const router = useRouter(); const [srvs, setSrvs] = useState<SRVListItem[]>([]); const [stats, setStats] = useState<SRVStats | null>(null); const [loading, setLoading] = useState(true); const [page, setPage] = useState(1); const [pageSize, setPageSize] = useState(10); const [totalItems, setTotalItems] = useState(0); const [selectedFiles, setSelectedFiles] = useState<File[]>([]); const [uploading, setUploading] = useState(false); const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0, }); const isCancelled = useRef(false); const [searchQuery, setSearchQuery] = useState(""); const loadData = useCallback(async () => { try { setLoading(true); const [srvData, statsData] = await Promise.all([ api.listSRVs(), api.getSRVStats() ]); setSrvs(srvData); setStats(statsData); setTotalItems(statsData?.total_srvs || 0); } catch (err) { console.error(err); } finally { setLoading(false); } }, []); useEffect(() => { loadData(); }, [loadData, searchQuery, page, pageSize]); const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => { if (e.target.files) setSelectedFiles(Array.from(e.target.files)); }, []); const handleUpload = useCallback(async () => { if (selectedFiles.length === 0) return; setUploading(true); setUploadProgress({ current: 0, total: selectedFiles.length }); let processedCount = 0; try { const CHUNK_SIZE = 5; // Smaller chunk for SRVs initially for (let i = 0; i < selectedFiles.length; i += CHUNK_SIZE) { if (isCancelled.current) break; const chunk = selectedFiles.slice(i, i + CHUNK_SIZE); await api.uploadSRVBatch(chunk); processedCount += chunk.length; setUploadProgress({ current: processedCount, total: selectedFiles.length, }); // Brief delay for UI updates await new Promise((resolve) => setTimeout(resolve, 100)); } if (!isCancelled.current) { await loadData(); setSelectedFiles([]); } } catch (err) { console.error("Upload Error:", err); } finally { setUploading(false); isCancelled.current = false; } }, [selectedFiles, loadData]); const handleDelete = useCallback(async (srvNumber: string) => { if (!confirm(`Permanently delete SRV #${srvNumber}?`)) return; try { await api.deleteSRV(srvNumber); await loadData(); } catch (err) { console.error(err); } }, [loadData]); const columns: Column<SRVListItem>[] = useMemo(() => [ { key:"srv_number", label:"SRV VOUCHER", width:"15%", render: (v) => ( <Link href={`/srv/${v}`} className="group flex items-center gap-1" > <Body className="font-semibold text-[var(--color-sys-brand-primary)] group-hover:underline">{String(v)}</Body> <ChevronRight size={12} className="text-[var(--color-sys-brand-primary)]/50 group-hover:text-[var(--color-sys-brand-primary)] transition-colors" /> </Link> ), }, { key:"srv_date", label:"DATE", width:"12%", render: (v) => ( <Body className="text-[var(--color-sys-text-secondary)]">{formatDate(v as string)}</Body> ), }, { key:"po_number", label:"PO REFERENCE", width:"12%", render: (v, row) => ( <Flex align="center" gap={2}> <Link href={`/po/${v}`} className="px-2 py-1 rounded-lg bg-[var(--color-sys-bg-tertiary)]/50 text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)] transition-colors border-none flex items-center gap-1.5"> <SmallText className="font-extrabold tracking-tight leading-none">#{String(v)}</SmallText> </Link> {!row.po_found && ( <AlertCircle size={14} className="text-[var(--color-sys-status-error)]" /> )} </Flex> ), }, { key:"total_accepted_qty", label:"ACCEPTED", align:"right", width:"12%", isNumeric: true, render: (v) => ( <Accounting className="text-[var(--color-sys-status-success)] font-black">{v}</Accounting> ), }, { key:"total_rejected_qty", label:"REJECTED", align:"right", width:"12%", isNumeric: true, render: (v) => ( <Accounting className={cn( Number(v) > 0 ?"text-[var(--color-sys-status-error)] font-bold" :"text-[var(--color-sys-text-tertiary)] font-medium", )} > {v} </Accounting> ), }, { key:"actions", label:"", width:"5%", render: (_, row) => ( <Button variant="ghost" size="sm" onClick={() => handleDelete(row.srv_number)} className="text-[var(--color-sys-text-tertiary)] hover:text-[var(--color-sys-status-error)]"> <Trash2 size={14} /> </Button> ) } ], [handleDelete]); const summaryCards: SummaryCardProps[] = useMemo(() => [ { title:"Active Vouchers", value: stats?.total_srvs || 0, icon: <Layers size={20} />, variant:"primary", }, { title:"Accepted Volume", value: stats?.total_received_qty || 0, icon: <CheckCircle2 size={20} />, variant:"success", }, { title:"Rejection Rate", value: `${stats?.rejection_rate || 0}%`, icon: <XCircle size={20} />, variant:"error", }, ], [stats]); const filteredData = useMemo(() => { if (!searchQuery) return srvs; const q = searchQuery.toLowerCase(); return srvs.filter(s => s.srv_number?.toLowerCase().includes(q) || s.po_number?.toString().includes(q) ); }, [srvs, searchQuery]); const fileInputRef = useRef<HTMLInputElement>(null); const handleUploadClick = useCallback(() => { fileInputRef.current?.click(); }, []); // Master Reference: Toolbar Construction (Atomic) const handleSearch = useCallback((val: string) => { setSearchQuery(val); }, []); const toolbar = ( <Flex align="center" justify="between" className="w-full" gap={4}> <SearchBar value={searchQuery} onChange={handleSearch} placeholder="Filter by SRV or PO..." className="w-80" /> <Flex align="center" gap={3}> <AnimatePresence> {selectedFiles.length > 0 && !uploading && ( <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} > <Button variant="default" onClick={handleUpload} className="bg-[var(--color-sys-status-success)] hover:brightness-110 h-10 px-6 font-bold uppercase tracking-wider text-[10px]" > <Upload size={14} className="mr-2" /> Process {selectedFiles.length} SRVs </Button> </motion.div> )} </AnimatePresence> <input ref={fileInputRef} type="file" multiple accept=".html" onChange={handleFileSelect} className="hidden" /> <Button variant="secondary" size="default" className="h-10 border-none bg-[var(--color-sys-bg-tertiary)]/50 text-[var(--color-sys-text-secondary)] hover:bg-[var(--color-sys-bg-tertiary)] px-6 font-bold uppercase tracking-wider text-[10px] cursor-pointer" onClick={handleUploadClick} > <Plus size={16} className="mr-2" /> Add Documents </Button> </Flex> </Flex> ); return ( <> <ListPageTemplate title="MATERIAL RECEIPTS" subtitle="Comprehensive audit trail for Stores Receipt Vouchers (SRV)" columns={columns} data={filteredData} loading={loading} keyField="srv_number" summaryCards={summaryCards} toolbar={toolbar} page={page} pageSize={pageSize} totalItems={totalItems} onPageChange={(newPage) => setPage(newPage)} emptyMessage="No SRVs found" density="compact" no_borders={true} table_surface_solid={true} /> <Dialog isOpen={uploading || selectedFiles.length > 0} onClose={() => { if (!uploading) setSelectedFiles([]); }} > <DialogContent className="max-w-md border-none shadow-2xl bg-[var(--color-sys-bg-surface)]"> <DialogHeader> <DialogTitle className="text-[var(--color-sys-text-primary)]"> {uploading ?"BATCH INGESTION" :"CONFIRM SRV UPLOAD"} </DialogTitle> </DialogHeader> <Stack gap={6} className="py-4"> {!uploading ? ( <Stack align="center" gap={2} className="text-center"> <Box className="w-16 h-16 bg-[var(--color-sys-brand-primary)]/10 text-[var(--color-sys-brand-primary)] rounded-full flex items-center justify-center mx-auto mb-4"> <FileText size={32} /> </Box> <H3 className="text-[var(--color-sys-text-primary)]">{selectedFiles.length} Documents Selected</H3> <Body className="text-[var(--color-sys-text-secondary)]"> SRV HTML files will be parsed, items extracted, and linked to POs. </Body> </Stack> ) : ( <Stack gap={8}> {/* Cinematic Card Stack Animation */} <Flex align="center" justify="center" className="relative h-32 perspective-1000"> <AnimatePresence mode="popLayout"> {selectedFiles .slice(uploadProgress.current, uploadProgress.current + 3) .map((file, idx) => ( <motion.div key={file.name + idx} initial={{ opacity: 0, x: 50, scale: 0.8, rotate: 5 }} animate={{ opacity: 1 - idx * 0.3, x: idx * 10, z: -idx * 50, scale: 1 - idx * 0.05, rotate: idx * 2, }} exit={{ opacity: 0, x: -150, rotate: -15, transition: { duration: 0.4, ease:"circIn" }, }} className="absolute w-48 h-24 bg-[var(--color-sys-bg-surface)] border-none rounded-xl shadow-xl p-4 flex flex-col justify-between" style={{ boxShadow: `0 ${10 + idx * 5}px ${20 + idx * 10}px rgba(0,0,0,${0.1 - idx * 0.02})`, zIndex: 10 - idx, }} > <Flex align="center" gap={2}> <Box className="w-6 h-6 bg-[var(--color-sys-brand-primary)]/10 text-[var(--color-sys-brand-primary)] rounded flex items-center justify-center"> <FileText size={12} /> </Box> <SmallText className="uppercase text-[var(--color-sys-text-tertiary)] truncate w-full"> {file.name} </SmallText> </Flex> <Box className="h-1 w-full bg-[var(--color-sys-bg-tertiary)] rounded-full overflow-hidden"> <motion.div className="h-full bg-[var(--color-sys-status-success)] origin-left" initial={{ scaleX: 0 }} animate={{ scaleX: idx === 0 ? 1 : 0 }} transition={{ duration: 0.5 }} style={{ width:"100%" }} /> </Box> </motion.div> ))} </AnimatePresence> </Flex> <Stack gap={3}> <Flex justify="between" align="end"> <Stack> <Label className="text-[var(--color-sys-brand-primary)] uppercase mb-1"> Status </Label> <Body className="text-[var(--color-sys-text-primary)] font-medium whitespace-nowrap"> Processing {uploadProgress.current} of{""} {uploadProgress.total} files </Body> </Stack> <Stack align="end"> <Label className="text-[var(--color-sys-text-tertiary)] uppercase mb-1"> Progress </Label> <Body className="font-mono font-bold text-[var(--color-sys-text-primary)]"> {Math.round( (uploadProgress.current / uploadProgress.total) * 100, ) || 0} % </Body> </Stack> </Flex> <Box className="w-full bg-[var(--color-sys-bg-tertiary)] rounded-full h-1.5 overflow-hidden"> <motion.div className="bg-[var(--color-sys-brand-primary)] h-full origin-left" initial={{ scaleX: 0 }} animate={{ scaleX: uploadProgress.total > 0 ? (uploadProgress.current / uploadProgress.total) : 0, }} transition={{ duration: 0.3 }} style={{ width:"100%" }} /> </Box> </Stack> </Stack> )} </Stack> <Stack gap={3} className="w-full mt-4"> {!uploading ? ( <Button variant="default" onClick={handleUpload} className="w-full h-12 font-bold uppercase tracking-widest bg-[var(--color-sys-brand-primary)]" > <Upload size={18} className="mr-2" /> Start Processing </Button> ) : ( <Button variant="outline" onClick={() => { isCancelled.current = true; }} className="w-full h-12 border-[var(--color-sys-status-error)]/20 text-[var(--color-sys-status-error)] hover:bg-[var(--color-sys-status-error)]/5" > <X size={16} className="mr-2" /> Halt Operation </Button> )} </Stack> </DialogContent> </Dialog> </> );
> 21 | }
     |  ^
  22 |

Expected a semicolon


./.gemini/antigravity/scratch/SenstoSales/frontend/lib/hooks/useDebounce.ts:2:2
Parsing ecmascript source code failed
  1 | /** * Custom React hook for debounced values * Prevents excessive API calls during user input */ import { useState, useEffect } from "react"; export function useDebouncedValue<T>(value: T, delay: number = 300): T { const [debouncedValue, setDebouncedValue] = useState<T>(value); useEffect(() => { // Set up the timeout const handler = setTimeout(() => { setDebouncedValue(value); }, delay); // Cleanup timeout if value changes before delay return () => { clearTimeout(handler); }; }, [value, delay]); return debouncedValue;
> 2 | }
    |  ^
  3 |

Expected ',', got '<eof>'

Import traces:
  Client Component Browser:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/lib/hooks/useDebounce.ts [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/dc/page.tsx [Client Component Browser]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/dc/page.tsx [Server Component]

  Client Component SSR:
    ./.gemini/antigravity/scratch/SenstoSales/frontend/lib/hooks/useDebounce.ts [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/dc/page.tsx [Client Component SSR]
    ./.gemini/antigravity/scratch/SenstoSales/frontend/app/dc/page.tsx [Server Component]


    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:145)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:121)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:105)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:113)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:138)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/[...id]/page.tsx:17:127)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/dc/create/page.tsx:16:3)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/create/page.tsx:16:2)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/po/create/page.tsx:16:2)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/reports/page.tsx:20:1)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/srv/page.tsx:21:2)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/app/srv/page.tsx:21:2)
    at <unknown> (./.gemini/antigravity/scratch/SenstoSales/frontend/lib/hooks/useDebounce.ts:2:2)
